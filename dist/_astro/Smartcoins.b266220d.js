import{$ as z,g as L,h as M,u as G,j as e,C as B,b as $,c as I,d as R,k as V,I as J,f as K,s as P,B as U}from"./CurrentUser.5db6b464.js";import{r as o}from"./index.178a5b5e.js";import{F as p}from"./index.esm.87f78e52.js";import{F as Q}from"./fuse.a1032ea1.js";import{d as W,T as D,a as A,c as r,e as j}from"./common.ea352216.js";import{B as g}from"./badge.ea92ff47.js";import{c as X}from"./User.5c3d6661.js";import{E}from"./ExternalLink.14186860.js";const f={backgroundColor:"#252526",color:"white"};function ne(Y){const h=o.useSyncExternalStore(z.subscribe,z.get,()=>!0),i=o.useSyncExternalStore(L.subscribe,L.get,()=>!0),n=o.useSyncExternalStore(M.subscribe,M.get,()=>!0);G(h&&h.chain?h.chain:"bitshares",["bitAssetData","marketSearch"]);const[w,q]=o.useState();o.useEffect(()=>{let l;return h&&h.id&&(l=X([h.chain,h.id]).subscribe(({data:s,error:t,loading:d})=>{s&&!t&&!d&&q(s)})),()=>{l&&l()}},[h]);const C=o.useMemo(()=>{if(w&&i&&n)return i.filter(a=>{const s=w.find(t=>t.asset_id===a.collateral);return!(!s||s&&!s.amount>0)})},[w,i,n]),S=o.useMemo(()=>{if(w&&i&&n)return i.filter(a=>!!w.find(t=>t.asset_id===a.assetID))},[w,i,n]),[x,y]=o.useState("all"),[m,v]=o.useState("borrow"),N=o.useMemo(()=>{if(!i||!i.length||!n||!n.length)return;const l=i.map(s=>{const t=n.find(u=>u.id===s.assetID),d=n.find(u=>u.id===s.collateral);return{...s,offer_symbol:t.s,collateral_symbol:d.s,issuerAccount:t.u}});let a;return m==="borrow"?a=["offer_symbol","assetID"]:m==="collateral"?a=["collateral_symbol","collateral"]:m==="issuer"&&(a=["issuerAccount"]),new Q(l,{includeScore:!0,threshold:.2,keys:a})},[i,n,m]),[b,F]=o.useState(),[c,H]=o.useState();o.useEffect(()=>{if(N&&b){const l=N.search(b);H(l)}},[N,b]);const O=o.useCallback(W(l=>{F(l.target.value),window.history.replaceState({},"",`?tab=search&searchTab=${m}&searchText=${l.target.value}`)},500),[]);function _({index:l,style:a,bitasset:s,thisBitassetData:t,thisCollateralAssetData:d}){return e.jsx("div",{style:{...a},children:e.jsxs(B,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs($,{className:"pb-1",children:[e.jsxs(I,{children:[s.issuer.id==="1.2.0"?"Bitasset":"Smartcoin",' "',t.s,'"'," ","(",e.jsx(E,{classnamecontents:"text-blue-500",type:"text",text:t.id,hyperlink:`https://blocksights.info/#/assets/${t.id}`}),")"," created by ",s.issuer.name," ","(",e.jsx(E,{classnamecontents:"text-blue-500",type:"text",text:s.issuer.id,hyperlink:`https://blocksights.info/#/accounts/${s.issuer.id}`}),")"]}),e.jsxs(R,{children:["Backing collateral:",e.jsxs("b",{children:[` ${d.s} `,"(",e.jsx(E,{classnamecontents:"text-blue-500",type:"text",text:d.id,hyperlink:`https://blocksights.info/#/assets/${d.id}`}),")"]})]})]}),e.jsxs(V,{className:"text-sm pb-3",children:[e.jsxs(g,{className:"mr-2 mt-2",children:["Feed qty: ",s.feeds?.length??0]}),e.jsxs(g,{className:"mr-2",children:["MCR: ",s.mcr/10," %"]}),e.jsxs(g,{className:"mr-2",children:["MSSR: ",s.mssr/10," %"]}),e.jsxs(g,{className:"mr-2",children:["ICR: ",s.icr/10," %"]})]}),e.jsx(P,{className:"pb-5",children:e.jsx("a",{href:`/smartcoin/index.html?id=${s.assetID}`,children:e.jsxs(U,{className:"h-8",children:["Proceed to borrow ",t.s]})})})]})},`acard-${s.assetID}`)}const Z=({index:l,style:a})=>e.jsx("div",{style:{...a},children:e.jsxs(B,{className:"ml-2 mr-2",children:[e.jsxs($,{className:"pb-1",children:[e.jsx(I,{children:'Smartcoin "..." (1.3.x) created by ... (1.2.x)'}),e.jsxs(R,{children:["Backing collateral:",e.jsx("b",{children:" ... (1.3.x)"})]})]}),e.jsxs(V,{className:"text-sm pb-3",children:[e.jsx(g,{className:"mr-2 mt-2",children:"Feed qty: ?"}),e.jsx(g,{className:"mr-2",children:"MCR: ? %"}),e.jsx(g,{className:"mr-2",children:"MSSR: ? %"}),e.jsx(g,{className:"mr-2",children:"ICR: ? %"})]}),e.jsx(P,{className:"pb-5",children:e.jsx(U,{className:"h-8",children:"Proceed to borrow ?"})})]})},`acard-${l}`),k=({index:l,style:a})=>{let s;x==="all"?s=i[l]:x==="compatible"?s=C[l]:x==="holdings"&&(s=S[l]);const t=s&&n?n.find(u=>u.id===s.assetID):null,d=s&&n?n.find(u=>u.id===s.collateral):null;return!s||!t||!d?null:e.jsx(_,{index:l,style:a,bitasset:s,thisBitassetData:t,thisCollateralAssetData:d})},T=({index:l,style:a})=>{let s=c[l].item;const t=n.find(u=>u.id===s.assetID),d=n.find(u=>u.id===s.collateral);return e.jsx(_,{index:l,style:a,bitasset:s,thisBitassetData:t,thisCollateralAssetData:d})};return o.useEffect(()=>{if(N){console.log("Parsing url params");const l=new URLSearchParams(window.location.search),a=Object.fromEntries(l.entries());if(a&&a.tab){if(!["all","compatible","holdings","search"].includes(a.tab))return;y(a.tab)}else window.history.replaceState({},"","?tab=all");if(a&&a.searchTab){if(!["borrow","collateral","issuer"].includes(a.searchTab))return;v(a.searchTab)}if(a&&a.searchText){if(!(t=>/^[a-zA-Z0-9.-]+$/.test(t))(a.searchText))return;F(a.searchText)}}},[N]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(I,{children:"ðŸ’µ Select a borrowable asset"}),e.jsxs(R,{children:["There are multiple user & committee created smartcoins on the Bitshares blockchain which you can issue yourself, given you provide and maintain sufficient backing collateral.",e.jsx("br",{}),"Thoroughly research assets before issuing them into existence, know your risk exposure and tolerances."]})]}),e.jsx(V,{children:i&&i.length&&w?e.jsxs(D,{defaultValue:x??"all",className:"w-full",children:[e.jsxs(A,{className:"grid w-full grid-cols-4 gap-2",children:[x==="all"?e.jsx(r,{value:"all",style:f,children:"Viewing all assets"}):e.jsx(r,{value:"all",onClick:()=>{y("all"),window.history.replaceState({},"","?tab=all")},children:"View all assets"}),x==="compatible"?e.jsx(r,{value:"compatible",style:f,children:"Viewing compatible"}):e.jsx(r,{value:"compatible",onClick:()=>{y("compatible"),window.history.replaceState({},"","?tab=compatible")},children:"View compatible"}),x==="holdings"?e.jsx(r,{value:"holdings",style:f,children:"Viewing holdings"}):e.jsx(r,{value:"holdings",onClick:()=>{y("holdings"),window.history.replaceState({},"","?tab=holdings")},children:"View holdings"}),x==="search"?e.jsx(r,{value:"search",style:f,children:"Searching"}):e.jsx(r,{value:"search",onClick:()=>{y("search"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:"Search"})]}),e.jsxs(j,{value:"all",children:[e.jsxs("h5",{className:"mb-2 text-center",children:["Listing ",i.length," (all) smartcoins"]}),e.jsx(p,{height:500,itemCount:i.length,itemSize:200,className:"w-full",children:k})]}),e.jsxs(j,{value:"compatible",children:[e.jsxs("h5",{className:"mb-2 text-center",children:["Listing ",C.length," smartcoins compatible with your account"]}),e.jsx(p,{height:500,itemCount:C.length,itemSize:200,className:"w-full",children:k})]}),e.jsxs(j,{value:"holdings",children:[e.jsxs("h5",{className:"mb-2 text-center",children:["Listing ",S?S.length:0," held smartcoins"]}),e.jsx(p,{height:500,itemCount:S?S.length:0,itemSize:200,className:"w-full",children:k})]}),e.jsxs(j,{value:"search",children:[e.jsx("h5",{className:"mb-2 text-center",children:"How do you want to search?"}),e.jsxs(D,{defaultValue:m??"borrow",className:"w-full",children:[e.jsxs(A,{className:"grid w-full grid-cols-3 gap-2",children:[m==="borrow"?e.jsx(r,{value:"borrow",style:f,children:"Searching by borrowable asset"}):e.jsx(r,{value:"borrow",onClick:()=>{v("borrow"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:"Search by borrowable asset"}),m==="collateral"?e.jsx(r,{value:"collateral",style:f,children:"Searching by collateral assets"}):e.jsx(r,{value:"collateral",onClick:()=>{v("collateral"),window.history.replaceState({},"","?tab=search&searchTab=collateral")},children:"Search by collateral assets"}),m==="issuer"?e.jsx(r,{value:"issuer",style:f,children:"Searching by issuer"}):e.jsx(r,{value:"issuer",onClick:()=>{v("issuer"),window.history.replaceState({},"","?tab=search&searchTab=issuer")},children:"Search by issuer"})]}),e.jsx(J,{name:"searchInput",placeholder:b??"Enter search text",className:"mb-3 mt-3 w-full",onChange:l=>O(l)}),e.jsxs(j,{value:"borrow",children:[c&&c.length?e.jsx(p,{height:500,itemCount:c.length,itemSize:200,className:"w-full",children:T}):null,b&&c&&!c.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(j,{value:"collateral",children:[c&&c.length?e.jsx(p,{height:500,itemCount:c.length,itemSize:200,className:"w-full",children:T}):null,b&&c&&!c.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(j,{value:"issuer",children:[c&&c.length?e.jsx(p,{height:500,itemCount:c.length,itemSize:200,className:"w-full",children:T}):null,b&&c&&!c.length?e.jsx(e.Fragment,{children:"No results found"}):null]})]})]})]},`Tabs_${x??""}${m??""}${b??""}`):e.jsxs(D,{defaultValue:"all",className:"w-full",children:[e.jsxs(A,{className:"grid w-full grid-cols-4 gap-2",children:[e.jsx(r,{value:"all",style:f,children:"Viewing all assets"}),e.jsx(r,{value:"all",children:"View compatible"}),e.jsx(r,{value:"all",children:"View holdings"}),e.jsx(r,{value:"all",children:"Search"})]}),e.jsxs(j,{value:"all",children:[e.jsx("h5",{className:"mb-2 text-center",children:"Listing ... (all) smartcoins"}),e.jsx(p,{height:500,itemCount:3,itemSize:200,className:"w-full",children:Z})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:h&&h.username&&h.username.length?e.jsx(K,{usr:h}):null})]})})}export{ne as default};
