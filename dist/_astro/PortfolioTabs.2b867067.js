import{$ as se,j as e,A as xe,C as j,a as g,b,c as y,d as B,e as L,B as c,f as fe}from"./AccountSelect.951be928.js";import{r as a}from"./index.d1e52ae9.js";import{F as E,h as I,D as N,a as R,b as C,c as J,d as P,e as q}from"./common.def03558.js";import{T as je,a as ge,b as F,c as H,S as W}from"./scroll-area.046f6300.js";const be={0:"Transfer",1:"Limit order create",2:"Limit order cancel",3:"Call order update",5:"Account creation",6:"Account update",7:"Account whitelist",8:"Account upgrade",9:"Account transfer",10:"Asset create",11:"Asset update",12:"Asset update bitasset",13:"Asset update feed producers",14:"Asset issue",15:"Asset reserve",16:"Asset fund fee pool",17:"Asset settle",18:"Asset global settle",19:"Asset publish feed",20:"Witness create",21:"Witness update",22:"Proposal create",23:"Proposal update",24:"Proposal delete",25:"Withdraw permission create",26:"Withdraw permission update",27:"Withdraw permission claim",28:"Withdraw permission delete",29:"Committee member create",30:"Committee member update",31:"Committee member update global parameters",32:"Vesting balance create",33:"Vesting balance withdraw",34:"Worker create",35:"Custom operation",36:"Assert",37:"Balance claim",38:"Override transfer",39:"Transfer to blind",40:"Blind transfer",41:"Transfer from blind",43:"Asset claim fees",45:"Collateral bid",47:"Asset claim pool",48:"Asset update issuer",49:"HTLC create",50:"HTLC redeem",52:"HTLC extend",54:"Custom authority create",55:"Custom authority update",56:"Custom authority delete",57:"Ticket create",58:"Ticket update",59:"Create liquidity pool",60:"Delete liquidity pool",61:"Liquidity pool deposit",62:"Liquidity pool withdraw",63:"Liquidity pool exchange",64:"SameT fund create",65:"SameT fund delete",66:"SameT fund update",67:"SameT fund borrow",68:"SameT fund repay",69:"Create credit offer",70:"Delete credit offer",71:"Update credit offer",72:"Accept credit offer",73:"Repay credit deal"};function De(ye){const[r,te]=a.useState();a.useEffect(()=>se.subscribe(t=>{te(t)}),[se]);const[S,M]=a.useState(0),[h,T]=a.useState(),[l,A]=a.useState();a.useEffect(()=>{async function i(){const t=await fetch(`http://localhost:8080/api/getPortfolio/${r.chain}/${r.id}`,{method:"GET"});if(!t.ok){console.log("Issues whilst fetching");return}const s=await t.json();if(s&&s.result){const n=s.result;console.log("Successfully fetched profile"),T(n.balances),A(n.limitOrders)}}r&&r.id&&r.id.length&&i()},[r,S]);const[V,ie]=a.useState(0),[w,D]=a.useState();a.useEffect(()=>{async function i(){const t=await fetch(`http://localhost:8080/api/getAccountHistory/${r.chain}/${r.id}`,{method:"GET"});if(!t.ok){console.log("Issues whilst fetching");return}const s=await t.json();s&&s.result&&(console.log("Successfully fetched history"),D(s.result))}r&&r.id&&r.id.length&&i()},[r,V]);const[d,U]=a.useState();a.useEffect(()=>{async function i(){let t=[];for(let o=0;o<l.length;o++){const u=l[o].sell_price.base.asset_id,m=l[o].sell_price.quote.asset_id;t.includes(u)||t.push(u),t.includes(m)||t.push(m)}for(let o=0;o<h.length;o++){const u=h[o].asset_id;t.includes(u)||t.push(u)}const s=await fetch(`http://localhost:8080/cache/assets/${r.chain}`,{method:"POST",body:JSON.stringify(t)});if(!s.ok){console.log({error:new Error(`${s.status} ${s.statusText}`),msg:"Couldn't generate deeplink."});return}const n=await s.json();n&&n.result&&U(n.result)}h&&h.length&&l&&l.length&&i()},[h,l]);const[z,Q]=a.useState(!1),re=()=>{z||(Q(!0),setTimeout(()=>{Q(!1)},1e4))},[v,ne]=a.useState(),[k,Y]=a.useState(""),[ae,G]=a.useState(),[O,le]=a.useState(0);a.useEffect(()=>{async function i(){const t=[{fee_paying_account:r.id,order:v,extensions:[]}];G(t);const s=await fetch(`http://localhost:8080/api/deeplink/${r.chain}/limit_order_cancel`,{method:"POST",body:JSON.stringify(t)});if(!s.ok){console.log({error:new Error(`${s.status} ${s.statusText}`),msg:"Couldn't generate deeplink."});return}const n=await s.json();n&&n.result&&n.result.generatedDeepLink&&Y(n.result.generatedDeepLink)}O>0&&v&&i()},[O,v]);const[X,K]=a.useState(!1);if(!r||!r.id||!r.id.length)return e.jsx(xe,{});const oe=({index:i,style:t})=>{const s=d&&Array.isArray(d)?d.find(o=>o.id===h[i].asset_id):{symbol:h[i].asset_id,precision:5},n=I(h[i].amount,s.precision).toLocaleString(void 0,{minimumFractionDigits:s.precision});return e.jsx("div",{style:{...t,marginBottom:"8px"},children:e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-6",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs(g,{children:[e.jsxs(b,{children:[s.symbol," (",h[i].asset_id,")"]}),e.jsxs(y,{children:["Liquid amount: ",n,e.jsx("br",{})]})]})}),e.jsxs("div",{className:"col-span-2 pt-5",children:[e.jsx("a",{href:`/dex/index.html?market=${s.symbol}_${s.symbol==="BTS"?"USD":"BTS"}`,children:e.jsx(c,{variant:"outline",className:"mr-2",children:"Trade"})}),e.jsxs(N,{children:[e.jsx(R,{asChild:!0,children:e.jsx(c,{variant:"outline",className:"mt-2",children:"Asset info"})}),e.jsxs(C,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(J,{children:[e.jsxs(P,{children:["Additional information on ",s.symbol]}),e.jsx(q,{children:"JSON properties"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(W,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(s,null,2)})})})})]})]})]})]})})})},ce=i=>{navigator.clipboard.writeText(i).then(()=>{console.log("Text copied to clipboard")}).catch(t=>{console.error("Error copying text: ",t)})},de=({index:i,style:t})=>{const s=l[i].sell_price.base.amount,n=l[i].sell_price.base.asset_id,o=l[i].sell_price.quote.amount,u=l[i].sell_price.quote.asset_id,m=l[i].id,_=l[i].expiration,x=d&&d.length?d.find(f=>f.id===n):null,p=d&&d.length?d.find(f=>f.id===u):null,Z=x?I(s,x.precision):s,ee=p?I(o,p.precision):o,$=new Date(_)-new Date,ue=Math.floor($/1e3/60%60),me=Math.floor($/1e3/60/60%24),pe=`${Math.floor($/1e3/60/60/24)}d ${me}h ${ue}m`;return e.jsx("div",{style:{...t},children:e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-6",children:[e.jsx("div",{className:"col-span-5",children:e.jsxs(g,{children:[e.jsxs(b,{children:["Selling ",Z," ",x.symbol," for ",ee," ",p.symbol]}),e.jsxs(y,{children:["Trading pair: ",n," for ",u,e.jsx("br",{}),"Order ID: ",m,e.jsx("br",{}),"Expires: ",pe]})]})}),e.jsxs("div",{className:"col-span-1 pt-7",children:[e.jsx("a",{href:`/dex/index.html?market=${x.symbol}_${p.symbol}`,children:e.jsx(c,{variant:"outline",className:"mb-2",children:"Trade"})}),e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",className:"mt-2",onClick:()=>{K(!0),ne(m),le(O+1)},children:"Cancel"}),X&&m===v&&k&&e.jsx(N,{open:X,onOpenChange:f=>{f||(Y(),G()),K(f)},children:e.jsx(C,{className:"sm:max-w-[425px] bg-white",children:e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"scroll-m-20 text-1xl font-semibold tracking-tight mt-1",children:"Your requested limit order cancellation is ready!"}),"Cancelling offer of ",Z," ",x.symbol," for ",ee," ",p.symbol,e.jsx("br",{}),"Order ID: ",m,e.jsx("br",{}),"Account: ",r.id,e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(c,{color:"gray",className:"w-full",onClick:()=>{ce(JSON.stringify(ae))},variant:"outline",children:"Copy operation JSON"}),z?e.jsx(c,{variant:"outline",disabled:!0,children:"Downloading..."}):e.jsx("a",{href:`data:text/json;charset=utf-8,${k}`,download:"limit_order_cancel.json",target:"_blank",rel:"noreferrer",onClick:re,children:e.jsx(c,{variant:"outline",className:"w-full",children:"Download Beet operation JSON"})}),e.jsx("a",{href:`rawbeet://api?chain=BTS&request=${k}`,children:e.jsx(c,{variant:"outline",className:"w-full",children:"Trigger raw Beet deeplink"})})]})]})})})]})]})]})})})},he=({index:i,style:t})=>{const s=w[i],n=new Date(s.block_data.block_time),u=new Date-n,m=Math.floor(u/1e3/60%60),_=Math.floor(u/1e3/60/60%24),p=`${Math.floor(u/1e3/60/60/24)}d ${_}h ${m}m`;return e.jsx("div",{style:{...t},children:e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-7",children:[e.jsx("div",{className:"col-span-5",children:e.jsxs(g,{children:[e.jsx(b,{children:be[s.operation_type.toString()]}),e.jsxs(y,{children:["Operation ID: ",s.account_history.operation_id,e.jsx("br",{}),"Block number: ",s.block_data.block_num,e.jsx("br",{}),"Time since broadcast: ",p]})]})}),e.jsxs("div",{className:"col-span-2 mt-7",children:[e.jsxs(N,{children:[e.jsx(R,{asChild:!0,children:e.jsx(c,{variant:"outline",children:"View Operation"})}),e.jsxs(C,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(J,{children:[e.jsx(P,{children:"Operation JSON"}),e.jsx(q,{children:"Check out the contents of this operation"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(W,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(s.operation_history.op_object,null,2)})})})})]})]}),e.jsxs(N,{children:[e.jsx(R,{asChild:!0,children:e.jsx(c,{variant:"outline",className:"mt-2",children:"View all"})}),e.jsxs(C,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(J,{children:[e.jsx(P,{children:"Full operation contents"}),e.jsx(q,{children:"Exhaustive info regarding this operation"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(W,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(s,null,2)})})})})]})]})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container mx-auto mt-5 mb-5",children:e.jsx("div",{className:"grid grid-cols-1 mt-5",children:e.jsxs(je,{defaultValue:"balances",className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-3",children:[e.jsx(F,{value:"balances",children:"Balances"}),e.jsx(F,{value:"openOrders",children:"Open orders"}),e.jsx(F,{value:"activity",children:"Activity"})]}),e.jsx(H,{value:"balances",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(b,{children:[r.username,"'s account balances"]}),e.jsx(y,{children:"The assets held within your account"})]}),e.jsx(B,{className:"space-y-2",children:h&&h.length&&d&&d.length?e.jsx(E,{height:300,itemCount:h.length,itemSize:100,className:"gaps-2",children:oe}):e.jsx("p",{children:"No balances found"})}),e.jsx(L,{children:e.jsx(c,{onClick:()=>{T(),M(S+1)},children:"Refresh balances"})})]})}),e.jsx(H,{value:"openOrders",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(b,{children:"Open orders"}),e.jsx(y,{children:"Your currently open limit orders on the DEX"})]}),e.jsx(B,{children:l&&l.length&&d&&d.length?e.jsx(E,{height:300,itemCount:l.length,itemSize:145,children:de}):e.jsx("p",{children:"No open orders found"})}),e.jsx(L,{children:e.jsx(c,{onClick:()=>{A(),M(S+1)},children:"Refresh open orders"})})]})}),e.jsx(H,{value:"activity",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(b,{children:"Recent blockchain activity"}),e.jsx(y,{children:"Your recent blockchain activity"})]}),e.jsx(B,{className:"space-y-2",children:w&&w.length?e.jsx(E,{height:300,itemCount:w.length,itemSize:145,children:he}):e.jsx("p",{children:"No recent activity found"})}),e.jsx(L,{children:e.jsx(c,{onClick:()=>{D(),ie(V+1)},children:"Refresh recent activity"})})]})})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(c,{className:"mt-5",onClick:()=>{fe(),T(),A(),D(),U()},children:"Switch account/chain"})})]})}export{De as default};
