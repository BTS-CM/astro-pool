import{u as e,I as Ne}from"./button.gDHZ9QV2.js";import{r as n}from"./index.vR8cGMCg.js";import{u as ve,F as $e,a as j,b as p,c as b,d as f,e as g,f as T}from"./form.wdlGUv6c.js";import{F as _e}from"./index.esm.ysaRy2yh.js";import{$ as W,g as X,h as Y,i as Z,j as ee,k as se,l as te,u as Ce,C as ae,b as le,c as ne,d as re,m as ie,A as ye,I as c,f as Ae}from"./CurrentUser.JfssIRBN.js";import{A as Be,a as Te}from"./avatar.kakJdICT.js";import{P as I,a as k,b as M}from"./checkbox.ZaP5HFMg.js";import{h as S,g as De,b as J}from"./common.oHu2IIZP.js";import{L as C,D as Pe}from"./DeepLinkDialog.gediKe-e.js";import"./toggle.PLTd6S6_.js";import"./scroll-area.5BDBXE1H.js";import"./User.PSirryGZ.js";import{c as we,a as Oe}from"./Assets.XLJzllN0.js";import"./index.f2GGseSc.js";import"./index.Iv-N6sBm.js";import"./index.NLQBrJpM.js";import"./ExternalLink.PiX5tK9K.js";function es(s){const l=ve({defaultValues:{account:""}}),a=n.useSyncExternalStore(W.subscribe,W.get,(()=>!0)),r=n.useSyncExternalStore(X.subscribe,X.get,(()=>!0)),t=n.useSyncExternalStore(Y.subscribe,Y.get,(()=>!0)),i=n.useSyncExternalStore(Z.subscribe,Z.get,(()=>!0)),d=n.useSyncExternalStore(ee.subscribe,ee.get,(()=>!0)),o=n.useSyncExternalStore(se.subscribe,se.get,(()=>!0)),m=n.useSyncExternalStore(te.subscribe,te.get,(()=>!0)),x=n.useMemo((()=>a&&a.chain?a.chain:"bitshares"),[a]);Ce(x??"bitshares",["bitAssetData","globalParams","marketSearch"]);const h=n.useMemo((()=>x&&(r||t)?"bitshares"===x?r:t:[]),[r,t,x]),u=n.useMemo((()=>x&&(o||m)?"bitshares"===x?o:m:[]),[o,m,x]),N=n.useMemo((()=>x&&(i||d)?"bitshares"===x?i:d:[]),[i,d,x]),[v,$]=n.useState(),[F,_]=n.useState(),[y,O]=n.useState(),[w,P]=n.useState(0),[B,A]=n.useState(0);n.useEffect((()=>{if(u&&u.length){const e=u.find((e=>45===e[0])),s=u.find((e=>17===e[0])),n=S(e[1].fee,5),l=S(s[1].fee,5);P(n),A(l)}}),[u]);const D=n.useMemo((()=>{if(N&&N.length&&window.location.search){const e=new URLSearchParams(window.location.search),s=Object.fromEntries(e.entries()),n=s&&s.id?s.id:null;return!n||!n.length||n&&!n.includes("1.3.")?void console.log("Invalid parameter"):(N&&N.length?N.map((e=>e.id)):[]).includes(n)?n:void console.log("Invalid parameter")}}),[N]),E=n.useMemo((()=>D&&D.length&&N?N.find((e=>e.id===D)):null),[D,N]),R=n.useMemo((()=>E&&h?h.find((e=>e.assetID===E.id)):null),[E,h]),L=n.useMemo((()=>{if(R&&h)return N.find((e=>e.id===R.collateral))}),[R,h]),G=n.useMemo((()=>{if(F&&F.current_feed&&L&&E)return parseFloat((S(parseInt(F.current_feed.settlement_price.quote.amount),L.p)/S(parseInt(F.current_feed.settlement_price.base.amount),E.p)).toFixed(L.p))}),[F,E,L]),U=n.useMemo((()=>{if(v&&E&&L){return{finalSettlementFund:S(parseInt(F.settlement_fund),L.p),finalSettlementPrice:parseFloat((1/(S(F.settlement_price.quote.amount,L.p)/S(F.settlement_price.base.amount,E.p))).toFixed(E.p))}}}),[F,E,L]),H=n.useMemo((()=>{if(F&&E&&L){return{_debt:S(parseInt(F.individual_settlement_debt),E.p),_fund:S(parseInt(F.individual_settlement_fund),L.p)}}}),[F,E,L]);n.useEffect((()=>{let e;return R&&R&&a&&a.chain&&(e=we([a.chain,E.id,R.collateral,R.id]).subscribe((({data:e,error:s,loading:n})=>{e&&!s&&!n&&($(e[0]),O(e[1]),_(e[2]))}))),()=>{e&&e()}}),[E,R,a]);const[q,z]=n.useState();n.useEffect((()=>{let e;return E&&a&&a.chain&&(e=Oe([a.chain,E.id]).subscribe((({data:e,error:s,loading:n})=>{e&&!s&&!n&&z(e)}))),()=>{e&&e()}}),[E,a]);const K=n.useMemo((()=>{if(v){const e=De(v.options.flags);return Object.keys(e).includes("disable_collateral_bidding")}}),[v]),[Q,V]=n.useState(0),[de,ce]=n.useState(0),[oe,me]=n.useState(0),[xe,je]=n.useState(0),[he,ue]=n.useState(!1);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs(ae,{children:[e.jsxs(le,{children:[e.jsx(ne,{children:"🏦 Smartcoin settlement form"}),e.jsx(re,{children:U&&U.finalSettlementFund?"Bid on global settlement funds with the following form":"Force settle assets for individual settlement funds"})]}),e.jsxs(ie,{children:[e.jsx($e,{...l,children:e.jsxs("form",{onSubmit:e=>{ue(!0),e.stopPropagation(),e.preventDefault()},children:[e.jsx(j,{control:l.control,name:"account",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:U&&U.finalSettlementFund?"Bidding account":"Asset settling account"}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsx("div",{className:"col-span-1 ml-5",children:a&&a.username?e.jsx(ye,{size:40,name:a.username,extra:"Target",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]}):e.jsx(Be,{children:e.jsx(Te,{children:"?"})})}),e.jsx("div",{className:"col-span-7",children:e.jsx(c,{disabled:!0,placeholder:"Bitshares account (1.2.x)",className:"mb-3",value:`${a.username} (${a.id})`,readOnly:!0})})]})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"selectedAsset",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Selected asset"}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:e.jsx(c,{disabled:!0,placeholder:"Bitshares smartcoin (1.3.x)",className:"mb-1",value:`${E?E.s:""} (${E?E.id:""})`,readOnly:!0})})})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"currentFeedPrice",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Current feed price"}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:E&&L?e.jsx(c,{disabled:!0,className:"mb-1",value:`${G?(1/G).toFixed(E.p):0} ${E?E.s:""}/${L?L.s:""}`,readOnly:!0}):e.jsx(c,{disabled:!0,className:"mb-1",value:"",readOnly:!0})})})}),e.jsx(g,{})]})}),U&&U.finalSettlementFund?e.jsxs(e.Fragment,{children:[e.jsx(j,{control:l.control,name:"settlementPrice",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Final settlement price"}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:e.jsx(c,{disabled:!0,className:"mb-1",value:`${U.finalSettlementPrice} ${E.s}/${L.s}`,readOnly:!0})})})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"fundsAvailable",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Settlement funds available"}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:e.jsx(c,{disabled:!0,className:"mb-1",value:`${U.finalSettlementFund} ${L.s}`,readOnly:!0})})})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"fundingRatio1",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Funding ratio"}),e.jsx(f,{children:e.jsxs("span",{className:"grid grid-cols-8",children:[e.jsx("span",{className:"col-span-2 mb-1",children:e.jsx(c,{disabled:!0,value:`${(1/G/U.finalSettlementPrice*100).toFixed(2)} %`,readOnly:!0})}),e.jsx("span",{className:"col-span-2 text-red-500",children:e.jsx(c,{disabled:!0,value:`-${(100-1/G/U.finalSettlementPrice*100).toFixed(2)}%`,readOnly:!0})})]})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"additionalCollateral",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Additional collateral"}),e.jsxs(T,{children:["The amount of additional collateral you're willing to provide in return for global settled ",E.s]}),e.jsx(f,{children:e.jsxs("span",{className:"grid grid-cols-12",children:[e.jsx("span",{className:"col-span-8",children:e.jsx(c,{placeholder:oe?`${oe} ${L.s}`:`0 ${L.s}`,readOnly:!0,disabled:!0,className:"mb-3"})}),e.jsx("span",{className:"col-span-4 ml-3",children:e.jsxs(I,{children:[e.jsx(k,{children:e.jsx("span",{className:"inline-block border border-grey rounded pl-4 pb-1 pr-4",children:e.jsx(C,{children:"Change amount"})})}),e.jsxs(M,{children:[e.jsx(C,{children:"Provide a new amount of additional collateral"}),e.jsx(c,{placeholder:oe,className:"mb-2 mt-1",onChange:e=>{const s=e.target.value;s&&s.length&&/^[0-9]*\.?[0-9]*$/.test(s)&&me(parseFloat(s).toFixed(L.p))}})]})]})})]})})]})}),e.jsx(j,{control:l.control,name:"debtCovered",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Total debt covered by bid"}),e.jsx(T,{children:"In return for bidding the above additional collateral this is the debt you'll cover"}),e.jsx(f,{children:e.jsxs("span",{className:"grid grid-cols-12",children:[e.jsx("span",{className:"col-span-8",children:e.jsx(c,{placeholder:xe?`${xe} ${E.s}`:`0 ${E.s}`,readOnly:!0,disabled:!0,className:"mb-3"})}),e.jsx("span",{className:"col-span-4 ml-3",children:e.jsxs(I,{children:[e.jsx(k,{children:e.jsx("span",{className:"inline-block border border-grey rounded pl-4 pb-1 pr-4",children:e.jsx(C,{children:"Change total"})})}),e.jsxs(M,{children:[e.jsx(C,{children:"Provide a new total debt covered"}),e.jsx(c,{placeholder:xe,className:"mb-2 mt-1",onChange:e=>{const s=e.target.value;s&&s.length&&/^[0-9]*\.?[0-9]*$/.test(s)&&je(parseFloat(s).toFixed(E.p))}})]})]})})]})})]})})]}):null,H&&(H._debt||H._fund)?e.jsxs(e.Fragment,{children:[e.jsx(j,{control:l.control,name:"isd",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Individual settlement debt"}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:e.jsx(c,{disabled:!0,className:"mb-1",value:`${H._debt} ${E.s}`,readOnly:!0})})})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"isf",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Individual settlement fund"}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:e.jsx(c,{disabled:!0,className:"mb-1",value:`${H._fund} ${L.s}`,readOnly:!0})})})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"fundingRatio2",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Funding ratio"}),e.jsx(f,{children:e.jsxs("span",{className:"grid grid-cols-8",children:[e.jsx("span",{className:"col-span-2 mb-1",children:e.jsx(c,{disabled:!0,value:`${(H._debt*G/H._fund*100).toFixed(2)} %`,readOnly:!0})}),e.jsx("span",{className:"col-span-2 text-red-500",children:e.jsx(c,{disabled:!0,value:`-${(100-H._debt*G/H._fund*100).toFixed(2)}%`,readOnly:!0})})]})}),e.jsx(g,{})]})}),e.jsx(j,{control:l.control,name:"ForceSettleAmount",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Force settle amount"}),e.jsx(T,{children:"The amount of individual settlement fund backing collateral you wish to claim"}),e.jsx(f,{children:e.jsxs("span",{className:"grid grid-cols-12",children:[e.jsx("span",{className:"col-span-8",children:e.jsx(c,{label:`Amount of ${L.s} to force settle`,placeholder:Q?`${Q} ${E.s}`:`0 ${E.s}`,readOnly:!0,disabled:!0,className:"mb-3"})}),e.jsx("span",{className:"col-span-4 ml-3",children:e.jsxs(I,{children:[e.jsx(k,{children:e.jsx("span",{className:"inline-block border border-grey rounded pl-4 pb-1 pr-4",children:e.jsx(C,{children:"Change amount"})})}),e.jsxs(M,{children:[e.jsx(C,{children:"Provide a new force settle amount"}),e.jsx(c,{placeholder:Q,className:"mb-2 mt-1",onChange:e=>{const s=e.target.value;if(s&&s.length&&/^[0-9]*\.?[0-9]*$/.test(s)){V(parseFloat(s).toFixed(E.p));const e=parseFloat((H._debt/H._fund*s).toFixed(L.p));ce(e)}}})]})]})})]})}),Q&&H._debt&&Q>H._debt?e.jsx(g,{children:"Unable to force settle a greater amount than the individual settlement debt"}):null]})}),e.jsx(j,{control:l.control,name:"totalReceiving",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Total amount you'll receive"}),e.jsxs(T,{children:["In return for force settling ",E.s," you'll receive the following"]}),e.jsx(f,{children:e.jsxs("span",{className:"grid grid-cols-12",children:[e.jsx("span",{className:"col-span-8",children:e.jsx(c,{placeholder:de?`${de} ${L.s}`:`0 ${L.s}`,readOnly:!0,disabled:!0,className:"mb-1"})}),e.jsx("span",{className:"col-span-4 ml-3",children:e.jsxs(I,{children:[e.jsx(k,{children:e.jsx("span",{className:"inline-block border border-grey rounded pl-4 pb-1 pr-4",children:e.jsx(C,{children:"Change total"})})}),e.jsxs(M,{children:[e.jsx(C,{children:"Provide a new total amount"}),e.jsx(c,{placeholder:de,className:"mb-2 mt-1",onChange:e=>{const s=e.target.value;s&&s.length&&/^[0-9]*\.?[0-9]*$/.test(s)&&(ce(parseFloat(s).toFixed(L.p)),V((s/G).toFixed(E.p)))}})]})]})})]})}),e.jsxs(g,{children:["Paying a"," ",(100-H._debt*G/H._fund*100).toFixed(2),"% premium"]})]})})]}):null,e.jsx(j,{control:l.control,name:"fee",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"Network fee"}),e.jsxs(T,{children:["Operation:"," ",U&&U.finalSettlementFund?45:17]}),e.jsx(f,{children:e.jsx("span",{className:"grid grid-cols-8",children:e.jsx("span",{className:"col-span-6",children:e.jsx(c,{disabled:!0,className:"mb-1",value:`${U&&U.finalSettlementFund?w:B} BTS`,readOnly:!0})})})}),e.jsx(g,{})]})}),F&&F.options.extensions.force_settle_fee_percent?e.jsxs(g,{children:["Additional force settlement fee:"," ",F.options.extensions.force_settle_fee_percent/100," %"]}):null,e.jsx(Ne,{className:"mt-5 mb-3",type:"submit",children:"Submit"}),K?e.jsx(g,{children:"Collateral bidding has been disabled for this asset; this operation will be rejected."}):null]})}),U&&(!U||U.finalSettlementFund)||H&&(!H||H._debt&&H._fund)?null:"No settlement funds available"]})]}),q&&q.length?e.jsxs(ae,{children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Existing collateral bids"}),e.jsx(re,{children:"These collateral bids have been created by other users who are interested in the global settled funds"})]}),e.jsxs(ie,{children:[e.jsxs("div",{className:"grid grid-cols-5",children:[e.jsx("div",{className:"col-span-1",children:"Bidder"}),e.jsx("div",{className:"col-span-1",children:"Collateral"}),e.jsx("div",{className:"col-span-1",children:"Debt"}),e.jsx("div",{className:"col-span-1",children:"Bid price"}),e.jsx("div",{className:"col-span-1",children:"Ratio"})]}),e.jsx(_e,{height:500,itemCount:q.length,itemSize:225,className:"w-full",children:({index:s,style:n})=>{const l=q[s],a=S(l.bid.base.amount,L.p),r=S(l.bid.quote.amount,E.p),t=parseFloat((a/r).toFixed(L.p)),i=parseFloat((1/G/t*100).toFixed(2));return e.jsxs("div",{className:"grid grid-cols-4 text-sm",style:n,children:[e.jsx("div",{className:"col-span-1",children:l.bidder}),e.jsx("div",{className:"col-span-1",children:a}),e.jsx("div",{className:"col-span-1",children:r}),e.jsx("div",{className:"col-span-1",children:t}),e.jsx("div",{className:"col-span-1",children:i})]})}})]})]}):null,he?e.jsx(Pe,{operationName:U&&U.finalSettlementFund?"bid_collateral":"asset_settle",username:a.username,usrChain:a.chain,userID:a.id,dismissCallback:ue,headerText:U&&U.finalSettlementFund?`Bidding on ${E.s} debt with ${L.s} collateral`:`Settling ${Q} ${E.s} for ${de} ${L.s}`,trxJSON:[U&&U.finalSettlementFund?{bidder:a.id,additional_collateral:{amount:J(oe,L.p),asset_id:L.id},debt_covered:{amount:J(xe,E.p),asset_id:E.id},extensions:[]}:{account:a.id,amount:{amount:J(Q,E.p),asset_id:E.id},extensions:[]}]},U&&U.finalSettlementFund?`bidCollateral${L.s}Debt${E.s}`:`Settling${Q}${E.s}for${de}${L.s}`):null]}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:a&&a.username&&a.username.length?e.jsx(Ae,{usr:a}):null})]})})}export{es as default};