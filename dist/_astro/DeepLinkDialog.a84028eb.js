import{j as e,G as N,z as $,_ as B,a6 as F,B as r,D as y,l as k,m as v,n as T,o as O,s as R,a3 as _}from"./CurrentUser.fcde08c5.js";import{r as n}from"./index.178a5b5e.js";import{T as A,a as M,b as i,c as g,f as X}from"./common.1877ab42.js";const S=n.forwardRef(({className:l,...t},a)=>e.jsx("textarea",{className:N("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",l),ref:a,...t}));S.displayName="Textarea";const Y=n.forwardRef((l,t)=>n.createElement($.label,B({},l,{ref:t,onMouseDown:a=>{var s;(s=l.onMouseDown)===null||s===void 0||s.call(l,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault()}}))),D=Y,q=F("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),x=n.forwardRef(({className:l,...t},a)=>e.jsx(D,{ref:a,className:N(q(),l),...t}));x.displayName=D.displayName;function P(l){const{hyperlink:t,type:a,text:s,variant:u,classNameContents:h}=l,[m,c]=n.useState(!1);return["https://blocksights.info/","https://bts.exchange/","https://wallet.btwty.com/","https://ex.xbts.io/","https://kibana.bts.mobi/","https://www.bitsharescan.info/","https://github.com/bitshares/beet"].some(o=>t.startsWith(o))?e.jsxs(e.Fragment,{children:[a==="text"?e.jsx("span",{onClick:()=>c(!0),className:h,children:s}):e.jsx(r,{variant:u,onClick:()=>c(!0),className:h,children:s}),e.jsx(y,{open:m,onOpenChange:o=>{c(o)},children:e.jsxs(k,{className:"sm:max-w-[500px] bg-white",children:[e.jsxs(v,{children:[e.jsx(T,{children:"⚠️ You are about to leave this app!"}),e.jsx(O,{children:"You are about to nagivate to an external website."})]}),e.jsx("h3",{className:"scroll-m-20 text-1xl font-semibold tracking-tight mb-3 mt-1",children:"Do you want to proceed to the following URL?"}),e.jsx("code",{className:"relative rounded bg-muted px-[0.3rem] py-[0.2rem] font-mono text-sm font-semibold",children:t}),e.jsx("h3",{className:"scroll-m-20 text-1xl font-semibold tracking-tight mb-3 mt-1",children:"Just checking - are you sure you want to leave?"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsx("a",{href:t,target:"_blank",children:e.jsx(r,{color:"gray",variant:"outline",children:"Open Link"})})})]})})]}):(console.log("Invalid external link"),null)}let J=[];const[G]=R({fetcher:(...l)=>fetch(`http://localhost:8080/api/deeplink/${l[0]}/${l[1]}`,{method:"POST",body:JSON.stringify(J)}).then(async t=>{if(!t.ok)throw console.log("Failed to generate deeplink"),new Error("Failed to generate deeplink");let a;try{a=await t.json()}catch{throw console.log("Failed to parse JSON"),new Error("Failed to parse JSON")}return a}).then(t=>{if(t&&t.result&&t.result.generatedDeepLink)return t.result.generatedDeepLink;throw new Error("No deep link generated")})});function W(l){const{trxJSON:t,operationName:a,usrChain:s,headerText:u,dismissCallback:h,username:m,userID:c}=l,f=n.useMemo(()=>(J=t,G([s,a])),[s,a,t]),{data:o,loading:d,error:C}=_(f),[b,w]=n.useState(!1),L=()=>{b||(w(!0),setTimeout(()=>{w(!1)},1e4))},[p,j]=n.useState("object");return e.jsx(y,{open:!0,onOpenChange:E=>{h(E)},children:e.jsxs(k,{className:"sm:max-w-[800px] bg-white",children:[e.jsxs(v,{children:[e.jsx(T,{children:d?e.jsx(e.Fragment,{children:"Generating deeplink..."}):e.jsx(e.Fragment,{children:u})}),e.jsxs(O,{children:["With the account: ",m," (",c,")",e.jsx("br",{}),d?null:e.jsxs(e.Fragment,{children:["Your Bitshares create limit order operation is ready!",e.jsx("br",{}),"Choose from the methods below to broadcast your transaction via the",e.jsx(P,{classNameContents:"text-blue-500",type:"text",text:" Bitshares BEET multiwallet",hyperlink:"https://github.com/bitshares/beet"}),"."]}),C?e.jsx(e.Fragment,{children:"An error occurred, sorry. Please close this dialog and try again."}):null,e.jsx("hr",{className:"mt-3"})]})]}),e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(A,{defaultValue:"object",className:"w-full",children:[e.jsxs(M,{className:"grid w-full grid-cols-3 gap-2",children:[p==="object"?e.jsx(i,{value:"object",children:"View TRX Object"},"activeTRXTab"):e.jsx(i,{value:"object",onClick:()=>j("object"),children:"View TRX Object"},"inactiveTRXTab"),p==="deeplink"?e.jsx(i,{value:"deeplink",children:"Raw Deeplink"},"activeDLTab"):e.jsx(i,{value:"deeplink",onClick:()=>j("deeplink"),children:"Raw Deeplink"},"inactiveDLTab"),p==="localJSON"?e.jsx(i,{value:"localJSON",className:"bg-muted",children:"Local JSON file"},"activeJSONTab"):e.jsx(i,{value:"localJSON",onClick:()=>j("localJSON"),children:"Local JSON file"},"inactiveJSONTab")]},`${p}_TabList`),e.jsxs(g,{value:"object",children:[e.jsxs("div",{className:"grid w-full gap-1.5 mb-3",children:[e.jsx(x,{className:"text-left",children:"Transaction object JSON"}),e.jsxs("span",{className:"text-left text-sm",children:["Operation type: ",a]}),e.jsx(S,{value:JSON.stringify(t,null,4),className:"min-h-[250px]",id:"trxJSON"})]}),e.jsx(r,{onClick:()=>{X(JSON.stringify(t,null,4))},children:"Copy operation JSON"})]}),e.jsxs(g,{value:"deeplink",children:[e.jsx(x,{className:"text-left",children:"Using a deeplink to broadcast via the Beet multiwallet"}),e.jsxs("ol",{className:"ml-4",children:[e.jsxs("li",{type:"1",children:["Launch the BEET wallet and navigate to '",e.jsx("b",{children:"Raw Link"}),"' in the menu, the wallet has to remain unlocked for the duration of the broadcast."]}),e.jsxs("li",{type:"1",children:["From this page you can either allow all operations, or solely allow operation '",e.jsx("b",{children:a}),"' (then click save)."]}),e.jsx("li",{type:"1",children:"Once 'Ready for raw links' shows in Beet, then you can click the button below to proceed."}),e.jsx("li",{type:"1",children:"A BEET prompt will display, verify the contents, optionally request a Beet receipt, and then broadcast the transaction onto the blockchain."}),e.jsx("li",{type:"1",children:"You won't receive a confirmation in this window, but your operation will be processed within seconds on the blockchain."})]}),d?null:e.jsx("a",{href:`rawbeet://api?chain=BTS&request=${o}`,children:e.jsx(r,{className:"mt-4",children:"Trigger raw Beet deeplink"})})]}),e.jsxs(g,{value:"localJSON",children:[e.jsx(x,{className:"text-left",children:"Via local file upload - ready to proceed"}),e.jsxs("ol",{className:"ml-4",children:[e.jsxs("li",{type:"1",children:["Launch the BEET wallet and navigate to '",e.jsx("b",{children:"Local"}),"' in the menu."]}),e.jsxs("li",{type:"1",children:["At this page either allow all, or allow just operation '",e.jsx("b",{children:a}),"'."]}),e.jsx("li",{type:"1",children:"Once at the local upload page, click the button below to download the JSON file to your computer."}),e.jsx("li",{type:"1",children:"From the BEET Local page, upload the JSON file, a prompt should then appear."}),e.jsx("li",{type:"1",children:"Thoroughly verify the prompt's contents before approving any operation, also consider toggling the optional receipt for post broadcast analysis and verification purposes."})]}),!d&&b?e.jsx(r,{className:"mt-4",variant:"outline",disabled:!0,children:"Downloading..."}):null,!d&&!b?e.jsx("a",{href:`data:text/json;charset=utf-8,${o}`,download:`${a}.json`,target:"_blank",rel:"noreferrer",onClick:L,children:e.jsx(r,{className:"mt-4",children:"Download Beet operation JSON"})}):null]})]})})})]})})}export{W as D,P as E,x as L};
