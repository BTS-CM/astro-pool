import{u as e,I as q}from"./button.py8r9pgQ.js";import{r}from"./index.vR8cGMCg.js";import{F as p}from"./index.esm.8fBdem9M.js";import{F as ee}from"./fuse.aCsZfKX4.js";import{d as se,T as A,a as R,b as c,c as j}from"./common.X_7DDhag.js";import{$ as H,g as O,h as Z,i as G,j as J,u as ae,C as V,b as _,c as F,d as M,k as z,I as te,f as le,l as K}from"./CurrentUser.9PQ1vVJE.js";import{B as g}from"./badge.pYgHolp0.js";import{c as re}from"./User.qZ-NhGvB.js";import{E as L}from"./ExternalLink.T2a5i_k0.js";import"./index.7dNGbZe0.js";const f={backgroundColor:"#252526",color:"white"};function ge(ce){const h=r.useSyncExternalStore(H.subscribe,H.get,()=>!0),T=r.useSyncExternalStore(O.subscribe,O.get,()=>!0),k=r.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),B=r.useSyncExternalStore(G.subscribe,G.get,()=>!0),$=r.useSyncExternalStore(J.subscribe,J.get,()=>!0),S=r.useMemo(()=>h&&h.chain?h.chain:"bitshares",[h]);ae(S??"bitshares",["bitAssetData","marketSearch"]);const n=r.useMemo(()=>S&&(T||k)?S==="bitshares"?T:k:[],[T,k,S]),o=r.useMemo(()=>S&&(B||$)?S==="bitshares"?B:$:[],[B,$,S]),[w,Q]=r.useState();r.useEffect(()=>{let t;return h&&h.id&&(t=re([h.chain,h.id]).subscribe(({data:s,error:l,loading:u})=>{s&&!l&&!u&&Q(s)})),()=>{t&&t()}},[h]);const E=r.useMemo(()=>{if(w&&n&&o)return n.filter(a=>{const s=w.find(l=>l.asset_id===a.collateral);return!(!s||s&&!s.amount>0)})},[w,n,o]),y=r.useMemo(()=>{if(w&&n&&o)return n.filter(a=>!!w.find(l=>l.asset_id===a.assetID))},[w,n,o]),[x,N]=r.useState("all"),[m,C]=r.useState("borrow"),v=r.useMemo(()=>{if(!n||!n.length||!o||!o.length)return;const t=n.map(s=>{const l=o.find(d=>d.id===s.assetID),u=o.find(d=>d.id===s.collateral);return{...s,offer_symbol:l.s,collateral_symbol:u.s,issuerAccount:l.u}});let a;return m==="borrow"?a=["offer_symbol","assetID"]:m==="collateral"?a=["collateral_symbol","collateral"]:m==="issuer"&&(a=["issuerAccount"]),new ee(t,{includeScore:!0,threshold:.2,keys:a})},[n,o,m]),[b,U]=r.useState(),[i,W]=r.useState();r.useEffect(()=>{if(v&&b){const t=v.search(b);W(t)}},[v,b]);const X=r.useCallback(se(t=>{U(t.target.value),window.history.replaceState({},"",`?tab=search&searchTab=${m}&searchText=${t.target.value}`)},500),[]);function P({index:t,style:a,bitasset:s,thisBitassetData:l,thisCollateralAssetData:u}){return e.jsx("div",{style:{...a},children:e.jsxs(V,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(_,{className:"pb-1",children:[e.jsxs(F,{children:[s.issuer.id==="1.2.0"?"Bitasset":"Smartcoin",' "',l.s,'"'," ","(",e.jsx(L,{classnamecontents:"text-blue-500",type:"text",text:l.id,hyperlink:`https://blocksights.info/#/assets/${l.id}`}),")"," created by ",s.issuer.name," ","(",e.jsx(L,{classnamecontents:"text-blue-500",type:"text",text:s.issuer.id,hyperlink:`https://blocksights.info/#/accounts/${s.issuer.id}`}),")"]}),e.jsxs(M,{children:["Backing collateral:",e.jsxs("b",{children:[` ${u.s} `,"(",e.jsx(L,{classnamecontents:"text-blue-500",type:"text",text:u.id,hyperlink:`https://blocksights.info/#/assets/${u.id}`}),")"]})]})]}),e.jsxs(z,{className:"text-sm pb-3",children:[e.jsxs(g,{className:"mr-2 mt-2",children:["Feed qty: ",s.feeds?.length??0]}),e.jsxs(g,{className:"mr-2",children:["MCR: ",s.mcr/10," %"]}),e.jsxs(g,{className:"mr-2",children:["MSSR: ",s.mssr/10," %"]}),e.jsxs(g,{className:"mr-2",children:["ICR: ",s.icr/10," %"]})]}),e.jsx(K,{className:"pb-5",children:e.jsx("a",{href:`/smartcoin/index.html?id=${s.assetID}`,children:e.jsxs(q,{className:"h-8",children:["Proceed to borrow ",l.s]})})})]})},`acard-${s.assetID}`)}const Y=({index:t,style:a})=>e.jsx("div",{style:{...a},children:e.jsxs(V,{className:"ml-2 mr-2",children:[e.jsxs(_,{className:"pb-1",children:[e.jsx(F,{children:'Smartcoin "..." (1.3.x) created by ... (1.2.x)'}),e.jsxs(M,{children:["Backing collateral:",e.jsx("b",{children:" ... (1.3.x)"})]})]}),e.jsxs(z,{className:"text-sm pb-3",children:[e.jsx(g,{className:"mr-2 mt-2",children:"Feed qty: ?"}),e.jsx(g,{className:"mr-2",children:"MCR: ? %"}),e.jsx(g,{className:"mr-2",children:"MSSR: ? %"}),e.jsx(g,{className:"mr-2",children:"ICR: ? %"})]}),e.jsx(K,{className:"pb-5",children:e.jsx(q,{className:"h-8",children:"Proceed to borrow ?"})})]})},`acard-${t}`),I=({index:t,style:a})=>{let s;x==="all"?s=n[t]:x==="compatible"?s=E[t]:x==="holdings"&&(s=y[t]);const l=s&&o?o.find(d=>d.id===s.assetID):null,u=s&&o?o.find(d=>d.id===s.collateral):null;return!s||!l||!u?null:e.jsx(P,{index:t,style:a,bitasset:s,thisBitassetData:l,thisCollateralAssetData:u})},D=({index:t,style:a})=>{let s=i[t].item;const l=o.find(d=>d.id===s.assetID),u=o.find(d=>d.id===s.collateral);return e.jsx(P,{index:t,style:a,bitasset:s,thisBitassetData:l,thisCollateralAssetData:u})};return r.useEffect(()=>{if(v){const t=new URLSearchParams(window.location.search),a=Object.fromEntries(t.entries());if(a&&a.tab){if(!["all","compatible","holdings","search"].includes(a.tab))return;N(a.tab)}else window.history.replaceState({},"","?tab=all");if(a&&a.searchTab){if(!["borrow","collateral","issuer"].includes(a.searchTab))return;C(a.searchTab)}if(a&&a.searchText){if(!(l=>/^[a-zA-Z0-9.-]+$/.test(l))(a.searchText))return;U(a.searchText)}}},[v]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(V,{children:[e.jsxs(_,{children:[e.jsx(F,{children:"ðŸ’µ Select a borrowable asset"}),e.jsxs(M,{children:["There are multiple user & committee created smartcoins on the Bitshares blockchain which you can issue yourself, given you provide and maintain sufficient backing collateral.",e.jsx("br",{}),"Thoroughly research assets before issuing them into existence, know your risk exposure and tolerances."]})]}),e.jsx(z,{children:n&&n.length&&w?e.jsxs(A,{defaultValue:x??"all",className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-4 gap-2",children:[x==="all"?e.jsx(c,{value:"all",style:f,children:"Viewing all assets"}):e.jsx(c,{value:"all",onClick:()=>{N("all"),window.history.replaceState({},"","?tab=all")},children:"View all assets"}),x==="compatible"?e.jsx(c,{value:"compatible",style:f,children:"Viewing compatible"}):e.jsx(c,{value:"compatible",onClick:()=>{N("compatible"),window.history.replaceState({},"","?tab=compatible")},children:"View compatible"}),x==="holdings"?e.jsx(c,{value:"holdings",style:f,children:"Viewing holdings"}):e.jsx(c,{value:"holdings",onClick:()=>{N("holdings"),window.history.replaceState({},"","?tab=holdings")},children:"View holdings"}),x==="search"?e.jsx(c,{value:"search",style:f,children:"Searching"}):e.jsx(c,{value:"search",onClick:()=>{N("search"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:"Search"})]}),e.jsxs(j,{value:"all",children:[e.jsxs("h5",{className:"mb-2 text-center",children:["Listing ",n.length," (all) smartcoins"]}),e.jsx(p,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:I})]}),e.jsxs(j,{value:"compatible",children:[e.jsxs("h5",{className:"mb-2 text-center",children:["Listing ",E.length," smartcoins compatible with your account"]}),e.jsx(p,{height:500,itemCount:E.length,itemSize:200,className:"w-full",children:I})]}),e.jsxs(j,{value:"holdings",children:[e.jsxs("h5",{className:"mb-2 text-center",children:["Listing ",y?y.length:0," held smartcoins"]}),e.jsx(p,{height:500,itemCount:y?y.length:0,itemSize:200,className:"w-full",children:I})]}),e.jsxs(j,{value:"search",children:[e.jsx("h5",{className:"mb-2 text-center",children:"How do you want to search?"}),e.jsxs(A,{defaultValue:m??"borrow",className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-3 gap-2",children:[m==="borrow"?e.jsx(c,{value:"borrow",style:f,children:"Searching by borrowable asset"}):e.jsx(c,{value:"borrow",onClick:()=>{C("borrow"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:"Search by borrowable asset"}),m==="collateral"?e.jsx(c,{value:"collateral",style:f,children:"Searching by collateral assets"}):e.jsx(c,{value:"collateral",onClick:()=>{C("collateral"),window.history.replaceState({},"","?tab=search&searchTab=collateral")},children:"Search by collateral assets"}),m==="issuer"?e.jsx(c,{value:"issuer",style:f,children:"Searching by issuer"}):e.jsx(c,{value:"issuer",onClick:()=>{C("issuer"),window.history.replaceState({},"","?tab=search&searchTab=issuer")},children:"Search by issuer"})]}),e.jsx(te,{name:"searchInput",placeholder:b??"Enter search text",className:"mb-3 mt-3 w-full",onChange:t=>X(t)}),e.jsxs(j,{value:"borrow",children:[i&&i.length?e.jsx(p,{height:500,itemCount:i.length,itemSize:200,className:"w-full",children:D}):null,b&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(j,{value:"collateral",children:[i&&i.length?e.jsx(p,{height:500,itemCount:i.length,itemSize:200,className:"w-full",children:D}):null,b&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(j,{value:"issuer",children:[i&&i.length?e.jsx(p,{height:500,itemCount:i.length,itemSize:200,className:"w-full",children:D}):null,b&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]})]})]})]},`Tabs_${x??""}${m??""}${b??""}`):e.jsxs(A,{defaultValue:"all",className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-4 gap-2",children:[e.jsx(c,{value:"all",style:f,children:"Viewing all assets"}),e.jsx(c,{value:"all",children:"View compatible"}),e.jsx(c,{value:"all",children:"View holdings"}),e.jsx(c,{value:"all",children:"Search"})]}),e.jsxs(j,{value:"all",children:[e.jsx("h5",{className:"mb-2 text-center",children:"Listing ... (all) smartcoins"}),e.jsx(p,{height:500,itemCount:3,itemSize:200,className:"w-full",children:Y})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:h&&h.username&&h.username.length?e.jsx(le,{usr:h}):null})]})})}export{ge as default};
