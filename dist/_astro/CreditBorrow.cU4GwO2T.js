import{I as re,J as ae,u as e,P as se,K as te}from"./button.GNxhEuHR.js";import{r as o}from"./index.ebYJtNMn.js";import{F as C}from"./index.esm.awlXaKq2.js";import{F as le}from"./fuse.aCsZfKX4.js";import{T as D,a as F,c as m,d as p,h as z}from"./common.8EOjqkfr.js";import{$ as U,n as M,o as P,q as L,r as V,u as oe,C as q,b as H,c as J,d as K,m as Z,I as ce,f as ne,p as ie}from"./CurrentUser.-qj3GEkM.js";import{b as de}from"./User.s08ijyOS.js";import"./index.JRs5YgGT.js";function I(S){var t=new Date(S),k=new Date,d=t-k,g=Math.round(d/1e3/60/60);return g}const j={backgroundColor:"#252526",color:"white"},G=S=>/^[a-zA-Z0-9.-]+$/.test(S);function ge(S){const{t,i18n:k}=re(ae.get(),{i18n:se}),d=o.useSyncExternalStore(U.subscribe,U.get,()=>!0),g=o.useSyncExternalStore(M.subscribe,M.get,()=>!0),B=o.useSyncExternalStore(P.subscribe,P.get,()=>!0),y=o.useSyncExternalStore(L.subscribe,L.get,()=>!0),O=o.useSyncExternalStore(V.subscribe,V.get,()=>!0),w=o.useMemo(()=>d&&d.chain?d.chain:"bitshares",[d]);oe(w??"bitshares",["assets","offers"]);const f=o.useMemo(()=>w&&(g||B)?w==="bitshares"?g:B:[],[g,B,w]),h=o.useMemo(()=>w&&(y||O)?w==="bitshares"?y.filter(s=>I(s.auto_disable_time)>=0):O.filter(s=>I(s.auto_disable_time)>=0):[],[y,O,w]),[x,v]=o.useState("allOffers"),[b,T]=o.useState("borrow"),[n,A]=o.useState(),[i,Q]=o.useState(),[he,W]=o.useState(),[$,X]=o.useState([]);o.useEffect(()=>{let s;return d&&d.id&&(s=de([d.chain,d.id]).subscribe(({data:r,error:l,loading:c})=>{r&&!l&&!c&&(X(r.map(u=>u.asset_id)),W(r))})),()=>{s&&s()}},[d]);const _=o.useMemo(()=>!h||!$?[]:h.filter(s=>s.acceptable_collateral.some(a=>$.includes(a[0]))),[h,$]),N=o.useMemo(()=>{if(!h||!h.length||!f||!f.length)return;for(let a=0;a<h.length;a++){const r=h[a];r&&(r.acceptable_collateral&&(r.collateral_symbols=r.acceptable_collateral.map(l=>f.find(u=>u.id===l[0])?.symbol).filter(l=>l)),r.offer_symbols=[f.find(l=>l.id===r.asset_type).symbol])}let s=[];return b==="borrow"?s=["offer_symbols"]:b==="collateral"?s=["collateral_symbols"]:b==="owner_name"&&(s=["owner_name"]),new le(h,{includeScore:!0,threshold:.2,keys:s})},[h,f,b]);o.useEffect(()=>{const s=new URLSearchParams(window.location.search),a=Object.fromEntries(s.entries());let r="",l="",c="",u="?";a&&a.tab&&["allOffers","availableOffers","searchOffers"].includes(a.tab)?(r=a.tab,u+=`tab=${a.tab}`):(r="allOffers",u+="tab=allOffers"),a&&a.tab&&a.tab==="searchOffers"&&a.searchTab&&(["borrow","collateral","owner_name"].includes(a.searchTab)?(l=a.searchTab,u+=`&searchTab=${a.searchTab}`):(l="borrow",u+="&searchTab=borrow")),a&&a.tab&&a.searchTab&&a.tab==="searchOffers"&&a.searchText&&a.searchText.length&&(G(a.searchText)?(c=a.searchText,u+=`&searchText=${a.searchText}`):(c="",u+="&searchText=bts")),v(r),T(l),A(c),window.history.replaceState({},"",u)},[]),o.useEffect(()=>{if(N&&n){if(!G(n))return;window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b??"borrow"}${n?`&searchText=${n}`:""}`);const s=N.search(n);Q(s)}},[N,n]);function E({index:s,style:a,res:r,foundAsset:l}){return e.jsx("div",{style:{...a},children:e.jsxs(q,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(H,{className:"pb-1",children:[e.jsx(J,{children:t("CreditBorrow:common.title",{orderID:r.id.replace("1.21.",""),owner_name:r.owner_name,owner_account:r.owner_account})}),e.jsxs(K,{children:[t("CreditBorrow:common.offering"),e.jsx("b",{children:` ${z(r.current_balance,l.precision)} ${l.symbol} (${r.asset_type})`}),e.jsx("br",{}),t("CreditBorrow:common.accepting"),e.jsx("b",{children:f&&f.length?` ${r.acceptable_collateral.map(c=>c[0]).map(c=>f.find(u=>u.id===c)?.symbol).map(c=>c).join(", ")}`:t("CreditBorrow:common.loading")})]})]}),e.jsx(Z,{className:"text-sm pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:[t("CreditBorrow:common.fee",{fee:r.fee_rate/1e4}),e.jsx("br",{}),t("CreditBorrow:common.repayPeriod",{repayPeriod:(r.max_duration_seconds/60/60).toFixed(r.max_duration_seconds/60/60<1?2:0)})]}),e.jsxs("div",{className:"col-span-1",children:[t("CreditBorrow:common.validity",{validity:I(r.auto_disable_time)}),e.jsx("br",{}),t("CreditBorrow:common.min",{amount:z(r.min_deal_amount,l.precision),asset:l.symbol})]})]})}),e.jsx(ie,{className:"pb-5",children:e.jsx("a",{href:`/offer/index.html?id=${r.id}`,children:e.jsx(te,{children:t("CreditBorrow:common.proceed",{offerID:r.id.replace("1.21.","")})})})})]})},`acard-${r.id}`)}const Y=({index:s,style:a})=>{let r=_[s];const l=f.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:s,style:a,res:r,foundAsset:l})},ee=({index:s,style:a})=>{let r=h[s];const l=f.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:s,style:a,res:r,foundAsset:l})},R=({index:s,style:a})=>{let r=i[s].item;const l=f.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:s,style:a,res:r,foundAsset:l})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(q,{children:[e.jsxs(H,{className:"pb-1",children:[e.jsx(J,{children:t("CreditBorrow:card.title")}),e.jsx(K,{children:t("CreditBorrow:card.description")})]}),e.jsx(Z,{children:h&&h.length&&x?e.jsx(e.Fragment,{children:e.jsxs(D,{defaultValue:x,className:"w-full",children:[e.jsxs(F,{className:"grid w-full grid-cols-3 gap-2",children:[x==="allOffers"?e.jsx(m,{value:"allOffers",style:j,children:t("CreditBorrow:card.viewingAll")}):e.jsx(m,{value:"allOffers",onClick:s=>{v("allOffers"),window.history.replaceState({},"","?tab=allOffers")},children:t("CreditBorrow:card.viewAll")}),x==="availableOffers"?e.jsx(m,{value:"availableOffers",style:j,children:t("CreditBorrow:card.viewingAvailable")}):e.jsx(m,{value:"availableOffers",onClick:s=>{v("availableOffers"),window.history.replaceState({},"","?tab=availableOffers")},children:t("CreditBorrow:card.viewAvailable")}),x==="searchOffers"?e.jsx(m,{value:"searchOffers",style:j,children:t("CreditBorrow:card.viewingSearch")}):e.jsx(m,{value:"searchOffers",onClick:s=>{v("searchOffers"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b}&searchText=${n??""}`)},children:t("CreditBorrow:card.viewSearch")})]}),e.jsxs(p,{value:"allOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:t("CreditBorrow:card.allOffers")}),f&&h&&h.length?e.jsx(C,{height:500,itemCount:h.length,itemSize:225,className:"w-full",children:ee}):null]}),e.jsxs(p,{value:"availableOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:t("CreditBorrow:card.availableOffers")}),f&&_&&_.length?e.jsx(C,{height:500,itemCount:_.length,itemSize:225,className:"w-full",children:Y}):null]}),e.jsxs(p,{value:"searchOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:t("CreditBorrow:card.searchPrompt")}),e.jsxs(D,{defaultValue:b??"borrow",className:"w-full",children:[e.jsxs(F,{className:"grid w-full grid-cols-3 gap-2",children:[b==="borrow"?e.jsx(m,{value:"borrow",style:j,children:t("CreditBorrow:card.borrowSearching")}):e.jsx(m,{value:"borrow",onClick:()=>{T("borrow"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=borrow${n?`&searchText=${n}`:""}`)},children:t("CreditBorrow:card.borrowSearch")}),b==="collateral"?e.jsx(m,{value:"collateral",style:j,children:t("CreditBorrow:card.collateralSearching")}):e.jsx(m,{value:"collateral",onClick:()=>{T("collateral"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=collateral${n?`&searchText=${n}`:""}`)},children:t("CreditBorrow:card.collateralSearch")}),b==="owner_name"?e.jsx(m,{value:"owner_name",style:j,children:t("CreditBorrow:card.ownerSearching")}):e.jsx(m,{value:"owner_name",onClick:()=>{T("owner_name"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=owner_name${n?`&searchText=${n}`:""}`)},children:t("CreditBorrow:card.ownerSearch")})]}),e.jsx(ce,{name:"searchInput",placeholder:n??"Enter search text",className:"mb-3 mt-3 w-full",onChange:s=>{A(s.target.value)}}),e.jsxs(p,{value:"borrow",children:[i&&i.length?e.jsx(C,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:R}):null,n&&i&&!i.length?t("CreditBorrow:card.noResults"):null]}),e.jsxs(p,{value:"collateral",children:[i&&i.length?e.jsx(C,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:R}):null,n&&i&&!i.length?t("CreditBorrow:card.noResults"):null]}),e.jsxs(p,{value:"owner_name",children:[i&&i.length?e.jsx(C,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:R}):null,n&&i&&!i.length?t("CreditBorrow:card.noResults"):null]})]})]})]},`top_tab_${x}`)}):t("CreditBorrow:card.loading")})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:d&&d.username&&d.username.length?e.jsx(ne,{usr:d}):null})]})})}export{ge as default};
