import{I as te,J as ce,u as e,K as S,P as fe,Q as je,S as pe,O as le,T as be,U as ge,V as Te,W as Se,X as Ae,Y as Ne}from"./button.vlNrmCEY.js";import{r as a}from"./index.ebYJtNMn.js";import{u as ve,F as Ce,a as v,b as C,c as D,d as F,f as y,e as X}from"./form.gBCL-LEI.js";import{I as p,C as P,A as J,b as U,c as _,d as I,$ as Y,g as O}from"./input.ujwNKlke.js";import{A as z,a as H}from"./avatar.YGSP5lxv.js";import{f as Z,g as q,d as ee,e as se,b as re,c as ae,u as De}from"./Init.-EQ1T8h4.js";import{h as ne,t as Fe,b as ke}from"./common.dt9OPxkH.js";import{b as Ee}from"./User.acVuNwe_.js";import{D as $e}from"./DeepLinkDialog.vLXO-Wd-.js";import{E as ye}from"./ExternalLink.uAUDuegl.js";import{A as Be}from"./AssetDropDownCard.1IsfCgew.js";import"./index.CMcnyMWn.js";import"./fuse.aCsZfKX4.js";import"./index.esm.BpzG9w8k.js";function we(K){const{chain:r,excludedUsers:R,setChosenAccount:m}=K,{t:i,i18n:M}=te(ce.get(),{i18n:le}),[f,L]=a.useState(),[n,A]=a.useState(),[l,b]=a.useState(!1),[c,k]=a.useState();async function s(){const u=R.map(x=>x.username),N=R.map(x=>x.id);if(u.includes(f)||N.includes(f)){b(!1),A(i("AccountSearch:noSearch.selfError"));return}const j=await fetch(`http://localhost:8080/api/accountLookup/${r}/${f}`,{method:"GET"});if(!j.ok){console.log({error:new Error(`${j.status} ${j.statusText}`),msg:i("AccountSearch:noSearch.error")}),b(!1);return}const g=await j.json();if(g&&g.result){const x=fe(je(g.result,!0)),E=JSON.parse(pe(x));b(!1),k(E);return}b(!1),A(i("AccountSearch:noSearch.error"))}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[c?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:i("AccountSearch:noSearch.prompt")}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(p,{value:f||"",placeholder:i("AccountSearch:noSearch.placeholder"),onKeyDown:u=>{u.key==="Enter"&&!l&&(b(!0),s())},onChange:u=>{/^[a-zA-Z0-9.-]*$/.test(u.target.value)&&(L(u.target.value),A(),k())}}),n?e.jsx("p",{className:"text-red-500 text-xs italic",children:n||"ERROR"}):null]}),e.jsx("div",{className:"col-span-1",children:f?e.jsx(S,{onClick:()=>s(),children:i("AccountSearch:noSearch.continue")}):e.jsx(S,{disabled:!0,children:i("AccountSearch:noSearch.continue")})})]}),c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:i(r==="bitshares"?"AccountSearch:searchResponse.promptBTS":"AccountSearch:searchResponse.promptTEST")}),e.jsx("div",{className:"col-span-1",children:e.jsx(P,{className:"mb-2 mt-1 text-center",onClick:()=>{m({name:c.name,id:c.id})},children:e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pt-6 pl-7",children:e.jsx(J,{size:40,name:c.name,extra:"AS",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(U,{children:[e.jsx(_,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c.name}),e.jsx(I,{children:c.id})]})})]})},c.id)}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{children:e.jsx(S,{variant:"outline",className:"mr-2",onClick:()=>{A(),k()},children:i("AccountSearch:searchResponse.back")})}),e.jsx("div",{className:"text-right",children:e.jsx(S,{variant:"outline",onClick:()=>{m({name:c.name,id:c.id})},children:i("AccountSearch:searchResponse.proceed")})})]})})]}):null]})})}function Qe(K){const{t:r,i18n:R}=te(ce.get(),{i18n:le}),m=ve({defaultValues:{account:""}}),[i,M]=a.useState(!1),[f,L]=a.useState(),[n,A]=a.useState(),[l,b]=a.useState(),[c,k]=a.useState(0);a.useState();const s=a.useSyncExternalStore(Y.subscribe,Y.get,()=>!0),u=a.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),N=a.useSyncExternalStore(q.subscribe,q.get,()=>!0),j=a.useSyncExternalStore(ee.subscribe,ee.get,()=>!0),g=a.useSyncExternalStore(se.subscribe,se.get,()=>!0),x=a.useSyncExternalStore(re.subscribe,re.get,()=>!0),E=a.useSyncExternalStore(ae.subscribe,ae.get,()=>!0),h=a.useMemo(()=>s&&s.chain?s.chain:"bitshares",[s]);De(h??"bitshares",["assets","globalParams","marketSearch"]);const V=a.useMemo(()=>h&&(u||N)?h==="bitshares"?u:N:[],[u,N,h]),ie=a.useMemo(()=>h&&(x||E)?h==="bitshares"?x:E:[],[x,E,h]),B=a.useMemo(()=>h&&(j||g)?h==="bitshares"?j:g:[],[j,g,h]),[W,oe]=a.useState(0);a.useEffect(()=>{if(B&&B.length){const o=B.find(T=>T[0]===0),d=ne(o[1].fee,5);oe(d)}},[B]);const[de,Pe]=a.useState(0),[$,me]=a.useState();a.useEffect(()=>{let o;return s&&s.id&&(o=Ee([s.chain,s.id]).subscribe(({data:T,error:Q,loading:xe})=>{T&&!Q&&!xe&&me(T)})),()=>{o&&o()}},[s,de]);const[t,ue]=a.useState(),w=a.useMemo(()=>l?V.filter(o=>o.symbol===l):[],[l,V]);a.useEffect(()=>{w&&w.length&&ue(w[0])},[w]);const[he,G]=a.useState(!1);return a.useEffect(()=>{f&&L(!1)},[f]),a.useEffect(()=>{n&&G(!1)},[n]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(P,{children:[e.jsxs(U,{children:[e.jsx(_,{children:r("Transfer:transferAssets")}),e.jsxs(I,{children:[e.jsx("p",{children:r("Transfer:sendFundsDescription")}),e.jsx("p",{className:"mt-1",children:r("Transfer:transferLimitations")})]})]}),e.jsxs(O,{children:[e.jsx(Ce,{...m,children:e.jsxs("form",{onSubmit:()=>{M(!0),event.preventDefault()},children:[e.jsx(v,{control:m.control,name:"account",render:({field:o})=>e.jsxs(C,{children:[e.jsx(D,{children:r("Transfer:sendingAccount")}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[e.jsx("div",{className:"col-span-1 ml-5",children:e.jsx(J,{size:40,name:s&&s.username?s.username:"x",extra:"Sender",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-7",children:e.jsx(p,{disabled:!0,className:"mb-1 mt-1",value:`${s&&s.username?s.username:"?"} (${s&&s.id?s.id:"?"})`})})]})}),e.jsx(y,{children:r("Transfer:sendingAccountDescription")})]})}),e.jsx(v,{control:m.control,name:"targetAccount",render:({field:o})=>e.jsxs(C,{children:[e.jsx(D,{children:r("Transfer:targetAccount")}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsx("div",{className:"col-span-1 ml-5",children:n&&n.name?e.jsx(J,{size:40,name:n.name,extra:"Target",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]}):e.jsx(z,{children:e.jsx(H,{children:"?"})})}),e.jsx("div",{className:"col-span-5",children:e.jsx(p,{disabled:!0,placeholder:n&&n.name?`${n.name} (${n.id})`:"Bitshares account (1.2.x)",className:"mb-1 mt-1"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(be,{open:he,onOpenChange:d=>{G(d)},children:[e.jsx(ge,{asChild:!0,children:e.jsx(S,{variant:"outline",className:"ml-3 mt-1",children:r(n?"Transfer:changeTarget":"Transfer:provideTarget")})}),e.jsxs(Te,{className:"sm:max-w-[375px] bg-white",children:[e.jsxs(Se,{children:[e.jsxs(Ae,{children:[!s||!s.chain?r("Transfer:bitsharesAccountSearch"):null,s&&s.chain==="bitshares"?r("Transfer:bitsharesAccountSearchBTS"):null,s&&s.chain!=="bitshares"?r("Transfer:bitsharesAccountSearchTEST"):null]}),e.jsx(Ne,{children:r("Transfer:searchingForAccount")})]}),e.jsx(we,{chain:s&&s.chain?s.chain:"bitshares",excludedUsers:s&&s.username&&s.username.length?[s]:[],setChosenAccount:A})]})]})})]})}),e.jsx(y,{children:!n||!n.name?r("Transfer:targetAccountDescription"):r("Transfer:targetAccountDescriptionWithName",{name:n.name})})]})}),e.jsx(v,{control:m.control,name:"targetAsset",render:({field:o})=>e.jsxs(C,{children:[e.jsx(D,{children:r("Transfer:assetToTransfer")}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsxs("div",{className:"col-span-1 ml-5",children:[!l||!t?e.jsx(z,{children:e.jsx(H,{children:"?"})}):null,t?e.jsx(z,{children:e.jsx(H,{children:e.jsx("div",{className:"text-sm",children:t.bitasset_data_id?"MPA":"UIA"})})}):null]}),e.jsxs("div",{className:"col-span-5",children:[!l||!t?e.jsx(p,{disabled:!0,placeholder:"Bitshares asst (1.3.x)",className:"mb-1 mt-1"}):null,t?e.jsx(p,{disabled:!0,placeholder:`${t.symbol} (${t.id})`,className:"mb-1 mt-1"}):null]}),e.jsx("div",{className:"col-span-2 mt-1 ml-3",children:e.jsx(Be,{assetSymbol:l??"",assetData:null,storeCallback:b,otherAsset:null,marketSearch:ie,type:null})})]})}),e.jsx(y,{children:r("Transfer:assetToTransferDescription")}),e.jsx(X,{children:t&&$&&!$.map(d=>d.asset_id).includes(t.id)?r("Transfer:noAssetInAccount",{username:s.username}):null})]})}),l&&n?e.jsx(v,{control:m.control,name:"transferAmount",render:({field:o})=>e.jsxs(C,{children:[e.jsx(D,{children:r("Transfer:amountAvailableToTransfer",{asset:l??"???"})}),e.jsx(F,{children:e.jsx(p,{disabled:!0,label:r("Transfer:amountAvailableToTransferLabel"),value:t&&$&&$.find(d=>d.asset_id===t.id)?`${ne($.find(d=>d.asset_id===t.id).amount,t.precision)} ${t.symbol}`:"0",className:"mb-1"})}),e.jsx(y,{children:r("Transfer:maximumAmountDescription",{asset:l})})]})}):null,l&&n?e.jsx(v,{control:m.control,name:"transferAmount",render:({field:o})=>e.jsxs(C,{children:[e.jsx(D,{children:r("Transfer:amountToTransfer",{asset:l??"???"})}),e.jsx(F,{onChange:d=>{const T=d.target.value;/^[0-9]*\.?[0-9]*$/.test(T)&&k(T)},children:e.jsx(p,{label:r("Transfer:amountToTransferLabel"),value:c,placeholder:c,className:"mb-1"})}),e.jsx(y,{children:r("Transfer:amountToTransferDescription")})]})}):null,l&&n?e.jsx(v,{control:m.control,name:"networkFee",render:({field:o})=>e.jsxs(C,{children:[e.jsx(D,{children:r("Transfer:networkFee")}),e.jsx(F,{children:e.jsx(p,{disabled:!0,placeholder:`${r("Transfer:networkFeePlaceholder",{fee:W})}`,className:"mb-3 mt-3"})}),s.id===s.referrer?e.jsx(X,{children:r("Transfer:rebate",{rebate:Fe(W*.8,5)})}):null]})}):null,c?e.jsx(S,{className:"mt-5 mb-3",variant:"outline",type:"submit",children:r("Transfer:submit")}):e.jsx(S,{className:"mt-5 mb-3",variant:"outline",disabled:!0,type:"submit",children:r("Transfer:submit")})]})}),i?e.jsx($e,{operationName:"transfer",username:s.username,usrChain:s.chain,userID:s.id,dismissCallback:M,headerText:r("Transfer:sendingHeader",{amount:c,symbol:t.symbol,id:t.id,target:n.name,user:s.username}),trxJSON:[{fee:{amount:0,asset_id:"1.3.0"},from:s.id,to:n.id,amount:{amount:ke(c,t.precision).toFixed(0),asset_id:t.id},extensions:[]}]},`Sending${c}${l}to${n.name}from${s.username}`):null]})]})}),e.jsxs("div",{className:"grid grid-cols-2 mt-5 gap-5",children:[n&&n.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(P,{children:[e.jsxs(U,{className:"pb-0 mb-0",children:[e.jsx(_,{children:r("Transfer:doubleCheckTitle")}),e.jsx(I,{children:r("Transfer:doubleCheckDescription")})]}),e.jsx(O,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:r("Transfer:doubleCheckFormInputs")}),e.jsx("li",{children:r("Transfer:validateBeetPrompt")}),e.jsx("li",{children:e.jsx(ye,{type:"text",classnamecontents:"",hyperlink:`https://blocksights.info/#/accounts/${n.name}`,text:r("Transfer:blocksightsLink",{name:n.name})})})]})})]})}):null,n&&n.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(P,{children:[e.jsxs(U,{className:"pb-0 mb-0",children:[e.jsx(_,{children:r("Transfer:scamAlertTitle")}),e.jsx(I,{children:r("Transfer:scamAlertDescription")})]}),e.jsx(O,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:r("Transfer:scamAlertPoint1")}),e.jsx("li",{children:r("Transfer:scamAlertPoint2")}),e.jsx("li",{children:r("Transfer:scamAlertPoint3")})]})})]})}):null]})]})})}export{Qe as default};
