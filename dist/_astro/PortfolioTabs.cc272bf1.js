import{$ as z,J,u as ce,j as e,C as f,b as j,c as b,d as y,i as B,k as I,B as m,f as de,D as V,y as Q,z as Y,E as G,F as X,G as K}from"./CurrentUser.1e0e4221.js";import{r as l}from"./index.178a5b5e.js";import{F as L}from"./index.esm.60b0ed75.js";import{T as he,a as ue,b as g,c as P,h as E}from"./common.e1bc7670.js";import{S as Z}from"./scroll-area.8e441ca4.js";import{a as me,b as pe}from"./User.fd878bac.js";import{D as xe}from"./DeepLinkDialog.d4274afa.js";import{E as C}from"./ExternalLink.26cefe6b.js";import"./index.6a2b73ba.js";const fe={0:"Transfer",1:"Limit order create",2:"Limit order cancel",3:"Call order update",5:"Account creation",6:"Account update",7:"Account whitelist",8:"Account upgrade",9:"Account transfer",10:"Asset create",11:"Asset update",12:"Asset update bitasset",13:"Asset update feed producers",14:"Asset issue",15:"Asset reserve",16:"Asset fund fee pool",17:"Asset settle",18:"Asset global settle",19:"Asset publish feed",20:"Witness create",21:"Witness update",22:"Proposal create",23:"Proposal update",24:"Proposal delete",25:"Withdraw permission create",26:"Withdraw permission update",27:"Withdraw permission claim",28:"Withdraw permission delete",29:"Committee member create",30:"Committee member update",31:"Committee member update global parameters",32:"Vesting balance create",33:"Vesting balance withdraw",34:"Worker create",35:"Custom operation",36:"Assert",37:"Balance claim",38:"Override transfer",39:"Transfer to blind",40:"Blind transfer",41:"Transfer from blind",43:"Asset claim fees",45:"Collateral bid",47:"Asset claim pool",48:"Asset update issuer",49:"HTLC create",50:"HTLC redeem",52:"HTLC extend",54:"Custom authority create",55:"Custom authority update",56:"Custom authority delete",57:"Ticket create",58:"Ticket update",59:"Create liquidity pool",60:"Delete liquidity pool",61:"Liquidity pool deposit",62:"Liquidity pool withdraw",63:"Liquidity pool exchange",64:"SameT fund create",65:"SameT fund delete",66:"SameT fund update",67:"SameT fund borrow",68:"SameT fund repay",69:"Create credit offer",70:"Delete credit offer",71:"Update credit offer",72:"Accept credit offer",73:"Repay credit deal"};function _e(je){const i=l.useSyncExternalStore(z.subscribe,z.get,()=>!0),S=l.useSyncExternalStore(J.subscribe,J.get,()=>!0);ce(i&&i.chain?i.chain:"bitshares",["assets"]);const N={backgroundColor:"#252526",color:"white"},[A,D]=l.useState("balances"),[k,R]=l.useState(0),[c,q]=l.useState(),[n,F]=l.useState();l.useEffect(()=>{let t;return i&&i.id&&(t=me([i.chain,i.id]).subscribe(({data:s,error:a,loading:d})=>{s&&!a&&!d&&(console.log("Successfully fetched user portfolio"),q(s.balances),F(s.limitOrders))})),()=>{t&&t()}},[i,k]);const[H,ee]=l.useState(0),[v,U]=l.useState();l.useEffect(()=>{let t;return i&&i.id&&(t=pe([i.chain,i.id]).subscribe(({data:s,error:a,loading:d})=>{s&&!a&&!d&&(console.log("Successfully fetched history"),U(s))})),()=>{t&&t()}},[i,H]);const o=l.useMemo(()=>{if(!S||!c)return[];let t=[];for(let r=0;r<(n?.length||0);r++){const s=n[r].sell_price.base.asset_id,a=n[r].sell_price.quote.asset_id;t.includes(s)||t.push(s),t.includes(a)||t.push(a)}for(let r=0;r<(c?.length||0);r++){const s=c[r].asset_id;t.includes(s)||t.push(s)}return S.filter(r=>t.includes(r.id))},[c,n,S]),[M,se]=l.useState(),[te,W]=l.useState(!1),ie=({index:t,style:r})=>{const s=c[t],a=o&&Array.isArray(o)?o.find(h=>h.id===s.asset_id):{symbol:s.asset_id,precision:5},d=E(s.amount,a.precision).toLocaleString(void 0,{minimumFractionDigits:a.precision});return e.jsx("div",{style:{...r,marginBottom:"8px"},children:e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-6",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs(j,{children:[e.jsxs(b,{children:[a.symbol," (",c[t].asset_id,")"]}),e.jsxs(y,{children:["Liquid amount: ",d,e.jsx("br",{})]})]})}),e.jsxs("div",{className:"col-span-2 pt-5",children:[e.jsx("a",{href:`/dex/index.html?market=${a.symbol}_${a.symbol==="BTS"?"USD":"BTS"}`,children:e.jsx(m,{variant:"outline",className:"mr-2",children:"Trade"})}),e.jsx(C,{variant:"outline",classNameContents:"mt-2",type:"button",text:"Asset info",hyperlink:`https://blocksights.info/#/assets/${a.symbol}`})]})]})})})},re=({index:t,style:r})=>{const s=n[t].sell_price.base.amount,a=n[t].sell_price.base.asset_id,d=n[t].sell_price.quote.amount,h=n[t].sell_price.quote.asset_id,x=n[t].id,T=n[t].expiration,p=o&&o.length?o.find(O=>O.id===a):null,u=o&&o.length?o.find(O=>O.id===h):null,w=p?E(s,p.precision):s,_=u?E(d,u.precision):d,$=new Date(T)-new Date,ne=Math.floor($/1e3/60%60),oe=Math.floor($/1e3/60/60%24),le=`${Math.floor($/1e3/60/60/24)}d ${oe}h ${ne}m`;return e.jsx("div",{style:{...r},children:e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-6",children:[e.jsx("div",{className:"col-span-5",children:e.jsxs(j,{children:[e.jsxs(b,{children:["Selling ",w," ",p.symbol," for ",_," ",u.symbol]}),e.jsxs(y,{children:["Trading pair: ",a," for ",h,e.jsx("br",{}),"Order ID:",e.jsx(C,{classNameContents:"text-blue-500",type:"text",text:` ${x}`,hyperlink:`https://blocksights.info/#/objects/${x}`}),e.jsx("br",{}),"Expires: ",le]})]})}),e.jsxs("div",{className:"col-span-1 pt-7",children:[e.jsx("a",{href:`/dex/index.html?market=${p.symbol}_${u.symbol}`,children:e.jsx(m,{variant:"outline",className:"mb-2",children:"Trade"})}),e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",className:"mt-2",onClick:()=>{W(!0),se(x)},children:"Cancel"}),te&&x===M?e.jsx(xe,{operationName:"limit_order_cancel",username:i.username,usrChain:i.chain,userID:i.id,dismissCallback:W,headerText:`Cancelling offer of ${w} ${p.symbol} for ${_} ${u.symbol}`,trxJSON:[{fee_paying_account:i.id,order:M,extensions:[]}]},`Cancelling${w}${p.symbol}for${_}${u.symbol}`):null]})]})]})})})},ae=({index:t,style:r})=>{const s=v[t],a=new Date(s.block_data.block_time),h=new Date-a,x=Math.floor(h/1e3/60%60),T=Math.floor(h/1e3/60/60%24),u=`${Math.floor(h/1e3/60/60/24)}d ${T}h ${x}m`;return e.jsx("div",{style:{...r},children:e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-7",children:[e.jsx("div",{className:"col-span-5",children:e.jsxs(j,{children:[e.jsx(b,{children:fe[s.operation_type.toString()]}),e.jsxs(y,{children:["Operation ID:",e.jsx(C,{classNameContents:"text-blue-500",type:"text",text:` ${s.account_history.operation_id}`,hyperlink:`https://blocksights.info/#/objects/${s.account_history.operation_id}`}),e.jsx("br",{}),"Block number:",e.jsx(C,{classNameContents:"text-blue-500",type:"text",text:` ${s.block_data.block_num}`,hyperlink:`https://blocksights.info/#/blocks/${s.block_data.block_num}`}),e.jsx("br",{}),"Time since broadcast: ",u]})]})}),e.jsxs("div",{className:"col-span-2 mt-7",children:[e.jsxs(V,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"View Operation"})}),e.jsxs(Y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(G,{children:[e.jsx(X,{children:"Operation JSON"}),e.jsx(K,{children:"Check out the contents of this operation"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(Z,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(s.operation_history.op_object,null,2)})})})})]})]}),e.jsxs(V,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(m,{variant:"outline",className:"mt-2",children:"View all"})}),e.jsxs(Y,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(G,{children:[e.jsx(X,{children:"Full operation contents"}),e.jsx(K,{children:"Exhaustive info regarding this operation"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(Z,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(s,null,2)})})})})]})]})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container mx-auto mt-5 mb-5",children:e.jsx("div",{className:"grid grid-cols-1 mt-5",children:e.jsxs(he,{defaultValue:"balances",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-3",children:[A==="balances"?e.jsx(g,{value:"balances",style:N,children:"Balances"}):e.jsx(g,{value:"balances",onClick:()=>D("balances"),children:"Balances"}),A==="openOrders"?e.jsx(g,{value:"openOrders",style:N,children:"Open orders"}):e.jsx(g,{value:"openOrders",onClick:()=>D("openOrders"),children:"Open orders"}),A==="activity"?e.jsx(g,{value:"activity",style:N,children:"Activity"}):e.jsx(g,{value:"activity",onClick:()=>D("activity"),children:"Activity"})]}),e.jsx(P,{value:"balances",children:e.jsxs(f,{children:[e.jsxs(j,{children:[e.jsxs(b,{children:[i.username,"'s account balances"]}),e.jsx(y,{children:"The assets held within your account"})]}),e.jsx(B,{className:"space-y-2",children:c&&c.length&&o&&o.length?e.jsx(L,{height:500,itemCount:c.length,itemSize:100,className:"gaps-2",children:ie}):e.jsx("p",{children:"No balances found"})}),e.jsx(I,{children:e.jsx(m,{onClick:()=>{q(),R(k+1)},children:"Refresh balances"})})]})}),e.jsx(P,{value:"openOrders",children:e.jsxs(f,{children:[e.jsxs(j,{children:[e.jsx(b,{children:"Open orders"}),e.jsx(y,{children:"Your currently open limit orders on the DEX"})]}),e.jsx(B,{children:n&&n.length&&o&&o.length?e.jsx(L,{height:500,itemCount:n.length,itemSize:145,children:re}):e.jsx("p",{children:"No open orders found"})}),e.jsx(I,{children:e.jsx(m,{onClick:()=>{F(),R(k+1)},children:"Refresh open orders"})})]})}),e.jsx(P,{value:"activity",children:e.jsxs(f,{children:[e.jsxs(j,{children:[e.jsx(b,{children:"Recent blockchain activity"}),e.jsx(y,{children:"Your recent blockchain activity"})]}),e.jsx(B,{className:"space-y-2",children:v&&v.length?e.jsx(L,{height:500,itemCount:v.length,itemSize:145,children:ae}):e.jsx("p",{children:"No recent activity found"})}),e.jsx(I,{children:e.jsx(m,{onClick:()=>{U(),ee(H+1)},children:"Refresh recent activity"})})]})})]})})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:i&&i.username&&i.username.length?e.jsx(de,{usr:i}):null})]})}export{_e as default};
