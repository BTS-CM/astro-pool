import{v as ie,w as z,_ as V,x as de,y as X,j as e,z as G,I as b,B as N,C as F,A as O,b as I,c as R,d as L,$ as q,p as J,r as Z,s as Q,u as ue,g as M,D as me,k as he,l as xe,m as fe,n as je,o as pe,f as ge}from"./CurrentUser.6e688dc0.js";import{r as a}from"./index.178a5b5e.js";import{u as be,a as $e,b as w,c as y,d as k,e as D,g as E,f as S}from"./form.b3a2449f.js";import{h as W,t as ve,b as Se}from"./common.6cf182e8.js";import{a as Ne}from"./Pools.63986217.js";import{D as Ae}from"./DeepLinkDialog.bb14202d.js";import{A as Ce}from"./AssetDropDownCard.7e9ba418.js";import"./index.esm.7854a70a.js";const Y="Avatar",[we,He]=ie(Y),[ye,ee]=we(Y),ke=a.forwardRef((o,n)=>{const{__scopeAvatar:c,...i}=o,[d,h]=a.useState("idle");return a.createElement(ye,{scope:c,imageLoadingStatus:d,onImageLoadingStatusChange:h},a.createElement(z.span,V({},i,{ref:n})))}),De="AvatarImage",Be=a.forwardRef((o,n)=>{const{__scopeAvatar:c,src:i,onLoadingStatusChange:d=()=>{},...h}=o,t=ee(De,c),m=_e(i),r=de(j=>{d(j),t.onImageLoadingStatusChange(j)});return X(()=>{m!=="idle"&&r(m)},[m,r]),m==="loaded"?a.createElement(z.img,V({},h,{ref:n,src:i})):null}),Ee="AvatarFallback",Te=a.forwardRef((o,n)=>{const{__scopeAvatar:c,delayMs:i,...d}=o,h=ee(Ee,c),[t,m]=a.useState(i===void 0);return a.useEffect(()=>{if(i!==void 0){const r=window.setTimeout(()=>m(!0),i);return()=>window.clearTimeout(r)}},[i]),t&&h.imageLoadingStatus!=="loaded"?a.createElement(z.span,V({},d,{ref:n})):null});function _e(o){const[n,c]=a.useState("idle");return X(()=>{if(!o){c("error");return}let i=!0;const d=new window.Image,h=t=>()=>{i&&c(t)};return c("loading"),d.onload=h("loaded"),d.onerror=h("error"),d.src=o,()=>{i=!1}},[o]),n}const se=ke,ae=Be,te=Te,U=a.forwardRef(({className:o,...n},c)=>e.jsx(se,{ref:c,className:G("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",o),...n}));U.displayName=se.displayName;const Fe=a.forwardRef(({className:o,...n},c)=>e.jsx(ae,{ref:c,className:G("aspect-square h-full w-full",o),...n}));Fe.displayName=ae.displayName;const P=a.forwardRef(({className:o,...n},c)=>e.jsx(te,{ref:c,className:G("flex h-full w-full items-center justify-center rounded-full bg-muted",o),...n}));P.displayName=te.displayName;function Ie(o){const{chain:n,excludedUsers:c,setChosenAccount:i}=o,[d,h]=a.useState(),[t,m]=a.useState(),[r,j]=a.useState(!1),[u,B]=a.useState();async function s(){const p=c.map($=>$.username),T=c.map($=>$.id);if(p.includes(d)||T.includes(d)){j(!1),m("Cannot transfer assets to this account.");return}const g=await fetch(`http://localhost:8080/api/accountLookup/${n}/${d}`,{method:"GET"});if(!g.ok){console.log({error:new Error(`${g.status} ${g.statusText}`),msg:"Couldn't find account."}),j(!1);return}const A=await g.json();if(A&&A.result){const $=A.result;j(!1),B($);return}j(!1),m("Couldn't find account.")}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[u?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:"Please enter a blockchain account name"}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(b,{value:d||"",placeholder:"Account name or ID",onKeyDown:p=>{p.key==="Enter"&&!r&&(j(!0),s())},onChange:p=>{/^[a-zA-Z0-9.-]*$/.test(p.target.value)&&(h(p.target.value),m(),B())}}),t?e.jsx("p",{className:"text-red-500 text-xs italic",children:t||"ERROR"}):null]}),e.jsx("div",{className:"col-span-1",children:d&&!r?e.jsx(N,{onClick:()=>s(),children:"Continue"}):e.jsx(N,{disabled:!0,children:"Continue"})})]}),u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:n==="bitshares"?"Proceed with the following Bitshares account?":"Proceed with the following Bitshares testnet (TEST) account?"}),e.jsx("div",{className:"col-span-1",children:e.jsx(F,{className:"mb-2 mt-1 text-center",onClick:()=>{i({name:u.name,id:u.id})},children:e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pt-6 pl-7",children:e.jsx(O,{size:40,name:u.name,extra:"AS",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(I,{children:[e.jsx(R,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:u.name}),e.jsx(L,{children:u.id})]})})]})},u.id)}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{children:e.jsx(N,{variant:"outline",className:"mr-2",onClick:()=>{m(),B()},children:"Go back"})}),e.jsx("div",{className:"text-right",children:e.jsx(N,{variant:"outline",onClick:()=>{i({name:u.name,id:u.id})},children:"Proceed"})})]})})]}):null]})})}function Ke(o){const n=be({defaultValues:{account:""}}),[c,i]=a.useState(!1),[d,h]=a.useState(),[t,m]=a.useState(),[r,j]=a.useState(),[u,B]=a.useState(0);a.useState();const s=a.useSyncExternalStore(q.subscribe,q.get,()=>!0),p=a.useSyncExternalStore(J.subscribe,J.get,()=>!0),T=a.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),g=a.useSyncExternalStore(Q.subscribe,Q.get,()=>!0),[A,$]=a.useState(0);a.useEffect(()=>{if(g&&g.parameters){const f=g.parameters.current_fees.parameters.find(v=>v[0]===0);$(W(f[1].fee,5))}},[g]),ue(s&&s.chain?s.chain:"bitshares");const[ne,Re]=a.useState(0),[C,re]=a.useState();a.useEffect(()=>{let x;return s&&s.id&&(x=Ne([s.chain,s.id]).subscribe(({data:v,error:K,loading:oe})=>{v&&!K&&!oe&&re(v)})),()=>{x&&x()}},[s,ne]);const[l,ce]=a.useState(),_=a.useMemo(()=>r?p.filter(x=>x.symbol===r):[],[r,p]);a.useEffect(()=>{_&&_.length&&ce(_[0])},[_]);const[le,H]=a.useState(!1);return a.useEffect(()=>{d&&h(!1)},[d]),a.useEffect(()=>{t&&H(!1)},[t]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(F,{children:[e.jsxs(I,{children:[e.jsx(R,{children:"Transfer assets"}),e.jsxs(L,{children:[e.jsx("p",{children:"Send funds from an account you control to another BitShares account holder."}),e.jsxs("p",{className:"mt-1",children:["⛔ Doesn't yet support a memo, so don't use this form when transfering to external services.",e.jsx("br",{}),"✅ Use for simple transfers between accounts."]})]})]}),e.jsxs(M,{children:[e.jsx($e,{...n,children:e.jsxs("form",{onSubmit:()=>{i(!0),event.preventDefault()},children:[e.jsx(w,{control:n.control,name:"account",render:({field:x})=>e.jsxs(y,{children:[e.jsx(k,{children:"Sending account"}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[e.jsx("div",{className:"col-span-1 ml-5",children:e.jsx(O,{size:40,name:s&&s.username?s.username:"x",extra:"Sender",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-7",children:e.jsx(b,{disabled:!0,placeholder:"Bitshares account (1.2.x)",className:"mb-1 mt-1",value:`${s&&s.username?s.username:"?"} (${s&&s.id?s.id:"?"})`})})]})}),e.jsx(E,{children:"This is the account which will transfer the assets to the target recipient."}),e.jsx(S,{})]})}),e.jsx(w,{control:n.control,name:"targetAccount",render:({field:x})=>e.jsxs(y,{children:[e.jsx(k,{children:"Target account"}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsx("div",{className:"col-span-1 ml-5",children:t&&t.name?e.jsx(O,{size:40,name:t.name,extra:"Target",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]}):e.jsx(U,{children:e.jsx(P,{children:"?"})})}),e.jsx("div",{className:"col-span-5",children:e.jsx(b,{disabled:!0,placeholder:t&&t.name?`${t.name} (${t.id})`:"Bitshares account (1.2.x)",className:"mb-1 mt-1"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(me,{open:le,onOpenChange:f=>{H(f)},children:[e.jsx(he,{asChild:!0,children:e.jsx(N,{variant:"outline",className:"ml-3 mt-1",children:t?"Change target":"Provide target"})}),e.jsxs(xe,{className:"sm:max-w-[375px] bg-white",children:[e.jsxs(fe,{children:[e.jsxs(je,{children:[!s||!s.chain?"Bitshares account search":null,s&&s.chain==="bitshares"?"Bitshares (BTS) account search":null,s&&s.chain!=="bitshares"?"Bitshares testnet (TEST) account search":null]}),e.jsx(pe,{children:"Searching for an account to transfer assets to."})]}),e.jsx(Ie,{chain:s&&s.chain?s.chain:"bitshares",excludedUsers:s&&s.username&&s.username.length?[s]:[],setChosenAccount:m})]})]})})]})}),e.jsx(E,{children:!t||!t.name?"This is the account which will receive your transfer.":`The user ${t.name} will receive your transfer.`}),e.jsx(S,{})]})}),e.jsx(w,{control:n.control,name:"targetAsset",render:({field:x})=>e.jsxs(y,{children:[e.jsx(k,{children:"Asset to transfer"}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsxs("div",{className:"col-span-1 ml-5",children:[!r||!l?e.jsx(U,{children:e.jsx(P,{children:"?"})}):null,l?e.jsx(U,{onClick:()=>console.log("Clicked"),children:e.jsx(P,{children:e.jsx("div",{className:"text-sm",children:l.bitasset_data_id?"MPA":"UIA"})})}):null]}),e.jsxs("div",{className:"col-span-5",children:[!r||!l?e.jsx(b,{disabled:!0,placeholder:"Bitshares asst (1.3.x)",className:"mb-1 mt-1"}):null,l?e.jsx(b,{disabled:!0,placeholder:`${l.symbol} (${l.id})`,className:"mb-1 mt-1"}):null]}),e.jsx("div",{className:"col-span-2 mt-1 ml-3",children:e.jsx(Ce,{assetSymbol:r??"",assetData:null,storeCallback:j,otherAsset:null,marketSearch:T,type:null})})]})}),e.jsx(E,{children:"This is the asset which will be transferred to the target account."}),e.jsx(S,{children:l&&C&&!C.map(f=>f.asset_id).includes(l.id)?`Unable to proceed, your account "${s.username}" doesn't hold any of this asset.`:null})]})}),r&&t?e.jsx(w,{control:n.control,name:"transferAmount",render:({field:x})=>e.jsxs(y,{children:[console.log({foundAsset:l,balances:C}),e.jsx(k,{children:`Amount of ${r??"???"} available to transfer`}),e.jsx(D,{children:e.jsx(b,{disabled:!0,label:"Amount available to transfer",value:l&&C&&C.find(f=>f.asset_id===l.id)?`${W(C.find(f=>f.asset_id===l.id).amount,l.precision)} ${l.symbol}`:"0",className:"mb-1"})}),e.jsxs(E,{children:["This is the maximum amount of ",r," you can transfer."]}),e.jsx(S,{})]})}):null,r&&t?e.jsx(w,{control:n.control,name:"transferAmount",render:({field:x})=>e.jsxs(y,{children:[e.jsx(k,{children:`Amount of ${r??"???"} to transfer`}),e.jsx(D,{onChange:f=>{const v=f.target.value;/^[0-9]*\.?[0-9]*$/.test(v)&&B(v)},children:e.jsx(b,{label:"Amount to transfer",value:u,placeholder:u,className:"mb-1"})}),e.jsx(E,{children:"How much you're going to send to the target account."}),e.jsx(S,{})]})}):null,r&&t?e.jsx(w,{control:n.control,name:"networkFee",render:({field:x})=>e.jsxs(y,{children:[e.jsx(k,{children:"Network fee"}),e.jsx(D,{children:e.jsx(b,{disabled:!0,placeholder:`${A} BTS`,className:"mb-3 mt-3"})}),s.id===s.referrer?e.jsxs(S,{children:["Rebate: ",ve(A*.8,5)," BTS (vesting)"]}):null,e.jsx(S,{})]})}):null,u?e.jsx(N,{className:"mt-5 mb-3",variant:"outline",type:"submit",children:"Submit"}):e.jsx(N,{className:"mt-5 mb-3",variant:"outline",disabled:!0,type:"submit",children:"Submit"})]})}),c?e.jsx(Ae,{operationName:"transfer",username:s.username,usrChain:s.chain,userID:s.id,dismissCallback:i,headerText:`Sending ${u} ${l.symbol} (${l.id}) to ${t.name} from ${s.username}`,trxJSON:[{fee:{amount:0,asset_id:"1.3.0"},from:s.id,to:t.id,amount:{amount:Se(u,l.precision).toFixed(0),asset_id:l.id},extensions:[]}]},`Sending${u}${r}to${t.name}from${s.username}`):null]})]})}),e.jsxs("div",{className:"grid grid-cols-2 mt-5 gap-5",children:[t&&t.name?e.jsx("div",{className:"col-span-1",children:e.jsx("a",{href:`https://blocksights.info/#/accounts/${t.name}`,target:"_blank",children:e.jsxs(F,{children:[e.jsxs(I,{className:"pb-0 mb-0",children:[e.jsx(R,{children:"Double check the above details!"}),e.jsx(L,{children:"Avoid heartbreak, check your inputs!"})]}),e.jsx(M,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Before you proceed, please double check the form inputs."}),e.jsx("li",{children:"Validate the entire Beet prompt contents before you broadcast the transaction."}),e.jsxs("li",{children:["Click here to view ",t.name,"'s account on the Blocksights blockchain explorer."]})]})})]})})}):null,t&&t.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(F,{children:[e.jsxs(I,{className:"pb-0 mb-0",children:[e.jsx(R,{children:"Beware! Don't fall for scams!"}),e.jsx(L,{children:"Be vigilant against scammers!"})]}),e.jsx(M,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Crypto exchanges will NEVER direct message you in with special transfer instructions to follow for deposits nor withdrawals."}),e.jsx("li",{children:"Asset transfer operations are permanent and the majority of assets are irrecoverable if erroneously transferred."}),e.jsx("li",{children:"If something sounds too good to be true, then it likely is, don't fall victim to scammers tricks."})]})})]})}):null]}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:s&&s.username&&s.username.length?e.jsx(ge,{usr:s}):null})]})})}export{Ke as default};
