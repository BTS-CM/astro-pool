import{I as se,J as ae,u as e,K as Q,P as te}from"./button.GNxhEuHR.js";import{r as c}from"./index.ebYJtNMn.js";import{F as v}from"./index.esm.awlXaKq2.js";import{F as re}from"./fuse.aCsZfKX4.js";import{e as le,T as R,a as _,c as i,d as j}from"./common.8EOjqkfr.js";import{$ as q,g as J,h as K,i as O,j as Z,u as ce,C as F,b as z,c as M,d as U,m as H,I as ie,f as ne,p as G}from"./CurrentUser.-qj3GEkM.js";import{B as g}from"./badge.4MPjMHVy.js";import{b as oe}from"./User.s08ijyOS.js";import{E as P}from"./ExternalLink.dfYCZp39.js";import"./index.JRs5YgGT.js";const f={backgroundColor:"#252526",color:"white"};function ve(he){const{t:s,i18n:me}=se(ae.get(),{i18n:te}),m=c.useSyncExternalStore(q.subscribe,q.get,()=>!0),B=c.useSyncExternalStore(J.subscribe,J.get,()=>!0),k=c.useSyncExternalStore(K.subscribe,K.get,()=>!0),A=c.useSyncExternalStore(O.subscribe,O.get,()=>!0),$=c.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),p=c.useMemo(()=>m&&m.chain?m.chain:"bitshares",[m]);ce(p??"bitshares",["bitAssetData","marketSearch"]);const o=c.useMemo(()=>p&&(B||k)?p==="bitshares"?B:k:[],[B,k,p]),h=c.useMemo(()=>p&&(A||$)?p==="bitshares"?A:$:[],[A,$,p]),[w,W]=c.useState();c.useEffect(()=>{let r;return m&&m.id&&(r=oe([m.chain,m.id]).subscribe(({data:a,error:l,loading:d})=>{a&&!l&&!d&&W(a)})),()=>{r&&r()}},[m]);const I=c.useMemo(()=>{if(w&&o&&h)return o.filter(t=>{const a=w.find(l=>l.asset_id===t.collateral);return!(!a||a&&!a.amount>0)})},[w,o,h]),y=c.useMemo(()=>{if(w&&o&&h)return o.filter(t=>!!w.find(l=>l.asset_id===t.assetID))},[w,o,h]),[S,C]=c.useState("all"),[x,N]=c.useState("borrow"),T=c.useMemo(()=>{if(!o||!o.length||!h||!h.length)return;const r=o.map(a=>{const l=h.find(u=>u.id===a.assetID),d=h.find(u=>u.id===a.collateral);return{...a,offer_symbol:l.s,collateral_symbol:d.s,issuerAccount:l.u}});let t;return x==="borrow"?t=["offer_symbol","assetID"]:x==="collateral"?t=["collateral_symbol","collateral"]:x==="issuer"&&(t=["issuerAccount"]),new re(r,{includeScore:!0,threshold:.2,keys:t})},[o,h,x]),[b,V]=c.useState(),[n,X]=c.useState();c.useEffect(()=>{if(T&&b){const r=T.search(b);X(r)}},[T,b]);const Y=c.useCallback(le(r=>{V(r.target.value),window.history.replaceState({},"",`?tab=search&searchTab=${x}&searchText=${r.target.value}`)},500),[]);function L({index:r,style:t,bitasset:a,thisBitassetData:l,thisCollateralAssetData:d}){return e.jsx("div",{style:{...t},children:e.jsxs(F,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(z,{className:"pb-1",children:[e.jsxs(M,{children:[a.issuer.id==="1.2.0"?"Bitasset":"Smartcoin",' "',l.s,'"'," ","(",e.jsx(P,{classnamecontents:"text-blue-500",type:"text",text:l.id,hyperlink:`https://blocksights.info/#/assets/${l.id}`}),")"," ",s("Smartcoins:createdBy")," ",a.issuer.name," ","(",e.jsx(P,{classnamecontents:"text-blue-500",type:"text",text:a.issuer.id,hyperlink:`https://blocksights.info/#/accounts/${a.issuer.id}`}),")"]}),e.jsxs(U,{children:[s("Smartcoins:backingCollateral"),":",e.jsxs("b",{children:[` ${d.s} `,"(",e.jsx(P,{classnamecontents:"text-blue-500",type:"text",text:d.id,hyperlink:`https://blocksights.info/#/assets/${d.id}`}),")"]})]})]}),e.jsxs(H,{className:"text-sm pb-3",children:[e.jsx(g,{className:"mr-2 mt-2",children:s("Smartcoins:feedQty",{qty:a.feeds?.length??0})}),e.jsx(g,{className:"mr-2",children:s("Smartcoins:mcr",{mcr:a.mcr/10})}),e.jsx(g,{className:"mr-2",children:s("Smartcoins:mssr",{mssr:a.mssr/10})}),e.jsx(g,{className:"mr-2",children:s("Smartcoins:icr",{icr:a.icr/10})})]}),e.jsx(G,{className:"pb-5",children:e.jsx("a",{href:`/smartcoin/index.html?id=${a.assetID}`,children:e.jsx(Q,{className:"h-8",children:s("Smartcoins:proceedToBorrow",{asset:l.s})})})})]})},`acard-${a.assetID}`)}const ee=({index:r,style:t})=>e.jsx("div",{style:{...t},children:e.jsxs(F,{className:"ml-2 mr-2",children:[e.jsxs(z,{className:"pb-1",children:[e.jsx(M,{children:s("Smartcoins:placeholderSmartcoinCreated")}),e.jsxs(U,{children:[s("Smartcoins:placeholderBackingCollateral"),e.jsx("b",{children:" ... (1.3.x)"})]})]}),e.jsxs(H,{className:"text-sm pb-3",children:[e.jsx(g,{className:"mr-2 mt-2",children:s("Smartcoins:placeholderFeedQty")}),e.jsx(g,{className:"mr-2",children:s("Smartcoins:placeholderMCR")}),e.jsx(g,{className:"mr-2",children:s("Smartcoins:placeholderMSSR")}),e.jsx(g,{className:"mr-2",children:s("Smartcoins:placeholderICR")})]}),e.jsx(G,{className:"pb-5",children:e.jsx(Q,{className:"h-8",children:s("Smartcoins:placeholderProceedToBorrow")})})]})},`acard-${r}`),D=({index:r,style:t})=>{let a;S==="all"?a=o[r]:S==="compatible"?a=I[r]:S==="holdings"&&(a=y[r]);const l=a&&h?h.find(u=>u.id===a.assetID):null,d=a&&h?h.find(u=>u.id===a.collateral):null;return!a||!l||!d?null:e.jsx(L,{index:r,style:t,bitasset:a,thisBitassetData:l,thisCollateralAssetData:d})},E=({index:r,style:t})=>{let a=n[r].item;const l=h.find(u=>u.id===a.assetID),d=h.find(u=>u.id===a.collateral);return e.jsx(L,{index:r,style:t,bitasset:a,thisBitassetData:l,thisCollateralAssetData:d})};return c.useEffect(()=>{if(T){const r=new URLSearchParams(window.location.search),t=Object.fromEntries(r.entries());if(t&&t.tab){if(!["all","compatible","holdings","search"].includes(t.tab))return;C(t.tab)}else window.history.replaceState({},"","?tab=all");if(t&&t.searchTab){if(!["borrow","collateral","issuer"].includes(t.searchTab))return;N(t.searchTab)}if(t&&t.searchText){if(!(l=>/^[a-zA-Z0-9.-]+$/.test(l))(t.searchText))return;V(t.searchText)}}},[T]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(F,{children:[e.jsxs(z,{children:[e.jsx(M,{children:s("Smartcoins:selectBorrowableAsset")}),e.jsx(U,{children:s("Smartcoins:smartcoinDescription")})]}),e.jsx(H,{children:o&&o.length&&w?e.jsxs(R,{defaultValue:S??"all",className:"w-full",children:[e.jsxs(_,{className:"grid w-full grid-cols-4 gap-2",children:[S==="all"?e.jsx(i,{value:"all",style:f,children:s("Smartcoins:viewingAllAssets")}):e.jsx(i,{value:"all",onClick:()=>{C("all"),window.history.replaceState({},"","?tab=all")},children:s("Smartcoins:viewAllAssets")}),S==="compatible"?e.jsx(i,{value:"compatible",style:f,children:s("Smartcoins:viewingCompatible")}):e.jsx(i,{value:"compatible",onClick:()=>{C("compatible"),window.history.replaceState({},"","?tab=compatible")},children:s("Smartcoins:viewCompatible")}),S==="holdings"?e.jsx(i,{value:"holdings",style:f,children:s("Smartcoins:viewingHoldings")}):e.jsx(i,{value:"holdings",onClick:()=>{C("holdings"),window.history.replaceState({},"","?tab=holdings")},children:s("Smartcoins:viewHoldings")}),S==="search"?e.jsx(i,{value:"search",style:f,children:s("Smartcoins:searching")}):e.jsx(i,{value:"search",onClick:()=>{C("search"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:s("Smartcoins:search")})]}),e.jsxs(j,{value:"all",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingAllSmartcoins",{count:o.length})}),e.jsx(v,{height:500,itemCount:o.length,itemSize:200,className:"w-full",children:D})]}),e.jsxs(j,{value:"compatible",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingCompatibleSmartcoins",{count:I.length})}),e.jsx(v,{height:500,itemCount:I.length,itemSize:200,className:"w-full",children:D})]}),e.jsxs(j,{value:"holdings",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingHeldSmartcoins",{count:y?y.length:0})}),e.jsx(v,{height:500,itemCount:y?y.length:0,itemSize:200,className:"w-full",children:D})]}),e.jsxs(j,{value:"search",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:howToSearch")})," ",e.jsxs(R,{defaultValue:x??"borrow",className:"w-full",children:[e.jsxs(_,{className:"grid w-full grid-cols-3 gap-2",children:[x==="borrow"?e.jsx(i,{value:"borrow",style:f,children:s("Smartcoins:searchingByBorrowable")}):e.jsx(i,{value:"borrow",onClick:()=>{N("borrow"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:s("Smartcoins:searchByBorrowable")}),x==="collateral"?e.jsx(i,{value:"collateral",style:f,children:s("Smartcoins:searchingByCollateral")}):e.jsx(i,{value:"collateral",onClick:()=>{N("collateral"),window.history.replaceState({},"","?tab=search&searchTab=collateral")},children:s("Smartcoins:searchByCollateral")}),x==="issuer"?e.jsx(i,{value:"issuer",style:f,children:s("Smartcoins:searchingByIssuer")}):e.jsx(i,{value:"issuer",onClick:()=>{N("issuer"),window.history.replaceState({},"","?tab=search&searchTab=issuer")},children:s("Smartcoins:searchByIssuer")})]}),e.jsx(ie,{name:"searchInput",placeholder:b??s("Smartcoins:enterSearchText"),className:"mb-3 mt-3 w-full",onChange:r=>Y(r)}),e.jsxs(j,{value:"borrow",children:[n&&n.length?e.jsx(v,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:E}):null,b&&n&&!n.length?e.jsx(e.Fragment,{children:s("Smartcoins:noResultsFound")}):null]}),e.jsxs(j,{value:"collateral",children:[n&&n.length?e.jsx(v,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:E}):null,b&&n&&!n.length?e.jsx(e.Fragment,{children:s("Smartcoins:noResultsFound")}):null]}),e.jsxs(j,{value:"issuer",children:[n&&n.length?e.jsx(v,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:E}):null,b&&n&&!n.length?e.jsx(e.Fragment,{children:s("Smartcoins:noResultsFound")}):null]})]})]})]},`Tabs_${S??""}${x??""}${b??""}`):e.jsxs(R,{defaultValue:"all",className:"w-full",children:[e.jsxs(_,{className:"grid w-full grid-cols-4 gap-2",children:[e.jsx(i,{value:"all",style:f,children:s("Smartcoins:viewingAllAssets")}),e.jsx(i,{value:"all",children:s("Smartcoins:viewCompatible")}),e.jsx(i,{value:"all",children:s("Smartcoins:viewHoldings")}),e.jsx(i,{value:"all",children:s("Smartcoins:search")})]}),e.jsxs(j,{value:"all",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingAllSmartcoins",{count:"..."})}),e.jsx(v,{height:500,itemCount:3,itemSize:200,className:"w-full",children:ee})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:m&&m.username&&m.username.length?e.jsx(ne,{usr:m}):null})]})})}export{ve as default};
