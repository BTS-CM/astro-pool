import{j as e,g as ls,h as ks,C as W,a as X,b as Q,c as q,d as je,I as ue,B as O,i as Ss,_ as ws,e as Me,H as $e,k as Ae,l as _e,$ as Qe,A as Ms,f as $s}from"./AccountSelect.951be928.js";import{r as f}from"./index.d1e52ae9.js";import{S as ye,T as me,a as fe,b as w,c as U}from"./scroll-area.046f6300.js";import{u as As,F as _s,a as le,b as ce,c as oe,d as de,e as he,S as Ts,f as Cs,g as Es,h as Os,i as ge}from"./form.8d8a1d55.js";import{t as re,D as Ve,b as Ye,f as Fs,a as cs,F as Is,h as Se,c as Ds,d as Bs,e as Ls,i as Oe}from"./common.def03558.js";const Rs=ks("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Z({className:n,variant:s,...t}){return e.jsx("div",{className:ls(Rs({variant:s}),n),...t})}function qe(n){const{usr:s,thisAssetA:t,thisAssetB:r,orderType:a,marketSearch:i}=n,{buyOrders:c,sellOrders:l}=n,[o,h]=f.useState(1),[d,m]=f.useState(1),[u,p]=f.useState(0),[b,j]=f.useState(0),[F,$]=f.useState("1hr"),A=As({defaultValues:{account:""}});f.useEffect(()=>{o&&d&&p(o*d)},[o,d]);const[v,R]=f.useState(""),[te,Y]=f.useState(),[N,D]=f.useState(!1),[B,z]=f.useState(!1),[T,g]=f.useState(!1);f.useEffect(()=>{if(T){async function M(){D(!0);var I=new Date;I.setMinutes(I.getMinutes()+60);const L=[{seller:s.id,amount_to_sell:{amount:o,asset_id:a==="buy"?i.find(P=>P.s===t).id:i.find(P=>P.s===r).id},min_to_receive:{amount:u,asset_id:a==="buy"?i.find(P=>P.s===r).id:i.find(P=>P.s===t).id},expiration:I,fill_or_kill:!1,extensions:[]}];Y(L);const E=await fetch(`http://localhost:8080/api/deeplink/${s.chain}/limit_order_create`,{method:"POST",body:JSON.stringify(L)});if(!E.ok){console.log("Failed to generate deeplink");return}const ae=await E.json();ae&&ae.result&&ae.result.generatedDeepLink&&R(ae.result.generatedDeepLink),D(!1)}i&&M()}},[T,t,r,i]);const[K,y]=f.useState(!1),_=()=>{K||(y(!0),setTimeout(()=>{y(!1)},1e4))};return e.jsxs(W,{children:[e.jsxs(X,{className:"pb-2",children:[e.jsx(Q,{children:a==="buy"?`Buying ${t} with ${r}`:`Selling ${t} for ${r}`}),e.jsx(q,{children:"Use this form to create a limit order operation."})]}),e.jsxs(je,{children:[t&&r&&i?e.jsx(_s,{...A,children:e.jsxs("form",{onSubmit:M=>{g(!0),z(!0),M.preventDefault()},children:[e.jsx(le,{control:A.control,name:"sellPrice",render:({field:M})=>e.jsxs(ce,{children:[e.jsx(oe,{children:a==="buy"?`Your price per ${t} in ${r}`:`Your price per ${r} in ${t}`}),e.jsx(de,{onChange:I=>{const L=I.target.value;/^[0-9]*\.?[0-9]*$/.test(L)&&m(L)},children:e.jsx(ue,{value:d,placeholder:d,className:"mb-3"})}),e.jsx(he,{})]})}),e.jsx(le,{control:A.control,name:"sellAmount",render:({field:M})=>e.jsxs(ce,{children:[e.jsx(oe,{children:a==="buy"?`The quantity of ${t} you want to buy`:`The quantity of ${t} you will have to spend`}),e.jsx(de,{onChange:I=>{const L=I.target.value;/^[0-9]*\.?[0-9]*$/.test(L)&&h(L)},children:e.jsx(ue,{value:o,placeholder:o,className:"mb-3"})}),e.jsx(he,{})]})}),e.jsx(le,{control:A.control,name:"sellAmount",render:({field:M})=>e.jsxs(ce,{children:[e.jsx(oe,{children:a==="buy"?`The amount of ${r} you will have to spend`:`The amount of ${r} you will receive`}),e.jsx(de,{onChange:I=>{const L=I.target.value;/^[0-9]*\.?[0-9]*$/.test(L)&&h(L)},children:e.jsx(ue,{value:o,placeholder:o,className:"mb-3"})}),e.jsx(he,{})]})}),e.jsx(le,{control:A.control,disabled:!0,name:"fee",render:({field:M})=>e.jsxs(ce,{children:[e.jsx(oe,{children:"Network fees"}),e.jsx(de,{children:e.jsx(ue,{disabled:!0,label:"fees",value:"0.4826 BTS",placeholder:1})}),e.jsx(he,{})]})}),e.jsx(le,{control:A.control,disabled:!0,name:"marketFees",render:({field:M})=>e.jsxs(ce,{children:[e.jsx(oe,{children:"Market fees"}),e.jsx(de,{children:e.jsx(ue,{disabled:!0,value:`${b} ${r}`,placeholder:`${b} ${r}`})}),e.jsx(he,{})]})}),e.jsx(le,{control:A.control,name:"expiry",render:({field:M})=>e.jsxs(ce,{children:[e.jsx(oe,{children:"Limit order expriration"}),e.jsx(de,{onValueChange:I=>$(I),children:e.jsxs(Ts,{children:[e.jsx(Cs,{className:"mb-3",children:e.jsx(Es,{placeholder:"1hr"})}),e.jsxs(Os,{className:"bg-white",children:[e.jsx(ge,{value:"1hr",children:"1 hour"}),e.jsx(ge,{value:"12hr",children:"12 hours"}),e.jsx(ge,{value:"24hr",children:"24 hours"}),e.jsx(ge,{value:"7d",children:"7 days"}),e.jsx(ge,{value:"30d",children:"30 days"})]})]})}),e.jsx(he,{})]})}),!o||!d||N!==!1?e.jsx(O,{className:"mt-7 mb-1",variant:"outline",disabled:!0,type:"submit",children:"Submit"}):e.jsx(O,{className:"mt-7 mb-1",variant:"outline",type:"submit",children:"Submit"}),a==="buy"&&!l||!l.length||a==="sell"&&!c||!c.length?e.jsx(O,{disabled:!0,variant:"outline",className:"ml-2",children:a==="buy"?"Use lowest ask":"Use highest bid"}):e.jsx(O,{variant:"outline",className:"ml-2",onClick:M=>{if(M.preventDefault(),a==="buy"&&l&&l.length>0){console.log({lowestAsk:l[0]}),m(re(1/l[0].price,8));return}else if(a==="sell"&&c&&c.length>0){console.log({highestBid:c[0]}),m(re(c[0].price,8));return}},children:a==="buy"?"Use lowest ask":"Use highest bid"})]})}):"Loading market data...",B&&T&&v&&e.jsx(Ve,{open:B,onOpenChange:M=>{M||(g(""),R(""),Y()),z(M)},children:e.jsx(Ye,{className:"sm:max-w-[425px] bg-white",children:e.jsxs(e.Fragment,{children:[e.jsxs("h1",{className:"scroll-m-20 text-2xl font-extrabold tracking-tight",children:["Buying ",o," ",t," for ",u," ",r]}),e.jsxs("h3",{className:"scroll-m-20 text-1xl font-semibold tracking-tight mb-3 mt-1",children:["With the account: ",s.username," (",s.id,")",e.jsx("br",{}),"Your Bitshares create limit order operation is ready!",e.jsx("br",{}),"Use the links below to interact with the Beet wallet."]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(O,{color:"gray",className:"w-full",onClick:()=>{Fs(JSON.stringify(te,null,4))},variant:"outline",children:"Copy operation JSON"}),K?e.jsx(O,{variant:"outline",disabled:!0,children:"Downloading..."}):e.jsx("a",{href:`data:text/json;charset=utf-8,${v}`,download:"pool_exchange.json",target:"_blank",rel:"noreferrer",onClick:_,children:e.jsx(O,{variant:"outline",className:"w-full",children:"Download Beet operation JSON"})}),e.jsx("a",{href:`rawbeet://api?chain=BTS&request=${v}`,children:e.jsx(O,{variant:"outline",className:"w-full",children:"Trigger raw Beet deeplink"})})]})]})})})]})]})}const Ie="horizontal",Ps=["horizontal","vertical"],os=f.forwardRef((n,s)=>{const{decorative:t,orientation:r=Ie,...a}=n,i=ds(r)?r:Ie,l=t?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return f.createElement(Ss.div,ws({"data-orientation":i},l,a,{ref:s}))});os.propTypes={orientation(n,s,t){const r=n[s],a=String(r);return r&&!ds(r)?new Error(Hs(a,t)):null}};function Hs(n,s){return`Invalid prop \`orientation\` of value \`${n}\` supplied to \`${s}\`, expected one of:
  - horizontal
  - vertical

Defaulting to \`${Ie}\`.`}function ds(n){return Ps.includes(n)}const hs=os,De=f.forwardRef(({className:n,orientation:s="horizontal",decorative:t=!0,...r},a)=>e.jsx(hs,{ref:a,decorative:t,orientation:s,className:ls("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",n),...r}));De.displayName=hs.displayName;function Ze(n){const{cardType:s,assetA:t,assetAData:r,assetB:a,assetBData:i,buyOrders:c,sellOrders:l,marketInProgress:o,orderBookItr:h,setOrderBookItr:d,_resetOrders:m}=n;return e.jsxs(e.Fragment,{children:[o?e.jsx(W,{children:e.jsxs(X,{children:[e.jsx(Q,{children:"Loading market orders"}),e.jsxs(q,{children:["Fetching requested market data, please wait...",e.jsx("br",{}),e.jsx(O,{className:"mt-5",onClick:()=>d(h+1),children:"Retry request"})]})]})}):null,(s==="buy"&&!c||s==="sell"&&!l)&&!o?e.jsx(W,{children:e.jsxs(X,{children:[e.jsx(Q,{children:"Loading market orders"}),e.jsxs(q,{children:["Failed to fetch market data, please try again.",e.jsx("br",{}),e.jsx(O,{className:"mt-5",onClick:()=>d(h+1),children:"Refresh"})]})]})}):null,(s==="buy"&&c||s==="sell"&&l)&&!o?e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Q,{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("div",{children:[s==="buy"?"Buy":"Sell"," orders"]}),e.jsxs("div",{className:"text-right",children:["Market depth: ",s==="buy"?c.map(u=>parseFloat(u.quote)).reduce((u,p)=>u+p,0).toFixed(i.precision):l.map(u=>parseFloat(u.quote)).reduce((u,p)=>u+p,0).toFixed(r.precision)," (",s==="buy"?i.symbol:r.symbol,")"]})]})}),e.jsx(q,{children:s==="buy"?`The following table displays network offers to purchase ${t} with ${a}`:`The following table displays network offers to sell ${t} for ${a}`})]}),e.jsx(je,{children:s==="buy"&&!c.length||s==="sell"&&!l.length?e.jsxs(e.Fragment,{children:["No ",s==="buy"?"buy":"sell"," limit orders found"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pl-3",children:"Price"}),e.jsx("div",{className:"col-span-1 pl-3 text-md",children:s==="buy"?"Buying":"Selling"}),e.jsx("div",{className:"col-span-1 pl-3",children:s==="buy"?"Selling":"Buying"}),e.jsx("div",{className:"col-span-1 pl-3",children:"Total"})]}),e.jsx(ye,{className:"h-72 w-full rounded-md border",children:e.jsx("div",{className:"grid grid-cols-4",children:s==="buy"?c.map((u,p)=>e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"grid grid-cols-4 text-sm",children:[e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:parseFloat(1/u.price).toFixed(r.precision)}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:u.base}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:u.quote}),e.jsx("div",{className:"col-span-1 pl-3",children:c.slice(0,p+1).map(b=>parseFloat(b.base)).reduce((b,j)=>b+j,0).toFixed(r.precision)}),e.jsx("div",{className:"col-span-4",children:e.jsx(De,{})})]})},`moc_${s}_${p}`)):l.map((u,p)=>e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"grid grid-cols-4 text-sm",children:[e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:parseFloat(1/u.price).toFixed(i.precision)}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:u.base}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:u.quote}),e.jsx("div",{className:"col-span-1 pl-3",children:l.slice(0,p+1).map(b=>parseFloat(b.base)).reduce((b,j)=>b+j,0).toFixed(r.precision)}),e.jsx("div",{className:"col-span-4",children:e.jsx(De,{})})]})},`moc_${s}_${p}`))})})]})}),e.jsx(Me,{children:e.jsx(O,{onClick:()=>{m(),d(h+1)},children:"Refresh"})})]}):null]})}function se(n){return Array.isArray?Array.isArray(n):fs(n)==="[object Array]"}const Us=1/0;function Vs(n){if(typeof n=="string")return n;let s=n+"";return s=="0"&&1/n==-Us?"-0":s}function Ys(n){return n==null?"":Vs(n)}function ee(n){return typeof n=="string"}function us(n){return typeof n=="number"}function Js(n){return n===!0||n===!1||zs(n)&&fs(n)=="[object Boolean]"}function ms(n){return typeof n=="object"}function zs(n){return ms(n)&&n!==null}function V(n){return n!=null}function Fe(n){return!n.trim().length}function fs(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const Ks="Incorrect 'index' type",Gs=n=>`Invalid value for key ${n}`,Ws=n=>`Pattern length exceeds max of ${n}.`,Xs=n=>`Missing ${n} property in key`,Qs=n=>`Property 'weight' in key '${n}' must be a positive integer`,es=Object.prototype.hasOwnProperty;class qs{constructor(s){this._keys=[],this._keyMap={};let t=0;s.forEach(r=>{let a=xs(r);t+=a.weight,this._keys.push(a),this._keyMap[a.id]=a,t+=a.weight}),this._keys.forEach(r=>{r.weight/=t})}get(s){return this._keyMap[s]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function xs(n){let s=null,t=null,r=null,a=1,i=null;if(ee(n)||se(n))r=n,s=ss(n),t=Be(n);else{if(!es.call(n,"name"))throw new Error(Xs("name"));const c=n.name;if(r=c,es.call(n,"weight")&&(a=n.weight,a<=0))throw new Error(Qs(c));s=ss(c),t=Be(c),i=n.getFn}return{path:s,id:t,weight:a,src:r,getFn:i}}function ss(n){return se(n)?n:n.split(".")}function Be(n){return se(n)?n.join("."):n}function Zs(n,s){let t=[],r=!1;const a=(i,c,l)=>{if(V(i))if(!c[l])t.push(i);else{let o=c[l];const h=i[o];if(!V(h))return;if(l===c.length-1&&(ee(h)||us(h)||Js(h)))t.push(Ys(h));else if(se(h)){r=!0;for(let d=0,m=h.length;d<m;d+=1)a(h[d],c,l+1)}else c.length&&a(h,c,l+1)}};return a(n,ee(s)?s.split("."):s,0),r?t:t[0]}const et={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},st={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,s)=>n.score===s.score?n.idx<s.idx?-1:1:n.score<s.score?-1:1},tt={location:0,threshold:.6,distance:100},rt={useExtendedSearch:!1,getFn:Zs,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var x={...st,...et,...tt,...rt};const nt=/[^ ]+/g;function it(n=1,s=3){const t=new Map,r=Math.pow(10,s);return{get(a){const i=a.match(nt).length;if(t.has(i))return t.get(i);const c=1/Math.pow(i,.5*n),l=parseFloat(Math.round(c*r)/r);return t.set(i,l),l},clear(){t.clear()}}}class Je{constructor({getFn:s=x.getFn,fieldNormWeight:t=x.fieldNormWeight}={}){this.norm=it(t,3),this.getFn=s,this.isCreated=!1,this.setIndexRecords()}setSources(s=[]){this.docs=s}setIndexRecords(s=[]){this.records=s}setKeys(s=[]){this.keys=s,this._keysMap={},s.forEach((t,r)=>{this._keysMap[t.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,ee(this.docs[0])?this.docs.forEach((s,t)=>{this._addString(s,t)}):this.docs.forEach((s,t)=>{this._addObject(s,t)}),this.norm.clear())}add(s){const t=this.size();ee(s)?this._addString(s,t):this._addObject(s,t)}removeAt(s){this.records.splice(s,1);for(let t=s,r=this.size();t<r;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(s,t){return s[this._keysMap[t]]}size(){return this.records.length}_addString(s,t){if(!V(s)||Fe(s))return;let r={v:s,i:t,n:this.norm.get(s)};this.records.push(r)}_addObject(s,t){let r={i:t,$:{}};this.keys.forEach((a,i)=>{let c=a.getFn?a.getFn(s):this.getFn(s,a.path);if(V(c)){if(se(c)){let l=[];const o=[{nestedArrIndex:-1,value:c}];for(;o.length;){const{nestedArrIndex:h,value:d}=o.pop();if(V(d))if(ee(d)&&!Fe(d)){let m={v:d,i:h,n:this.norm.get(d)};l.push(m)}else se(d)&&d.forEach((m,u)=>{o.push({nestedArrIndex:u,value:m})})}r.$[i]=l}else if(ee(c)&&!Fe(c)){let l={v:c,n:this.norm.get(c)};r.$[i]=l}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function ps(n,s,{getFn:t=x.getFn,fieldNormWeight:r=x.fieldNormWeight}={}){const a=new Je({getFn:t,fieldNormWeight:r});return a.setKeys(n.map(xs)),a.setSources(s),a.create(),a}function at(n,{getFn:s=x.getFn,fieldNormWeight:t=x.fieldNormWeight}={}){const{keys:r,records:a}=n,i=new Je({getFn:s,fieldNormWeight:t});return i.setKeys(r),i.setIndexRecords(a),i}function we(n,{errors:s=0,currentLocation:t=0,expectedLocation:r=0,distance:a=x.distance,ignoreLocation:i=x.ignoreLocation}={}){const c=s/n.length;if(i)return c;const l=Math.abs(r-t);return a?c+l/a:l?1:c}function lt(n=[],s=x.minMatchCharLength){let t=[],r=-1,a=-1,i=0;for(let c=n.length;i<c;i+=1){let l=n[i];l&&r===-1?r=i:!l&&r!==-1&&(a=i-1,a-r+1>=s&&t.push([r,a]),r=-1)}return n[i-1]&&i-r>=s&&t.push([r,i-1]),t}const ie=32;function ct(n,s,t,{location:r=x.location,distance:a=x.distance,threshold:i=x.threshold,findAllMatches:c=x.findAllMatches,minMatchCharLength:l=x.minMatchCharLength,includeMatches:o=x.includeMatches,ignoreLocation:h=x.ignoreLocation}={}){if(s.length>ie)throw new Error(Ws(ie));const d=s.length,m=n.length,u=Math.max(0,Math.min(r,m));let p=i,b=u;const j=l>1||o,F=j?Array(m):[];let $;for(;($=n.indexOf(s,b))>-1;){let N=we(s,{currentLocation:$,expectedLocation:u,distance:a,ignoreLocation:h});if(p=Math.min(N,p),b=$+d,j){let D=0;for(;D<d;)F[$+D]=1,D+=1}}b=-1;let A=[],v=1,R=d+m;const te=1<<d-1;for(let N=0;N<d;N+=1){let D=0,B=R;for(;D<B;)we(s,{errors:N,currentLocation:u+B,expectedLocation:u,distance:a,ignoreLocation:h})<=p?D=B:R=B,B=Math.floor((R-D)/2+D);R=B;let z=Math.max(1,u-B+1),T=c?m:Math.min(u+B,m)+d,g=Array(T+2);g[T+1]=(1<<N)-1;for(let y=T;y>=z;y-=1){let _=y-1,M=t[n.charAt(_)];if(j&&(F[_]=+!!M),g[y]=(g[y+1]<<1|1)&M,N&&(g[y]|=(A[y+1]|A[y])<<1|1|A[y+1]),g[y]&te&&(v=we(s,{errors:N,currentLocation:_,expectedLocation:u,distance:a,ignoreLocation:h}),v<=p)){if(p=v,b=_,b<=u)break;z=Math.max(1,2*u-b)}}if(we(s,{errors:N+1,currentLocation:u,expectedLocation:u,distance:a,ignoreLocation:h})>p)break;A=g}const Y={isMatch:b>=0,score:Math.max(.001,v)};if(j){const N=lt(F,l);N.length?o&&(Y.indices=N):Y.isMatch=!1}return Y}function ot(n){let s={};for(let t=0,r=n.length;t<r;t+=1){const a=n.charAt(t);s[a]=(s[a]||0)|1<<r-t-1}return s}class gs{constructor(s,{location:t=x.location,threshold:r=x.threshold,distance:a=x.distance,includeMatches:i=x.includeMatches,findAllMatches:c=x.findAllMatches,minMatchCharLength:l=x.minMatchCharLength,isCaseSensitive:o=x.isCaseSensitive,ignoreLocation:h=x.ignoreLocation}={}){if(this.options={location:t,threshold:r,distance:a,includeMatches:i,findAllMatches:c,minMatchCharLength:l,isCaseSensitive:o,ignoreLocation:h},this.pattern=o?s:s.toLowerCase(),this.chunks=[],!this.pattern.length)return;const d=(u,p)=>{this.chunks.push({pattern:u,alphabet:ot(u),startIndex:p})},m=this.pattern.length;if(m>ie){let u=0;const p=m%ie,b=m-p;for(;u<b;)d(this.pattern.substr(u,ie),u),u+=ie;if(p){const j=m-ie;d(this.pattern.substr(j),j)}}else d(this.pattern,0)}searchIn(s){const{isCaseSensitive:t,includeMatches:r}=this.options;if(t||(s=s.toLowerCase()),this.pattern===s){let b={isMatch:!0,score:0};return r&&(b.indices=[[0,s.length-1]]),b}const{location:a,distance:i,threshold:c,findAllMatches:l,minMatchCharLength:o,ignoreLocation:h}=this.options;let d=[],m=0,u=!1;this.chunks.forEach(({pattern:b,alphabet:j,startIndex:F})=>{const{isMatch:$,score:A,indices:v}=ct(s,b,j,{location:a+F,distance:i,threshold:c,findAllMatches:l,minMatchCharLength:o,includeMatches:r,ignoreLocation:h});$&&(u=!0),m+=A,$&&v&&(d=[...d,...v])});let p={isMatch:u,score:u?m/this.chunks.length:1};return u&&r&&(p.indices=d),p}}class ne{constructor(s){this.pattern=s}static isMultiMatch(s){return ts(s,this.multiRegex)}static isSingleMatch(s){return ts(s,this.singleRegex)}search(){}}function ts(n,s){const t=n.match(s);return t?t[1]:null}class dt extends ne{constructor(s){super(s)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(s){const t=s===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class ht extends ne{constructor(s){super(s)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(s){const r=s.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,s.length-1]}}}class ut extends ne{constructor(s){super(s)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(s){const t=s.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class mt extends ne{constructor(s){super(s)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(s){const t=!s.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,s.length-1]}}}class ft extends ne{constructor(s){super(s)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(s){const t=s.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[s.length-this.pattern.length,s.length-1]}}}class xt extends ne{constructor(s){super(s)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(s){const t=!s.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,s.length-1]}}}class js extends ne{constructor(s,{location:t=x.location,threshold:r=x.threshold,distance:a=x.distance,includeMatches:i=x.includeMatches,findAllMatches:c=x.findAllMatches,minMatchCharLength:l=x.minMatchCharLength,isCaseSensitive:o=x.isCaseSensitive,ignoreLocation:h=x.ignoreLocation}={}){super(s),this._bitapSearch=new gs(s,{location:t,threshold:r,distance:a,includeMatches:i,findAllMatches:c,minMatchCharLength:l,isCaseSensitive:o,ignoreLocation:h})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(s){return this._bitapSearch.searchIn(s)}}class ys extends ne{constructor(s){super(s)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(s){let t=0,r;const a=[],i=this.pattern.length;for(;(r=s.indexOf(this.pattern,t))>-1;)t=r+i,a.push([r,t-1]);const c=!!a.length;return{isMatch:c,score:c?0:1,indices:a}}}const Le=[dt,ys,ut,mt,xt,ft,ht,js],rs=Le.length,pt=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,gt="|";function jt(n,s={}){return n.split(gt).map(t=>{let r=t.trim().split(pt).filter(i=>i&&!!i.trim()),a=[];for(let i=0,c=r.length;i<c;i+=1){const l=r[i];let o=!1,h=-1;for(;!o&&++h<rs;){const d=Le[h];let m=d.isMultiMatch(l);m&&(a.push(new d(m,s)),o=!0)}if(!o)for(h=-1;++h<rs;){const d=Le[h];let m=d.isSingleMatch(l);if(m){a.push(new d(m,s));break}}}return a})}const yt=new Set([js.type,ys.type]);class bt{constructor(s,{isCaseSensitive:t=x.isCaseSensitive,includeMatches:r=x.includeMatches,minMatchCharLength:a=x.minMatchCharLength,ignoreLocation:i=x.ignoreLocation,findAllMatches:c=x.findAllMatches,location:l=x.location,threshold:o=x.threshold,distance:h=x.distance}={}){this.query=null,this.options={isCaseSensitive:t,includeMatches:r,minMatchCharLength:a,findAllMatches:c,ignoreLocation:i,location:l,threshold:o,distance:h},this.pattern=t?s:s.toLowerCase(),this.query=jt(this.pattern,this.options)}static condition(s,t){return t.useExtendedSearch}searchIn(s){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:a}=this.options;s=a?s:s.toLowerCase();let i=0,c=[],l=0;for(let o=0,h=t.length;o<h;o+=1){const d=t[o];c.length=0,i=0;for(let m=0,u=d.length;m<u;m+=1){const p=d[m],{isMatch:b,indices:j,score:F}=p.search(s);if(b){if(i+=1,l+=F,r){const $=p.constructor.type;yt.has($)?c=[...c,...j]:c.push(j)}}else{l=0,i=0,c.length=0;break}}if(i){let m={isMatch:!0,score:l/i};return r&&(m.indices=c),m}}return{isMatch:!1,score:1}}}const Re=[];function vt(...n){Re.push(...n)}function Pe(n,s){for(let t=0,r=Re.length;t<r;t+=1){let a=Re[t];if(a.condition(n,s))return new a(n,s)}return new gs(n,s)}const Te={AND:"$and",OR:"$or"},He={PATH:"$path",PATTERN:"$val"},Ue=n=>!!(n[Te.AND]||n[Te.OR]),Nt=n=>!!n[He.PATH],kt=n=>!se(n)&&ms(n)&&!Ue(n),ns=n=>({[Te.AND]:Object.keys(n).map(s=>({[s]:n[s]}))});function bs(n,s,{auto:t=!0}={}){const r=a=>{let i=Object.keys(a);const c=Nt(a);if(!c&&i.length>1&&!Ue(a))return r(ns(a));if(kt(a)){const o=c?a[He.PATH]:i[0],h=c?a[He.PATTERN]:a[o];if(!ee(h))throw new Error(Gs(o));const d={keyId:Be(o),pattern:h};return t&&(d.searcher=Pe(h,s)),d}let l={children:[],operator:i[0]};return i.forEach(o=>{const h=a[o];se(h)&&h.forEach(d=>{l.children.push(r(d))})}),l};return Ue(n)||(n=ns(n)),r(n)}function St(n,{ignoreFieldNorm:s=x.ignoreFieldNorm}){n.forEach(t=>{let r=1;t.matches.forEach(({key:a,norm:i,score:c})=>{const l=a?a.weight:null;r*=Math.pow(c===0&&l?Number.EPSILON:c,(l||1)*(s?1:i))}),t.score=r})}function wt(n,s){const t=n.matches;s.matches=[],V(t)&&t.forEach(r=>{if(!V(r.indices)||!r.indices.length)return;const{indices:a,value:i}=r;let c={indices:a,value:i};r.key&&(c.key=r.key.src),r.idx>-1&&(c.refIndex=r.idx),s.matches.push(c)})}function Mt(n,s){s.score=n.score}function $t(n,s,{includeMatches:t=x.includeMatches,includeScore:r=x.includeScore}={}){const a=[];return t&&a.push(wt),r&&a.push(Mt),n.map(i=>{const{idx:c}=i,l={item:s[c],refIndex:c};return a.length&&a.forEach(o=>{o(i,l)}),l})}class xe{constructor(s,t={},r){this.options={...x,...t},this.options.useExtendedSearch,this._keyStore=new qs(this.options.keys),this.setCollection(s,r)}setCollection(s,t){if(this._docs=s,t&&!(t instanceof Je))throw new Error(Ks);this._myIndex=t||ps(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(s){V(s)&&(this._docs.push(s),this._myIndex.add(s))}remove(s=()=>!1){const t=[];for(let r=0,a=this._docs.length;r<a;r+=1){const i=this._docs[r];s(i,r)&&(this.removeAt(r),r-=1,a-=1,t.push(i))}return t}removeAt(s){this._docs.splice(s,1),this._myIndex.removeAt(s)}getIndex(){return this._myIndex}search(s,{limit:t=-1}={}){const{includeMatches:r,includeScore:a,shouldSort:i,sortFn:c,ignoreFieldNorm:l}=this.options;let o=ee(s)?ee(this._docs[0])?this._searchStringList(s):this._searchObjectList(s):this._searchLogical(s);return St(o,{ignoreFieldNorm:l}),i&&o.sort(c),us(t)&&t>-1&&(o=o.slice(0,t)),$t(o,this._docs,{includeMatches:r,includeScore:a})}_searchStringList(s){const t=Pe(s,this.options),{records:r}=this._myIndex,a=[];return r.forEach(({v:i,i:c,n:l})=>{if(!V(i))return;const{isMatch:o,score:h,indices:d}=t.searchIn(i);o&&a.push({item:i,idx:c,matches:[{score:h,value:i,norm:l,indices:d}]})}),a}_searchLogical(s){const t=bs(s,this.options),r=(l,o,h)=>{if(!l.children){const{keyId:m,searcher:u}=l,p=this._findMatches({key:this._keyStore.get(m),value:this._myIndex.getValueForItemAtKeyId(o,m),searcher:u});return p&&p.length?[{idx:h,item:o,matches:p}]:[]}const d=[];for(let m=0,u=l.children.length;m<u;m+=1){const p=l.children[m],b=r(p,o,h);if(b.length)d.push(...b);else if(l.operator===Te.AND)return[]}return d},a=this._myIndex.records,i={},c=[];return a.forEach(({$:l,i:o})=>{if(V(l)){let h=r(t,l,o);h.length&&(i[o]||(i[o]={idx:o,item:l,matches:[]},c.push(i[o])),h.forEach(({matches:d})=>{i[o].matches.push(...d)}))}}),c}_searchObjectList(s){const t=Pe(s,this.options),{keys:r,records:a}=this._myIndex,i=[];return a.forEach(({$:c,i:l})=>{if(!V(c))return;let o=[];r.forEach((h,d)=>{o.push(...this._findMatches({key:h,value:c[d],searcher:t}))}),o.length&&i.push({idx:l,item:c,matches:o})}),i}_findMatches({key:s,value:t,searcher:r}){if(!V(t))return[];let a=[];if(se(t))t.forEach(({v:i,i:c,n:l})=>{if(!V(i))return;const{isMatch:o,score:h,indices:d}=r.searchIn(i);o&&a.push({score:h,key:s,value:i,idx:c,norm:l,indices:d})});else{const{v:i,n:c}=t,{isMatch:l,score:o,indices:h}=r.searchIn(i);l&&a.push({score:o,key:s,value:i,norm:c,indices:h})}return a}}xe.version="6.6.2";xe.createIndex=ps;xe.parseIndex=at;xe.config=x;xe.parseQuery=bs;vt(bt);function is(n){const{assetSymbol:s,assetData:t,storeCallback:r,otherAsset:a,marketSearch:i,type:c}=n,l=new xe(i.filter(j=>j.s!==a&&j.s!==s),{includeScore:!0,keys:["id","s","u"]}),[o,h]=f.useState(),[d,m]=f.useState(),[u,p]=f.useState(!1);f.useEffect(()=>{if(o){const j=l.search(o);m(j)}},[o]);const b=({index:j,style:F})=>{const $=d[j];return e.jsx("div",{style:{...F,marginBottom:"10px",paddingRight:"10px"},children:e.jsx(W,{style:{marginBottom:"2px"},onClick:()=>{r($.item.s),p(!1)},children:e.jsxs(X,{className:"p-3",children:[e.jsxs(Q,{className:"h-3",children:[$.item.s," (",$.item.id,")"]}),e.jsxs(q,{children:["Issued by ",$.item.u]})]})},`acard-${$.item.id}`)})};return s&&t?e.jsxs(Ve,{open:u,onOpenChange:j=>{j||m(),p(j)},children:[e.jsx(cs,{asChild:!0,children:e.jsxs($e,{children:[e.jsx(Ae,{asChild:!0,style:{position:"relative"},children:e.jsx(O,{variant:"outline",className:"h-5 p-3",onClick:()=>p(!0),children:s.length<12?s:t.id})}),e.jsxs(_e,{className:"w-60 text-md text-center",children:[s," (",t.id,")"]})]})}),e.jsx(Ye,{className:"sm:max-w-[425px] bg-white",children:e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-2xl font-extrabold tracking-tight",children:["Replacing ",s]}),e.jsx("h4",{className:"text-md font-bold tracking-tight",children:c==="base"?"Please select a new base asset":"Please select a new quote asset"}),e.jsx(ue,{name:"assetSearch",placeholder:"Search for an asset",onChange:j=>{console.log("input changed"),h(j.target.value)}}),d&&d.length?e.jsx(e.Fragment,{children:e.jsx(Is,{height:200,itemCount:d.length,itemSize:70,className:"w-full",children:b})}):null]})})]}):null}function as(n){const{asset:s,assetData:t,assetDetails:r,marketSearch:a,chain:i,usrBalances:c,type:l}=n,[o,h]=f.useState(0);return f.useEffect(()=>{if(t&&c){const d=t.id,m=c.find(u=>u.asset_id===d);if(m){const u=Se(m.amount,t.precision).toLocaleString(void 0,{minimumFractionDigits:t.precision});h(u)}}},[t,c]),e.jsxs($e,{children:[e.jsx(Ae,{asChild:!0,style:{position:"relative"},children:e.jsx(W,{children:e.jsxs(X,{children:[e.jsx(Q,{children:e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-5 w-full",children:[e.jsxs("div",{className:"col-span-1",children:[s," ",t?`(${t.id})`:""]}),e.jsxs("div",{className:"col-span-1 text-right",children:[l==="buy"?"Base":"Quote"," asset"]})]})})}),e.jsxs(q,{children:[r?null:"Please wait...",r&&t&&a?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 w-full",children:[e.jsxs("div",{className:"col-span-1",children:["Your balance:",e.jsxs(Z,{variant:"outline",className:"ml-2",children:[o," ",s]})]}),e.jsxs("div",{className:"col-span-1",children:["Issuer:",e.jsx(Z,{variant:"outline",className:"ml-2",children:a.find(d=>d.id===t.id).u})]}),e.jsxs("div",{className:"col-span-1",children:["Market fee:",e.jsxs(Z,{variant:"outline",className:"ml-2",children:[t.market_fee_percent/100," %"]})]}),e.jsxs("div",{className:"col-span-1",children:["Precision:",e.jsx(Z,{variant:"outline",className:"ml-2",children:t.precision})]})]})}):null]})]})})}),e.jsxs(_e,{className:"w-80 text-sm",style:{position:"absolute",top:"100%",marginLeft:"-160px"},children:[e.jsxs("b",{children:[s," supply info"]}),e.jsx("br",{}),r&&t?Se(r.current_supply,t.precision).toLocaleString(void 0,{minimumFractionDigits:t.precision}):"???"," ",s," in total circulation",e.jsx("br",{}),r&&t?Se(t.max_supply,t.precision).toLocaleString(void 0,{minimumFractionDigits:t.precision}):"???"," maximum supply",e.jsx("br",{}),r&&t?Se(r.confidential_supply,t.precision):"???"," ",s," in confidential supply",e.jsx("br",{}),e.jsxs("div",{className:"grid grid-cols-2 gap-5 w-full mt-3",children:[e.jsx("a",{target:"_blank",href:i==="bitshares"?`https://blocksights.info/#/assets/${s}`:`https://blocksights.info/#/assets/${s}?network=testnet`,children:e.jsx(O,{variant:"outline",className:"w-full",children:"🔗 Explore"})}),e.jsxs(Ve,{children:[e.jsx(cs,{asChild:!0,children:e.jsx(O,{variant:"outline",className:"w-full",children:"📄 View JSON"})}),e.jsxs(Ye,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(Ds,{children:[e.jsxs(Bs,{children:[s," JSON summary data"]}),e.jsxs(Ls,{children:["The data used for generating ",s," limit orders."]})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(ye,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify({assetData:t,assetDetails:r},null,2)})})})})]})]})]})]})]})}function At(n){const{assetAData:s,assetBData:t,usr:r,marketItr:a,setMarketItr:i,usrLimitOrders:c,usrHistory:l,publicMarketHistory:o,_resetMarketData:h}=n,[d,m]=f.useState(!1);f.useEffect(()=>{o&&m(!1)},[o]);function u({}){return e.jsx(O,{onClick:()=>{h(),m(!0),i(a+1)},children:"Refresh"})}function p({type:g}){const K=o.filter(y=>y.type===g);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 pl-3 text-md",children:[e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-1",children:[e.jsx("div",{className:"col-span-1",children:"Price"}),e.jsxs("div",{className:"col-span-1 text-sm",children:[s.symbol,"/",t.symbol]})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-1",children:[e.jsx("div",{className:"col-span-1",children:"Amount"}),e.jsx("div",{className:"col-span-1 text-sm",children:s.symbol})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-1",children:[e.jsx("div",{className:"col-span-1",children:"Date"}),e.jsx("div",{className:"col-span-1 text-sm",children:"Time since trade"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-1",children:[e.jsx("div",{className:"col-span-1",children:"Total value"}),e.jsx("div",{className:"col-span-1 text-sm",children:t.symbol})]})})]}),e.jsx(ye,{className:"h-72 w-full rounded-md border",children:e.jsx("div",{className:"grid grid-cols-4",children:K.map((y,_)=>{const I=y.price.split(".").length>1?re(y.price,g==="buy"?s.precision:t.precision):y.price;return e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"grid grid-cols-4 text-sm",children:[e.jsx("div",{className:"col-span-1 border-r-2 border-b-2 pl-3",children:I}),e.jsx("div",{className:"col-span-1 border-r-2 border-b-2 pl-3",children:y.amount}),e.jsx("div",{className:"col-span-1 border-r-2 border-b-2 pl-3",children:Oe(y.date)}),e.jsx("div",{className:"col-span-1 border-r-2 border-b-2 pl-3",children:y.value})]})},`ms_${_}_${g}`)})})})]})}function b({type:g}){const K=l.filter(y=>y.type===g);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pl-3",children:"Price"}),e.jsx("div",{className:"col-span-1 pl-3 text-md",children:"Amount"}),e.jsx("div",{className:"col-span-1 pl-3",children:"Date"}),e.jsx("div",{className:"col-span-1 pl-3",children:"Total value"})]}),e.jsx(ye,{className:"h-72 w-full rounded-md border",children:e.jsx("div",{className:"grid grid-cols-4",children:K.map((y,_)=>{const I=y.value.split(".").length>1?re(y.price,g==="buy"?s.precision:t.precision):y.price;return e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"grid grid-cols-4 text-sm",children:[e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:I}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:y.for_sale}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:Oe(y.date)}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:y.value})]})},`mts_${_}_${g}`)})})})]})}function j({type:g}){const K=g==="buy"?s:t,y=c.filter(_=>limitOrder.sell_price.base.asset_id===K.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("div",{className:"col-span-1 pl-3",children:"Price"}),e.jsx("div",{className:"col-span-1 pl-3 text-md",children:"Amount"}),e.jsx("div",{className:"col-span-1 pl-3",children:"Date"})]}),e.jsx(ye,{className:"h-72 w-full rounded-md border",children:e.jsx("div",{className:"grid grid-cols-3",children:y.length?y.map((_,M)=>{const L=_.value.split(".").length>1?re(_.sell_price.base.amount/_.sell_price.quote.amount,g==="buy"?s.precision:t.precision):_.price;return e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"grid grid-cols-4 text-sm",children:[e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:L}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:_.for_sale}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:Oe(_.date)}),e.jsx("div",{className:"col-span-1 border-r-2 pl-3",children:_.value})]})},`mos_${M}_${g}`)}):e.jsx("p",{children:g==="buy"?"You have no open buy orders in this market":"You have no sell orders in this market"})})})]})}function F({type:g}){return e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Q,{children:g==="buy"?"Completed buy orders":"Completed sell orders"}),e.jsx(q,{children:g==="buy"?"Recently completed buy orders on the Bitshares DEX":"Recently completed sell orders on the Bitshares DEX"})]}),e.jsxs(je,{className:"space-y-2",children:[(!o||!o.length)&&!d?g==="buy"?e.jsx(e.Fragment,{children:"No recently completed purchases found"}):e.jsx(e.Fragment,{children:"No recently completed sales found"}):null,(!o||!o.length)&&d?e.jsx(e.Fragment,{children:"🌐 Fetching market history, please wait..."}):null,o&&o.length?e.jsx(p,{type:g}):null]}),e.jsx(Me,{children:e.jsx(u,{})})]})}function $({type:g}){return e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Q,{children:g==="buy"?"Completed buy orders":"Completed sell orders"}),e.jsx(q,{children:g==="buy"?"Your recently completed buy orders":"Your recently completed sell orders"})]}),e.jsxs(je,{className:"space-y-2",children:[(!l||!l.length)&&!d?g==="buy"?e.jsx(e.Fragment,{children:"No recently completed purchases found"}):e.jsx(e.Fragment,{children:"No recently completed sales found"}):null,(!l||!l.length)&&d?e.jsx(e.Fragment,{children:"🌐 Fetching market history, please wait..."}):null,l&&l.length?e.jsx(b,{type:g}):null]}),e.jsx(Me,{children:e.jsx(u,{})})]})}function A({type:g}){return e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Q,{children:g==="buy"?"My open buy orders":"My open sell orders"}),e.jsx(q,{children:g==="buy"?`Your open buy limit orders for the market ${s.symbol}/${t.symbol}`:`Your open sell limit orders for the market ${s.symbol}/${t.symbol}`})]}),e.jsxs(je,{className:"space-y-2",children:[(!c||!c.length)&&!d?g==="buy"?e.jsx(e.Fragment,{children:"No open buy orders found"}):e.jsx(e.Fragment,{children:"No open sell orders found"}):null,(!c||!c.length)&&d?e.jsx(e.Fragment,{children:"🌐 Fetching market history, please wait..."}):null,l&&l.length?e.jsx(j,{type:g}):g==="buy"?"You have no open buy orders in this market":"You have no sell orders in this market"]}),e.jsx(Me,{children:e.jsx(u,{})})]})}const[v,R]=f.useState("marketTrades"),[te,Y]=f.useState("buy"),[N,D]=f.useState("buy"),[B,z]=f.useState("buy"),T={backgroundColor:"#252526",color:"white"};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 mt-5",children:e.jsxs(me,{defaultValue:"marketTrades",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3 gap-2",children:[v==="marketTrades"?e.jsx(w,{value:"marketTrades",style:T,children:"Market trades"}):e.jsx(w,{value:"marketTrades",onClick:()=>R("marketTrades"),children:"Market trades"}),v==="usrHistory"?e.jsx(w,{value:"usrHistory",style:T,children:"Your trades"}):e.jsx(w,{value:"usrHistory",onClick:()=>R("usrHistory"),children:"Your trades"}),v==="usrLimitOrders"?e.jsx(w,{value:"usrLimitOrders",style:T,children:"Your open orders"}):e.jsx(w,{value:"usrLimitOrders",onClick:()=>R("usrLimitOrders"),children:"Your open orders"})]}),e.jsx(U,{value:"marketTrades",children:e.jsxs(me,{defaultValue:"buy",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 gap-2",children:[te==="buy"?e.jsx(w,{value:"buy",style:T,children:"Buy orders"}):e.jsx(w,{value:"buy",onClick:()=>Y("buy"),children:"Buy orders"}),te==="sell"?e.jsx(w,{value:"sell",style:T,children:"Sell orders"}):e.jsx(w,{value:"sell",onClick:()=>Y("sell"),children:"Sell orders"})]}),e.jsx(U,{value:"buy",children:e.jsx(F,{type:"buy"})}),e.jsx(U,{value:"sell",children:e.jsx(F,{type:"sell"})})]})}),e.jsx(U,{value:"usrHistory",children:e.jsxs(me,{defaultValue:"buy",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 gap-2",children:[N==="buy"?e.jsx(w,{value:"buy",style:T,children:"Your purchases"}):e.jsx(w,{value:"buy",onClick:()=>D("buy"),children:"Your purchases"}),N==="sell"?e.jsx(w,{value:"sell",style:T,children:"Your sales"}):e.jsx(w,{value:"sell",onClick:()=>D("sell"),children:"Your sales"})]}),e.jsx(U,{value:"buy",children:e.jsx($,{type:"buy"})}),e.jsx(U,{value:"sell",children:e.jsx($,{type:"sell"})})]})}),e.jsx(U,{value:"usrLimitOrders",children:e.jsxs(me,{defaultValue:"buy",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 gap-2",children:[B==="buy"?e.jsx(w,{value:"buy",style:T,children:"Your buy orders"}):e.jsx(w,{value:"buy",onClick:()=>z("buy"),children:"Your buy orders"}),B==="sell"?e.jsx(w,{value:"sell",style:T,children:"Your sell orders"}):e.jsx(w,{value:"sell",onClick:()=>z("sell"),children:"Your sell orders"})]}),e.jsx(U,{value:"buy",children:e.jsx(A,{type:"buy"})}),e.jsx(U,{value:"sell",children:e.jsx(A,{type:"sell"})})]})})]})})})}function Ft(n){const[s,t]=f.useState();f.useEffect(()=>Qe.subscribe(S=>{t(S)}),[Qe]);const[r,a]=f.useState([]);f.useEffect(()=>{async function C(){const S=await fetch(`http://localhost:8080/cache/marketSearch/${s.chain}`,{method:"GET"});if(!S.ok){console.log("Failed to fetch cached data");return}const k=await S.json();k&&a(k)}s&&s.chain&&C()},[s]);const[i,c]=f.useState(window.location.search?null:"BTS"),[l,o]=f.useState(window.location.search?null:"USD");f.useEffect(()=>{async function C(){if(window.location.search){console.log("Parsing market parameters");const S=new URLSearchParams(window.location.search),ve=Object.fromEntries(S.entries()).market;let H=ve.split("_")[0].toUpperCase(),J=ve.split("_")[1].toUpperCase();H&&J&&J.length&&H===J&&(J=H==="BTS"?"USD":"BTS",console.log("Invalid market parameters - replaced quote asset."));const Ne=r.map(G=>G.s),ke=r.map(G=>G.id);if((!H||!H.length||!Ne.includes(H)&&!ke.includes(H))&&(console.log("Asset A replaced with default."),c("BTS")),!i){const G=r.find(pe=>pe.id===H||pe.s===H);G?(console.log("Setting asset A."),c(G.s)):(console.log("Setting default asset A"),c("BTS"))}if((!J||!J.length||!Ne.includes(J)&&!ke.includes(J))&&(console.log("Asset B replaced with default."),o(i!=="USD"?"USD":"BTS")),!l){const G=r.find(pe=>pe.id===J||pe.s===J);if(G){console.log("Setting asset B."),o(G.s);return}else console.log("Setting default asset B"),o(H!=="BTS"&&H!=="1.3.0"?"BTS":"USD")}}}r&&r.length&&C()},[r]);const[h,d]=f.useState([]),[m,u]=f.useState([]),[p,b]=f.useState(null),[j,F]=f.useState(0),[$,A]=f.useState(!1),[v,R]=f.useState(null),[te,Y]=f.useState(null),[N,D]=f.useState(null),[B,z]=f.useState(null),[T,g]=f.useState(),[K,y]=f.useState(),[_,M]=f.useState(),[I,L]=f.useState(),[E,ae]=f.useState(),[P,Ce]=f.useState(0),[ze,Ke]=f.useState("buy"),[Ge,We]=f.useState("buy");function vs(){R(null),Y(null)}function Ns(){D(null),z(null)}function Xe(){d(),u()}function Ee(){g(),y(),L(),M()}if(f.useEffect(()=>{async function C(){if(p&&p===`${l}_${i}`){console.log("Avoid duplicate call"),A(!1);return}const S=await fetch(`http://localhost:8080/api/orderBook/${s.chain}/${i}/${l}`,{method:"GET"});if(!S.ok){console.log("Failed to fetch market orders"),A(!1),j<5&&F(j+1);return}const k=await S.json();k&&k.result&&(console.log(`Fetched market data for ${i}_${l}`),d(k.result.asks),u(k.result.bids),b(`${i}_${l}`)),A(!1)}i&&l&&s&&s.chain&&(A(!0),window.history.replaceState({},"",`?market=${i}_${l}`),C())},[i,l,s,j]),f.useEffect(()=>{async function C(){const S=await fetch(`http://localhost:8080/cache/asset/${s.chain}/${i}`,{method:"GET"});if(!S.ok){console.log("Failed to fetch asset A");return}const k=await S.json();k&&k.result&&(console.log("Fetched asset A data"),R(k.result))}i&&s&&s.chain&&(vs(),Ee(),C())},[i,s]),f.useEffect(()=>{async function C(){const S=await fetch(`http://localhost:8080/cache/dynamic/${s.chain}/${v.id.replace("1.3.","2.3.")}`,{method:"GET"});if(!S.ok){console.log(`Failed to fetch ${i} dynamic data`);return}const k=await S.json();k&&k.result&&(console.log(`Fetched ${i} dynamic data`),Y(k.result))}v&&s&&s.chain&&C()},[v]),f.useEffect(()=>{async function C(){const S=await fetch(`http://localhost:8080/cache/asset/${s.chain}/${l}`,{method:"GET"});if(!S.ok){console.log("Failed to fetch asset B");return}const k=await S.json();k&&k.result&&(console.log("Fetched asset B data"),D(k.result))}l&&s&&s.chain&&(Ns(),Ee(),C())},[l,s]),f.useEffect(()=>{async function C(){const S=await fetch(`http://localhost:8080/cache/dynamic/${s.chain}/${N.id.replace("1.3.","2.3.")}`,{method:"GET"});if(!S.ok){console.log(`Failed to fetch ${l} dynamic data`);return}const k=await S.json();k&&k.result&&(console.log(`Fetched ${l} dynamic data`),z(k.result))}N&&s&&s.chain&&C()},[N]),f.useEffect(()=>{async function C(){const S=await fetch(`http://localhost:8080/api/getMarketHistory/${s.chain}/${v.id}/${N.id}/${s.id}`,{method:"GET"});if(!S.ok){console.log("Failed to fetch market history"),P<5&&Ce(P+1);return}const k=await S.json();if(k&&k.result){console.log("Fetched market history");const{result:ve}=k,{balances:H,marketHistory:J,accountLimitOrders:Ne,usrTrades:ke,ticker:G}=ve;g(H),y(Ne),L(J),M(ke),ae(G)}}v&&N&&(console.log("Fetching market history"),C())},[v,N,s,P]),f.useEffect(()=>{if(i&&l&&s&&s.chain){const C=setInterval(()=>{Ce(P+1),F(j+1)},3e4);return()=>clearInterval(C)}},[i,l,s]),!s||!s.id||!s.id.length)return e.jsx(Ms,{});const be={backgroundColor:"#252526",color:"white"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[!r&&!i&&!l?"loading...":null,e.jsxs(me,{defaultValue:"buy",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 gap-2",children:[ze==="buy"?e.jsx(w,{value:"buy",style:be,children:"Buy"}):e.jsx(w,{value:"buy",onClick:()=>Ke("buy"),children:"Buy"}),ze==="sell"?e.jsx(w,{value:"sell",style:be,children:"Sell"}):e.jsx(w,{value:"sell",onClick:()=>Ke("sell"),children:"Sell"})]}),e.jsx(U,{value:"buy",children:e.jsx(qe,{usr:s,thisAssetA:i,thisAssetB:l,buyOrders:h,sellOrders:m,orderType:"buy",marketSearch:r},"buyLimit")}),e.jsx(U,{value:"sell",children:e.jsx(qe,{usr:s,thisAssetA:i,thisAssetB:l,buyOrders:h,sellOrders:m,orderType:"sell",marketSearch:r},"sellLimit")})]}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(W,{style:{maxHeight:"80px"},children:e.jsxs(X,{className:"pt-2",children:[e.jsxs(Q,{className:"text-center text-lg",children:[s.chain==="bitshares"?"Bitshares":"Bitshares (Testnet)"," DEX Market controls"]}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx(is,{assetSymbol:i,assetData:v,storeCallback:c,otherAsset:l,marketSearch:r,type:"quote"}),e.jsxs($e,{children:[e.jsx(Ae,{asChild:!0,style:{position:"relative"},children:e.jsx(O,{variant:"outline",className:"h-5 ml-1 mr-1 p-3",onClick:()=>{const C=i;c(l),o(C);const S=h;d(m),u(S)},children:"⇄"})}),e.jsx(_e,{className:"w-40 text-md text-center",children:"Swap asset order"})]}),e.jsx(is,{assetSymbol:l,assetData:N,storeCallback:o,otherAsset:i,marketSearch:r,type:"base"})]})})]})})}),e.jsx("div",{className:"flex-grow",children:e.jsxs($e,{children:[e.jsx(Ae,{asChild:!0,style:{position:"relative"},children:e.jsx(W,{children:e.jsx(X,{className:"pt-2",children:e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx("div",{className:"col-span-1 mb-1",children:e.jsxs(Q,{className:"text-center text-lg",children:[i,"/",l," Market summary"]})}),E?null:e.jsx("div",{className:"text-center",children:"Loading..."}),E&&v?e.jsxs("div",{className:"col-span-1",children:["Latest price:",e.jsx(Z,{variant:"outline",className:"ml-2",children:re(E.latest,v.precision)})]}):null,E?e.jsxs("div",{className:"col-span-1",children:["24Hr change:",e.jsx(Z,{variant:"outline",className:"ml-2",children:E.percent_change})]}):null,E?e.jsxs("div",{className:"col-span-1",children:["24Hr base volume:",e.jsx(Z,{variant:"outline",className:"ml-2",children:E.base_volume})]}):null,E?e.jsxs("div",{className:"col-span-1",children:["24Hr quote volume:",e.jsx(Z,{variant:"outline",className:"ml-2",children:E.quote_volume})]}):null,E&&v?e.jsxs("div",{className:"col-span-1",children:["Lowest ask:",e.jsx(Z,{variant:"outline",className:"ml-2",children:re(E.lowest_ask,v.precision)})]}):null,E&&v?e.jsxs("div",{className:"col-span-1",children:["Highest bid:",e.jsx(Z,{variant:"outline",className:"ml-2",children:re(E.highest_bid,v.precision)})]}):null]})})})})}),e.jsxs(_e,{className:"w-80 text-sm text-center",children:[e.jsxs("b",{children:[i,"/",l," Market links"]}),e.jsx("br",{}),e.jsx("a",{href:s.chain==="bitshares"?`https://blocksights.info/#/markets/${i}/${l}`:`https://blocksights.info/#/markets/${i}/${l}?network=testnet`,target:"_blank",children:e.jsxs(O,{variant:"outline",className:"mb-2 mt-2",children:[i,"/",l," Market explorer"]})}),s.chain==="bitshares"?e.jsx("a",{href:`https://bts.exchange/#/market/${i}_${l}?r=nftprofessional1`,target:"_blank",children:e.jsx(O,{variant:"outline",className:"ml-2",children:"BTS.Exchange"})}):null]})]})}),e.jsx("div",{className:"flex-grow",style:{paddingBottom:"0px"},children:e.jsx(as,{asset:i,assetData:v,assetDetails:te,marketSearch:r,chain:s.chain,usrBalances:T,type:"buy"})}),e.jsx("div",{className:"flex-grow",children:e.jsx(as,{asset:l,assetData:N,assetDetails:B,marketSearch:r,chain:s.chain,usrBalances:T,type:"sell"})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-5 mt-5",children:v&&N?e.jsx(e.Fragment,{children:e.jsxs(me,{defaultValue:"buy",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 gap-1",children:[Ge==="buy"?e.jsx(w,{value:"buy",style:be,children:"Buy"}):e.jsx(w,{value:"buy",onClick:()=>We("buy"),children:"Buy"}),Ge==="sell"?e.jsx(w,{value:"sell",style:be,children:"Sell"}):e.jsx(w,{value:"sell",onClick:()=>We("sell"),children:"Sell"})]}),e.jsx(U,{value:"buy",children:e.jsx(Ze,{cardType:"buy",assetA:i,assetAData:v,assetB:l,assetBData:N,buyOrders:h,sellOrders:m,marketInProgress:$,orderBookItr:j,setOrderBookItr:F,_resetOrders:Xe})}),e.jsx(U,{value:"sell",children:e.jsx(Ze,{cardType:"sell",assetA:i,assetAData:v,assetB:l,assetBData:N,buyOrders:h,sellOrders:m,marketInProgress:$,orderBookItr:j,setOrderBookItr:F,_resetOrders:Xe})})]})}):null}),i&&l?e.jsx(At,{assetAData:v,assetBData:N,usr:s,marketItr:P,setMarketItr:Ce,usrLimitOrders:K,publicMarketHistory:I,usrHistory:_,_resetMarketData:Ee}):null]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(O,{className:"mt-5",onClick:()=>{$s()},children:"Switch account/chain"})})]})}export{Ft as default};
