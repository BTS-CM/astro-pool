import{u as e,I as u,O as Q,P as Y,Q as X,S as G,T as K,U as Z}from"./button.gDHZ9QV2.js";import{r as n}from"./index.vR8cGMCg.js";import{F as I}from"./index.esm.ysaRy2yh.js";import{$ as ee,o as se,p as te,u as me,C as f,b,c as j,d as y,m as P,n as U,f as pe}from"./CurrentUser.JfssIRBN.js";import{T as xe,a as fe,c as g,e as q,h as H}from"./common.oHu2IIZP.js";import{S as re}from"./scroll-area.5BDBXE1H.js";import{a as be,b as je}from"./User.PSirryGZ.js";import{D as ye}from"./DeepLinkDialog.gediKe-e.js";import{E as S}from"./ExternalLink.PiX5tK9K.js";import"./index.Iv-N6sBm.js";import"./index.f2GGseSc.js";const ge={0:"Transfer",1:"Limit order create",2:"Limit order cancel",3:"Call order update",4:"Limit order filled",5:"Account creation",6:"Account update",7:"Account whitelist",8:"Account upgrade",9:"Account transfer",10:"Asset create",11:"Asset update",12:"Asset update bitasset",13:"Asset update feed producers",14:"Asset issue",15:"Asset reserve",16:"Asset fund fee pool",17:"Asset settle",18:"Asset global settle",19:"Asset publish feed",20:"Witness create",21:"Witness update",22:"Proposal create",23:"Proposal update",24:"Proposal delete",25:"Withdraw permission create",26:"Withdraw permission update",27:"Withdraw permission claim",28:"Withdraw permission delete",29:"Committee member create",30:"Committee member update",31:"Committee member update global parameters",32:"Vesting balance create",33:"Vesting balance withdraw",34:"Worker create",35:"Custom operation",36:"Assert",37:"Balance claim",38:"Override transfer",39:"Transfer to blind",40:"Blind transfer",41:"Transfer from blind",42:"Asset settle cancel",43:"Asset claim fees",44:"FBA distribute",45:"Collateral bid",46:"Execute bid",47:"Asset claim pool",48:"Asset update issuer",49:"HTLC create",50:"HTLC redeem",51:"HTLC redeemed",52:"HTLC extend",53:"HTLC refund",54:"Custom authority create",55:"Custom authority update",56:"Custom authority delete",57:"Ticket create",58:"Ticket update",59:"Create liquidity pool",60:"Delete liquidity pool",61:"Liquidity pool deposit",62:"Liquidity pool withdraw",63:"Liquidity pool exchange",64:"SameT fund create",65:"SameT fund delete",66:"SameT fund update",67:"SameT fund borrow",68:"SameT fund repay",69:"Create credit offer",70:"Delete credit offer",71:"Update credit offer",72:"Accept credit offer",73:"Repay credit deal",74:"Credit deal expired",75:"Update liquidity pool",76:"Update credit deal",77:"Update limit order"};function Ie(s){const i=n.useSyncExternalStore(ee.subscribe,ee.get,(()=>!0)),t=n.useSyncExternalStore(se.subscribe,se.get,(()=>!0)),r=n.useSyncExternalStore(te.subscribe,te.get,(()=>!0)),l=n.useMemo((()=>i&&i.chain?i.chain:"bitshares"),[i]),a=n.useMemo((()=>l&&(t||r)?"bitshares"===l?t:r:[]),[t,r,l]);me(l??"bitshares",["assets"]);const c={backgroundColor:"#252526",color:"white"},[o,d]=n.useState("balances"),[h,m]=n.useState(0),[x,p]=n.useState(),[v,C]=n.useState();n.useEffect((()=>{let e;return i&&i.id&&(e=be([i.chain,i.id]).subscribe((({data:e,error:s,loading:i})=>{e&&!s&&!i&&(console.log("Successfully fetched user portfolio"),p(e.balances),C(e.limitOrders))}))),()=>{e&&e()}}),[i,h]);const[N,k]=n.useState(0),[_,A]=n.useState();n.useEffect((()=>{let e;return i&&i.id&&(e=je([i.chain,i.id]).subscribe((({data:e,error:s,loading:i})=>{e&&!s&&!i&&(console.log("Successfully fetched history"),A(e))}))),()=>{e&&e()}}),[i,N]);const $=n.useMemo((()=>{if(!a||!x)return[];let e=[];for(let s=0;s<(v?.length||0);s++){const i=v[s].sell_price.base.asset_id,t=v[s].sell_price.quote.asset_id;e.includes(i)||e.push(i),e.includes(t)||e.push(t)}for(let s=0;s<(x?.length||0);s++){const i=x[s].asset_id;e.includes(i)||e.push(i)}return a.filter((s=>e.includes(s.id)))}),[x,v,a]),[T,w]=n.useState(),[O,D]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container mx-auto mt-5 mb-5",children:e.jsx("div",{className:"grid grid-cols-1 mt-5",children:e.jsxs(xe,{defaultValue:"balances",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3",children:["balances"===o?e.jsx(g,{value:"balances",style:c,children:"Balances"}):e.jsx(g,{value:"balances",onClick:()=>d("balances"),children:"Balances"}),"openOrders"===o?e.jsx(g,{value:"openOrders",style:c,children:"Open orders"}):e.jsx(g,{value:"openOrders",onClick:()=>d("openOrders"),children:"Open orders"}),"activity"===o?e.jsx(g,{value:"activity",style:c,children:"Activity"}):e.jsx(g,{value:"activity",onClick:()=>d("activity"),children:"Activity"})]}),e.jsx(q,{value:"balances",children:e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsxs(j,{children:[i.username,"'s account balances"]}),e.jsx(y,{children:"The assets held within your account"})]}),e.jsx(P,{className:"space-y-2",children:x&&x.length&&$&&$.length?e.jsx(I,{height:500,itemCount:x.length,itemSize:100,className:"gaps-2",children:({index:s,style:i})=>{const t=x[s],r=$&&Array.isArray($)?$.find((e=>e.id===t.asset_id)):{symbol:t.asset_id,precision:5},n=H(t.amount,r.precision).toLocaleString(void 0,{minimumFractionDigits:r.precision});return e.jsx("div",{style:{...i,marginBottom:"8px"},children:e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-6",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs(b,{children:[e.jsxs(j,{children:[r.symbol," (",x[s].asset_id,")"]}),e.jsxs(y,{children:["Liquid amount: ",n,e.jsx("br",{})]})]})}),e.jsxs("div",{className:"col-span-2 pt-5",children:[e.jsx("a",{href:`/dex/index.html?market=${r.symbol}_${"BTS"===r.symbol?"USD":"BTS"}`,children:e.jsx(u,{variant:"outline",className:"mr-2",children:"Trade"})}),e.jsx(S,{variant:"outline",classnamecontents:"mt-2",type:"button",text:"Asset info",hyperlink:`https://blocksights.info/#/assets/${r.symbol}`})]})]})})})}}):e.jsx("p",{children:"No balances found"})}),e.jsx(U,{children:e.jsx(u,{onClick:()=>{p(),m(h+1)},children:"Refresh balances"})})]})}),e.jsx(q,{value:"openOrders",children:e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(j,{children:"Open orders"}),e.jsx(y,{children:"Your currently open limit orders on the DEX"})]}),e.jsx(P,{children:v&&v.length&&$&&$.length?e.jsx(I,{height:500,itemCount:v.length,itemSize:145,children:({index:s,style:t})=>{const r=v[s].sell_price.base.amount,n=v[s].sell_price.base.asset_id,l=v[s].sell_price.quote.amount,a=v[s].sell_price.quote.asset_id,c=v[s].id,o=v[s].expiration,d=$&&$.length?$.find((e=>e.id===n)):null,h=$&&$.length?$.find((e=>e.id===a)):null,m=d?H(r,d.precision):r,x=h?H(l,h.precision):l,p=new Date(o)-new Date,g=Math.floor(p/1e3/60%60),C=Math.floor(p/1e3/60/60%24),N=`${Math.floor(p/1e3/60/60/24)}d ${C}h ${g}m`;return e.jsx("div",{style:{...t},children:e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-6",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs(b,{children:[e.jsxs(j,{children:["Selling ",m," ",d.symbol," for ",x," ",h.symbol]}),e.jsxs(y,{children:["Trading pair: ",n," for ",a,e.jsx("br",{}),"Order ID:",e.jsx(S,{classnamecontents:"text-blue-500",type:"text",text:` ${c}`,hyperlink:`https://blocksights.info/#/objects/${c}`}),e.jsx("br",{}),"Expires: ",N]})]})}),e.jsxs("div",{className:"col-span-2 pt-6",children:[e.jsx("a",{href:`/dex/index.html?market=${d.symbol}_${h.symbol}`,children:e.jsx(u,{variant:"outline",children:"Trade"})}),e.jsx("a",{href:`/order/index.html?id=${c}`,children:e.jsx(u,{variant:"outline",className:"mb-3 ml-3",children:"Update"})}),e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"outline",onClick:()=>{D(!0),w(c)},children:"Cancel"}),O&&c===T?e.jsx(ye,{operationName:"limit_order_cancel",username:i.username,usrChain:i.chain,userID:i.id,dismissCallback:D,headerText:`Cancelling offer of ${m} ${d.symbol} for ${x} ${h.symbol}`,trxJSON:[{fee_paying_account:i.id,order:T,extensions:[]}]},`Cancelling${m}${d.symbol}for${x}${h.symbol}`):null]})]})]})})})}}):e.jsx("p",{children:"No open orders found"})}),e.jsx(U,{children:e.jsx(u,{onClick:()=>{C(),m(h+1)},children:"Refresh open orders"})})]})}),e.jsx(q,{value:"activity",children:e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(j,{children:"Recent blockchain activity"}),e.jsx(y,{children:"Your recent blockchain activity"})]}),e.jsx(P,{className:"space-y-2",children:_&&_.length?e.jsx(I,{height:500,itemCount:_.length,itemSize:145,children:({index:s,style:i})=>{const t=_[s],r=new Date(t.block_data.block_time),n=new Date-r,l=Math.floor(n/1e3/60%60),a=Math.floor(n/1e3/60/60%24),c=`${Math.floor(n/1e3/60/60/24)}d ${a}h ${l}m`;return e.jsx("div",{style:{...i},children:e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-7",children:[e.jsx("div",{className:"col-span-5",children:e.jsxs(b,{children:[e.jsx(j,{children:ge[t.operation_type.toString()]}),e.jsxs(y,{children:["Operation ID:",e.jsx(S,{classnamecontents:"text-blue-500",type:"text",text:` ${t.account_history.operation_id}`,hyperlink:`https://blocksights.info/#/objects/${t.account_history.operation_id}`}),e.jsx("br",{}),"Block number:",e.jsx(S,{classnamecontents:"text-blue-500",type:"text",text:` ${t.block_data.block_num}`,hyperlink:`https://blocksights.info/#/blocks/${t.block_data.block_num}`}),e.jsx("br",{}),"Time since broadcast: ",c]})]})}),e.jsxs("div",{className:"col-span-2 mt-7",children:[e.jsxs(Q,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(u,{variant:"outline",children:"View Operation"})}),e.jsxs(X,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(G,{children:[e.jsx(K,{children:"Operation JSON"}),e.jsx(Z,{children:"Check out the contents of this operation"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(re,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(t.operation_history.op_object,null,2)})})})})]})]}),e.jsxs(Q,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(u,{variant:"outline",className:"mt-2",children:"View all"})}),e.jsxs(X,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(G,{children:[e.jsx(K,{children:"Full operation contents"}),e.jsx(Z,{children:"Exhaustive info regarding this operation"})]}),e.jsx("div",{className:"grid grid-cols-1",children:e.jsx("div",{className:"col-span-1",children:e.jsx(re,{className:"h-72 rounded-md border",children:e.jsx("pre",{children:JSON.stringify(t,null,2)})})})})]})]})]})]})})})}}):e.jsx("p",{children:"No recent activity found"})}),e.jsx(U,{children:e.jsx(u,{onClick:()=>{A(),k(N+1)},children:"Refresh recent activity"})})]})})]})})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:i&&i.username&&i.username.length?e.jsx(pe,{usr:i}):null})]})}export{Ie as default};