import{u as e,I as S,L as de,N as me,O as ue,P as he,Q as xe,S as je}from"./button.py8r9pgQ.js";import{r as a}from"./index.vR8cGMCg.js";import{u as fe,F as pe,a as C,b as A,c as T,d as y,f as D,e as b}from"./form.GftYXjjA.js";import{I as j,C as P,A as H,b as _,c as I,d as R,q as ge,s as be,r as Se,$ as Q,m as Z,n as W,o as X,p as Y,i as ee,j as se,u as ve,k as O,f as Ne}from"./CurrentUser.RIfKambw.js";import{A as L,a as z}from"./avatar.R1pvOsLd.js";import{h as ae,t as Ce,e as Ae}from"./common.X_7DDhag.js";import{c as Te}from"./User.yt9xOv9l.js";import{D as ye}from"./DeepLinkDialog.EofcCPWO.js";import{E as $e}from"./ExternalLink.T2a5i_k0.js";import{A as ke}from"./AssetDropDownCard.8dvoNMEI.js";import"./index.7dNGbZe0.js";import"./fuse.aCsZfKX4.js";import"./index.esm.8fBdem9M.js";function we(V){const{chain:o,excludedUsers:E,setChosenAccount:$}=V,[h,M]=a.useState(),[t,v]=a.useState(),[l,f]=a.useState(!1),[n,k]=a.useState();async function s(){const d=E.map(u=>u.username),N=E.map(u=>u.id);if(d.includes(h)||N.includes(h)){f(!1),v("Cannot transfer assets to this account.");return}const x=await fetch(`http://localhost:8080/api/accountLookup/${o}/${h}`,{method:"GET"});if(!x.ok){console.log({error:new Error(`${x.status} ${x.statusText}`),msg:"Couldn't find account."}),f(!1);return}const p=await x.json();if(p&&p.result){const u=ge(be(p.result,!0)),w=JSON.parse(Se(u));f(!1),k(w);return}f(!1),v("Couldn't find account.")}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[n?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:"Please enter a blockchain account name"}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(j,{value:h||"",placeholder:"Account name or ID",onKeyDown:d=>{d.key==="Enter"&&!l&&(f(!0),s())},onChange:d=>{/^[a-zA-Z0-9.-]*$/.test(d.target.value)&&(M(d.target.value),v(),k())}}),t?e.jsx("p",{className:"text-red-500 text-xs italic",children:t||"ERROR"}):null]}),e.jsx("div",{className:"col-span-1",children:h&&!l?e.jsx(S,{onClick:()=>s(),children:"Continue"}):e.jsx(S,{disabled:!0,children:"Continue"})})]}),n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:o==="bitshares"?"Proceed with the following Bitshares account?":"Proceed with the following Bitshares testnet (TEST) account?"}),e.jsx("div",{className:"col-span-1",children:e.jsx(P,{className:"mb-2 mt-1 text-center",onClick:()=>{$({name:n.name,id:n.id})},children:e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pt-6 pl-7",children:e.jsx(H,{size:40,name:n.name,extra:"AS",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(_,{children:[e.jsx(I,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.name}),e.jsx(R,{children:n.id})]})})]})},n.id)}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{children:e.jsx(S,{variant:"outline",className:"mr-2",onClick:()=>{v(),k()},children:"Go back"})}),e.jsx("div",{className:"text-right",children:e.jsx(S,{variant:"outline",onClick:()=>{$({name:n.name,id:n.id})},children:"Proceed"})})]})})]}):null]})})}function Ve(V){const o=fe({defaultValues:{account:""}}),[E,$]=a.useState(!1),[h,M]=a.useState(),[t,v]=a.useState(),[l,f]=a.useState(),[n,k]=a.useState(0);a.useState();const s=a.useSyncExternalStore(Q.subscribe,Q.get,()=>!0),d=a.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),N=a.useSyncExternalStore(W.subscribe,W.get,()=>!0),x=a.useSyncExternalStore(X.subscribe,X.get,()=>!0),p=a.useSyncExternalStore(Y.subscribe,Y.get,()=>!0),u=a.useSyncExternalStore(ee.subscribe,ee.get,()=>!0),w=a.useSyncExternalStore(se.subscribe,se.get,()=>!0),m=a.useMemo(()=>s&&s.chain?s.chain:"bitshares",[s]);ve(m??"bitshares",["assets","globalParams","marketSearch"]);const G=a.useMemo(()=>m&&(d||N)?m==="bitshares"?d:N:[],[d,N,m]),te=a.useMemo(()=>m&&(u||w)?m==="bitshares"?u:w:[],[u,w,m]),F=a.useMemo(()=>m&&(x||p)?m==="bitshares"?x:p:[],[x,p,m]),[J,re]=a.useState(0);a.useEffect(()=>{if(F&&F.length){const c=F.find(g=>g[0]===0),i=ae(c[1].fee,5);re(i)}},[F]);const[ne,Be]=a.useState(0),[B,le]=a.useState();a.useEffect(()=>{let c;return s&&s.id&&(c=Te([s.chain,s.id]).subscribe(({data:g,error:K,loading:oe})=>{g&&!K&&!oe&&le(g)})),()=>{c&&c()}},[s,ne]);const[r,ce]=a.useState(),U=a.useMemo(()=>l?G.filter(c=>c.symbol===l):[],[l,G]);a.useEffect(()=>{U&&U.length&&ce(U[0])},[U]);const[ie,q]=a.useState(!1);return a.useEffect(()=>{h&&M(!1)},[h]),a.useEffect(()=>{t&&q(!1)},[t]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(P,{children:[e.jsxs(_,{children:[e.jsx(I,{children:"Transfer assets"}),e.jsxs(R,{children:[e.jsx("p",{children:"Send funds from an account you control to another BitShares account holder."}),e.jsxs("p",{className:"mt-1",children:["⛔ Doesn't yet support a memo, so don't use this form when transfering to external services.",e.jsx("br",{}),"✅ Use for simple transfers between accounts."]})]})]}),e.jsxs(O,{children:[e.jsx(pe,{...o,children:e.jsxs("form",{onSubmit:()=>{$(!0),event.preventDefault()},children:[e.jsx(C,{control:o.control,name:"account",render:({field:c})=>e.jsxs(A,{children:[e.jsx(T,{children:"Sending account"}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[e.jsx("div",{className:"col-span-1 ml-5",children:e.jsx(H,{size:40,name:s&&s.username?s.username:"x",extra:"Sender",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-7",children:e.jsx(j,{disabled:!0,placeholder:"Bitshares account (1.2.x)",className:"mb-1 mt-1",value:`${s&&s.username?s.username:"?"} (${s&&s.id?s.id:"?"})`})})]})}),e.jsx(D,{children:"This is the account which will transfer the assets to the target recipient."}),e.jsx(b,{})]})}),e.jsx(C,{control:o.control,name:"targetAccount",render:({field:c})=>e.jsxs(A,{children:[e.jsx(T,{children:"Target account"}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsx("div",{className:"col-span-1 ml-5",children:t&&t.name?e.jsx(H,{size:40,name:t.name,extra:"Target",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]}):e.jsx(L,{children:e.jsx(z,{children:"?"})})}),e.jsx("div",{className:"col-span-5",children:e.jsx(j,{disabled:!0,placeholder:t&&t.name?`${t.name} (${t.id})`:"Bitshares account (1.2.x)",className:"mb-1 mt-1"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(de,{open:ie,onOpenChange:i=>{q(i)},children:[e.jsx(me,{asChild:!0,children:e.jsx(S,{variant:"outline",className:"ml-3 mt-1",children:t?"Change target":"Provide target"})}),e.jsxs(ue,{className:"sm:max-w-[375px] bg-white",children:[e.jsxs(he,{children:[e.jsxs(xe,{children:[!s||!s.chain?"Bitshares account search":null,s&&s.chain==="bitshares"?"Bitshares (BTS) account search":null,s&&s.chain!=="bitshares"?"Bitshares testnet (TEST) account search":null]}),e.jsx(je,{children:"Searching for an account to transfer assets to."})]}),e.jsx(we,{chain:s&&s.chain?s.chain:"bitshares",excludedUsers:s&&s.username&&s.username.length?[s]:[],setChosenAccount:v})]})]})})]})}),e.jsx(D,{children:!t||!t.name?"This is the account which will receive your transfer.":`The user ${t.name} will receive your transfer.`}),e.jsx(b,{})]})}),e.jsx(C,{control:o.control,name:"targetAsset",render:({field:c})=>e.jsxs(A,{children:[e.jsx(T,{children:"Asset to transfer"}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsxs("div",{className:"col-span-1 ml-5",children:[!l||!r?e.jsx(L,{children:e.jsx(z,{children:"?"})}):null,r?e.jsx(L,{children:e.jsx(z,{children:e.jsx("div",{className:"text-sm",children:r.bitasset_data_id?"MPA":"UIA"})})}):null]}),e.jsxs("div",{className:"col-span-5",children:[!l||!r?e.jsx(j,{disabled:!0,placeholder:"Bitshares asst (1.3.x)",className:"mb-1 mt-1"}):null,r?e.jsx(j,{disabled:!0,placeholder:`${r.symbol} (${r.id})`,className:"mb-1 mt-1"}):null]}),e.jsx("div",{className:"col-span-2 mt-1 ml-3",children:e.jsx(ke,{assetSymbol:l??"",assetData:null,storeCallback:f,otherAsset:null,marketSearch:te,type:null})})]})}),e.jsx(D,{children:"This is the asset which will be transferred to the target account."}),e.jsx(b,{children:r&&B&&!B.map(i=>i.asset_id).includes(r.id)?`Unable to proceed, your account "${s.username}" doesn't hold any of this asset.`:null})]})}),l&&t?e.jsx(C,{control:o.control,name:"transferAmount",render:({field:c})=>e.jsxs(A,{children:[e.jsx(T,{children:`Amount of ${l??"???"} available to transfer`}),e.jsx(y,{children:e.jsx(j,{disabled:!0,label:"Amount available to transfer",value:r&&B&&B.find(i=>i.asset_id===r.id)?`${ae(B.find(i=>i.asset_id===r.id).amount,r.precision)} ${r.symbol}`:"0",className:"mb-1"})}),e.jsxs(D,{children:["This is the maximum amount of ",l," you can transfer."]}),e.jsx(b,{})]})}):null,l&&t?e.jsx(C,{control:o.control,name:"transferAmount",render:({field:c})=>e.jsxs(A,{children:[e.jsx(T,{children:`Amount of ${l??"???"} to transfer`}),e.jsx(y,{onChange:i=>{const g=i.target.value;/^[0-9]*\.?[0-9]*$/.test(g)&&k(g)},children:e.jsx(j,{label:"Amount to transfer",value:n,placeholder:n,className:"mb-1"})}),e.jsx(D,{children:"How much you're going to send to the target account."}),e.jsx(b,{})]})}):null,l&&t?e.jsx(C,{control:o.control,name:"networkFee",render:({field:c})=>e.jsxs(A,{children:[e.jsx(T,{children:"Network fee"}),e.jsx(y,{children:e.jsx(j,{disabled:!0,placeholder:`${J} BTS`,className:"mb-3 mt-3"})}),s.id===s.referrer?e.jsxs(b,{children:["Rebate: ",Ce(J*.8,5)," BTS (vesting)"]}):null,e.jsx(b,{})]})}):null,n?e.jsx(S,{className:"mt-5 mb-3",variant:"outline",type:"submit",children:"Submit"}):e.jsx(S,{className:"mt-5 mb-3",variant:"outline",disabled:!0,type:"submit",children:"Submit"})]})}),E?e.jsx(ye,{operationName:"transfer",username:s.username,usrChain:s.chain,userID:s.id,dismissCallback:$,headerText:`Sending ${n} ${r.symbol} (${r.id}) to ${t.name} from ${s.username}`,trxJSON:[{fee:{amount:0,asset_id:"1.3.0"},from:s.id,to:t.id,amount:{amount:Ae(n,r.precision).toFixed(0),asset_id:r.id},extensions:[]}]},`Sending${n}${l}to${t.name}from${s.username}`):null]})]})}),e.jsxs("div",{className:"grid grid-cols-2 mt-5 gap-5",children:[t&&t.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(P,{children:[e.jsxs(_,{className:"pb-0 mb-0",children:[e.jsx(I,{children:"Double check the above details!"}),e.jsx(R,{children:"Avoid heartbreak, check your inputs!"})]}),e.jsx(O,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Before you proceed, please double check the form inputs."}),e.jsx("li",{children:"Validate the entire Beet prompt contents before you broadcast the transaction."}),e.jsx("li",{children:e.jsx($e,{type:"text",classnamecontents:"",hyperlink:`https://blocksights.info/#/accounts/${t.name}`,text:`Click here to view ${t.name}'s account on the
                        Blocksights blockchain explorer.`})})]})})]})}):null,t&&t.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(P,{children:[e.jsxs(_,{className:"pb-0 mb-0",children:[e.jsx(I,{children:"Beware! Don't fall for scams!"}),e.jsx(R,{children:"Be vigilant against scammers!"})]}),e.jsx(O,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Crypto exchanges will NEVER direct message you in with special transfer instructions to follow for deposits nor withdrawals."}),e.jsx("li",{children:"Asset transfer operations are permanent and the majority of assets are irrecoverable if erroneously transferred."}),e.jsx("li",{children:"If something sounds too good to be true, then it likely is, don't fall victim to scammers tricks."})]})})]})}):null]}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:s&&s.username&&s.username.length?e.jsx(Ne,{usr:s}):null})]})})}export{Ve as default};
