import{u as e,v as b,k as D,_ as J,X as E,O as L,Q as C,S as $,T as B,U as F,I as c}from"./hover-card.e7ea2833.js";import{r as o}from"./index.33c77f1d.js";import{n as R,p as X}from"./CurrentUser.a6c6908b.js";import{T as _,a as A,b as r,c as u,i as M}from"./common.760824ab.js";import{E as U}from"./ExternalLink.b2ec4386.js";const f=o.forwardRef(({className:l,...t},a)=>e.jsx("textarea",{className:b("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",l),ref:a,...t}));f.displayName="Textarea";const q=o.forwardRef((l,t)=>o.createElement(D.label,J({},l,{ref:t,onMouseDown:a=>{var s;(s=l.onMouseDown)===null||s===void 0||s.call(l,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault()}}))),j=q,P=E("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=o.forwardRef(({className:l,...t},a)=>e.jsx(j,{ref:a,className:b(P(),l),...t}));d.displayName=j.displayName;let g=[];const[V]=R({fetcher:(...l)=>fetch(`http://localhost:8080/api/deeplink/${l[0]}/${l[1]}`,{method:"POST",body:JSON.stringify(g)}).then(async t=>{if(!t.ok)throw console.log("Failed to generate deeplink"),new Error("Failed to generate deeplink");let a;try{a=await t.json()}catch{throw console.log("Failed to parse JSON"),new Error("Failed to parse JSON")}return a}).then(t=>{if(t&&t.result){const a=fflate.decompressSync(fflate.strToU8(t.result,!0)),s=JSON.parse(fflate.strFromU8(a));if(s.generatedDeepLink)return s.generatedDeepLink}throw new Error("No deep link generated")})});function W(l){const{trxJSON:t,operationName:a,usrChain:s,headerText:w,dismissCallback:N,username:y,userID:k}=l,v=o.useMemo(()=>(g=t,V([s,a])),[s,a,t]),{data:x,loading:n,error:T}=X(v),[h,m]=o.useState(!1),O=()=>{h||(m(!0),setTimeout(()=>{m(!1)},1e4))},[i,p]=o.useState("object");return e.jsx(L,{open:!0,onOpenChange:S=>{N(S)},children:e.jsxs(C,{className:"sm:max-w-[800px] bg-white",children:[e.jsxs($,{children:[e.jsx(B,{children:n?e.jsx(e.Fragment,{children:"Generating deeplink..."}):e.jsx(e.Fragment,{children:w})}),e.jsxs(F,{children:["With the account: ",y," (",k,")",e.jsx("br",{}),n?null:e.jsxs(e.Fragment,{children:["Your Bitshares Beet operation is ready to broadcast!",e.jsx("br",{}),"Choose from the methods below to broadcast your transaction via the",e.jsx(U,{classnamecontents:"text-blue-500",type:"text",text:" Bitshares BEET multiwallet",hyperlink:"https://github.com/bitshares/beet"}),"."]}),T?e.jsx(e.Fragment,{children:"An error occurred, sorry. Please close this dialog and try again."}):null]})]}),e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"mt-3"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(_,{defaultValue:"object",className:"w-full",children:[e.jsxs(A,{className:"grid w-full grid-cols-3 gap-2",children:[i==="object"?e.jsx(r,{value:"object",children:"View TRX Object"},"activeTRXTab"):e.jsx(r,{value:"object",onClick:()=>p("object"),children:"View TRX Object"},"inactiveTRXTab"),i==="deeplink"?e.jsx(r,{value:"deeplink",children:"Raw Deeplink"},"activeDLTab"):e.jsx(r,{value:"deeplink",onClick:()=>p("deeplink"),children:"Raw Deeplink"},"inactiveDLTab"),i==="localJSON"?e.jsx(r,{value:"localJSON",className:"bg-muted",children:"Local JSON file"},"activeJSONTab"):e.jsx(r,{value:"localJSON",onClick:()=>p("localJSON"),children:"Local JSON file"},"inactiveJSONTab")]},`${i}_TabList`),e.jsxs(u,{value:"object",children:[e.jsxs("div",{className:"grid w-full gap-1.5 mb-3",children:[e.jsx(d,{className:"text-left",children:"Transaction object JSON"}),e.jsxs("span",{className:"text-left text-sm",children:["Operation type: ",a]}),e.jsx(f,{value:JSON.stringify(t,null,4),className:"min-h-[250px]",id:"trxJSON",readOnly:!0})]}),e.jsx(c,{onClick:()=>{M(JSON.stringify(t,null,4))},children:"Copy operation JSON"})]}),e.jsxs(u,{value:"deeplink",children:[e.jsx(d,{className:"text-left",children:"Using a deeplink to broadcast via the Beet multiwallet"}),e.jsxs("ol",{className:"ml-4",children:[e.jsxs("li",{type:"1",children:["Launch the BEET wallet and navigate to '",e.jsx("b",{children:"Raw Link"}),"' in the menu, the wallet has to remain unlocked for the duration of the broadcast."]}),e.jsxs("li",{type:"1",children:["From this page you can either allow all operations, or solely allow operation '",e.jsx("b",{children:a}),"' (then click save)."]}),e.jsx("li",{type:"1",children:"Once 'Ready for raw links' shows in Beet, then you can click the button below to proceed."}),e.jsx("li",{type:"1",children:"A BEET prompt will display, verify the contents, optionally request a Beet receipt, and then broadcast the transaction onto the blockchain."}),e.jsx("li",{type:"1",children:"You won't receive a confirmation in this window, but your operation will be processed within seconds on the blockchain."})]}),n?null:e.jsx("a",{href:`rawbeet://api?chain=BTS&request=${x}`,children:e.jsx(c,{className:"mt-4",children:"Trigger raw Beet deeplink"})})]}),e.jsxs(u,{value:"localJSON",children:[e.jsx(d,{className:"text-left",children:"Via local file upload - ready to proceed"}),e.jsxs("ol",{className:"ml-4",children:[e.jsxs("li",{type:"1",children:["Launch the BEET wallet and navigate to '",e.jsx("b",{children:"Local"}),"' in the menu."]}),e.jsxs("li",{type:"1",children:["At this page either allow all, or allow just operation '",e.jsx("b",{children:a}),"'."]}),e.jsx("li",{type:"1",children:"Once at the local upload page, click the button below to download the JSON file to your computer."}),e.jsx("li",{type:"1",children:"From the BEET Local page, upload the JSON file, a prompt should then appear."}),e.jsx("li",{type:"1",children:"Thoroughly verify the prompt's contents before approving any operation, also consider toggling the optional receipt for post broadcast analysis and verification purposes."})]}),!n&&h?e.jsx(c,{className:"mt-4",variant:"outline",disabled:!0,children:"Downloading..."}):null,!n&&!h?e.jsx("a",{href:`data:text/json;charset=utf-8,${x}`,download:`${a}.json`,target:"_blank",rel:"noreferrer",onClick:O,children:e.jsx(c,{className:"mt-4",children:"Download Beet operation JSON"})}):null]})]})})]})]})})}export{W as D,d as L};
