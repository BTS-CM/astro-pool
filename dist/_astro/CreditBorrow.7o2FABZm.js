import{u as re,l as ae,j as e,i as se}from"./utils.CoSl1RWq.js";import{r as o}from"./index.sXsv9c-e.js";import{F as C}from"./index.esm.yz4690tU.js";import{F as te}from"./fuse.aCsZfKX4.js";import{T as D,a as F,c as u,d as p,h as z}from"./common.1hfIZstp.js";import{B as le}from"./button._UsuMLkQ.js";import{I as oe}from"./input.LAd1ue8h.js";import{$ as M,C as U,a as P,b as L,c as V,e as H,f as ce}from"./users.R3-HkUNM.js";import{b as ie}from"./User.D7H4eiaX.js";import{f as Z,g as q,h as G,i as J,u as ne}from"./Init.zlIhPQa1.js";import"./index.uYDp4DLV.js";import"./index.QjywInIh.js";import"./index.sg5Asqa-.js";function I(S){var t=new Date(S),k=new Date,m=t-k,g=Math.round(m/1e3/60/60);return g}const j={backgroundColor:"#252526",color:"white"},K=S=>/^[a-zA-Z0-9.-]+$/.test(S);function Te(S){const{t,i18n:k}=re(ae.get(),{i18n:se}),m=o.useSyncExternalStore(M.subscribe,M.get,()=>!0),g=o.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),B=o.useSyncExternalStore(q.subscribe,q.get,()=>!0),y=o.useSyncExternalStore(G.subscribe,G.get,()=>!0),O=o.useSyncExternalStore(J.subscribe,J.get,()=>!0),w=o.useMemo(()=>m&&m.chain?m.chain:"bitshares",[m]);ne(w??"bitshares",["assets","offers"]);const h=o.useMemo(()=>w&&(g||B)?w==="bitshares"?g:B:[],[g,B,w]),d=o.useMemo(()=>w&&(y||O)?w==="bitshares"?y.filter(s=>I(s.auto_disable_time)>=0):O.filter(s=>I(s.auto_disable_time)>=0):[],[y,O,w]),[x,v]=o.useState("allOffers"),[b,T]=o.useState("borrow"),[i,A]=o.useState(),[n,Q]=o.useState(),[de,W]=o.useState(),[$,X]=o.useState([]);o.useEffect(()=>{let s;return m&&m.id&&(s=ie([m.chain,m.id]).subscribe(({data:r,error:l,loading:c})=>{r&&!l&&!c&&(X(r.map(f=>f.asset_id)),W(r))})),()=>{s&&s()}},[m]);const _=o.useMemo(()=>!d||!$?[]:d.filter(s=>s.acceptable_collateral.some(a=>$.includes(a[0]))),[d,$]),N=o.useMemo(()=>{if(!d||!d.length||!h||!h.length)return;for(let a=0;a<d.length;a++){const r=d[a];r&&(r.acceptable_collateral&&(r.collateral_symbols=r.acceptable_collateral.map(l=>h.find(f=>f.id===l[0])?.symbol).filter(l=>l)),r.offer_symbols=[h.find(l=>l.id===r.asset_type).symbol])}let s=[];return b==="borrow"?s=["offer_symbols"]:b==="collateral"?s=["collateral_symbols"]:b==="owner_name"&&(s=["owner_name"]),new te(d,{includeScore:!0,threshold:.2,keys:s})},[d,h,b]);o.useEffect(()=>{const s=new URLSearchParams(window.location.search),a=Object.fromEntries(s.entries());let r="",l="",c="",f="?";a&&a.tab&&["allOffers","availableOffers","searchOffers"].includes(a.tab)?(r=a.tab,f+=`tab=${a.tab}`):(r="allOffers",f+="tab=allOffers"),a&&a.tab&&a.tab==="searchOffers"&&a.searchTab&&(["borrow","collateral","owner_name"].includes(a.searchTab)?(l=a.searchTab,f+=`&searchTab=${a.searchTab}`):(l="borrow",f+="&searchTab=borrow")),a&&a.tab&&a.searchTab&&a.tab==="searchOffers"&&a.searchText&&a.searchText.length&&(K(a.searchText)?(c=a.searchText,f+=`&searchText=${a.searchText}`):(c="",f+="&searchText=bts")),v(r),T(l),A(c),window.history.replaceState({},"",f)},[]),o.useEffect(()=>{if(N&&i){if(!K(i))return;window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b??"borrow"}${i?`&searchText=${i}`:""}`);const s=N.search(i);Q(s)}},[N,i]);function E({index:s,style:a,res:r,foundAsset:l}){return e.jsx("div",{style:{...a},children:e.jsxs(U,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(P,{className:"pb-1",children:[e.jsx(L,{children:t("CreditBorrow:common.title",{orderID:r.id.replace("1.21.",""),owner_name:r.owner_name,owner_account:r.owner_account})}),e.jsxs(V,{children:[t("CreditBorrow:common.offering"),e.jsx("b",{children:` ${z(r.current_balance,l.precision)} ${l.symbol} (${r.asset_type})`}),e.jsx("br",{}),t("CreditBorrow:common.accepting"),e.jsx("b",{children:h&&h.length?` ${r.acceptable_collateral.map(c=>c[0]).map(c=>h.find(f=>f.id===c)?.symbol).map(c=>c).join(", ")}`:t("CreditBorrow:common.loading")})]})]}),e.jsx(H,{className:"text-sm pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:[t("CreditBorrow:common.fee",{fee:r.fee_rate/1e4}),e.jsx("br",{}),t("CreditBorrow:common.repayPeriod",{repayPeriod:(r.max_duration_seconds/60/60).toFixed(r.max_duration_seconds/60/60<1?2:0)})]}),e.jsxs("div",{className:"col-span-1",children:[t("CreditBorrow:common.validity",{validity:I(r.auto_disable_time)}),e.jsx("br",{}),t("CreditBorrow:common.min",{amount:z(r.min_deal_amount,l.precision),asset:l.symbol})]})]})}),e.jsx(ce,{className:"pb-5",children:e.jsx("a",{href:`/offer/index.html?id=${r.id}`,children:e.jsx(le,{children:t("CreditBorrow:common.proceed",{offerID:r.id.replace("1.21.","")})})})})]})},`acard-${r.id}`)}const Y=({index:s,style:a})=>{let r=_[s];const l=h.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:s,style:a,res:r,foundAsset:l})},ee=({index:s,style:a})=>{let r=d[s];const l=h.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:s,style:a,res:r,foundAsset:l})},R=({index:s,style:a})=>{let r=n[s].item;const l=h.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:s,style:a,res:r,foundAsset:l})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"container mx-auto mt-5 mb-5",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(U,{children:[e.jsxs(P,{className:"pb-1",children:[e.jsx(L,{children:t("CreditBorrow:card.title")}),e.jsx(V,{children:t("CreditBorrow:card.description")})]}),e.jsx(H,{children:d&&d.length&&x?e.jsx(e.Fragment,{children:e.jsxs(D,{defaultValue:x,className:"w-full",children:[e.jsxs(F,{className:"grid w-full grid-cols-3 gap-2",children:[x==="allOffers"?e.jsx(u,{value:"allOffers",style:j,children:t("CreditBorrow:card.viewingAll")}):e.jsx(u,{value:"allOffers",onClick:s=>{v("allOffers"),window.history.replaceState({},"","?tab=allOffers")},children:t("CreditBorrow:card.viewAll")}),x==="availableOffers"?e.jsx(u,{value:"availableOffers",style:j,children:t("CreditBorrow:card.viewingAvailable")}):e.jsx(u,{value:"availableOffers",onClick:s=>{v("availableOffers"),window.history.replaceState({},"","?tab=availableOffers")},children:t("CreditBorrow:card.viewAvailable")}),x==="searchOffers"?e.jsx(u,{value:"searchOffers",style:j,children:t("CreditBorrow:card.viewingSearch")}):e.jsx(u,{value:"searchOffers",onClick:s=>{v("searchOffers"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b}&searchText=${i??""}`)},children:t("CreditBorrow:card.viewSearch")})]}),e.jsxs(p,{value:"allOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:t("CreditBorrow:card.allOffers")}),h&&d&&d.length?e.jsx(C,{height:500,itemCount:d.length,itemSize:225,className:"w-full",children:ee}):null]}),e.jsxs(p,{value:"availableOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:t("CreditBorrow:card.availableOffers")}),h&&_&&_.length?e.jsx(C,{height:500,itemCount:_.length,itemSize:225,className:"w-full",children:Y}):null]}),e.jsxs(p,{value:"searchOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:t("CreditBorrow:card.searchPrompt")}),e.jsxs(D,{defaultValue:b??"borrow",className:"w-full",children:[e.jsxs(F,{className:"grid w-full grid-cols-3 gap-2",children:[b==="borrow"?e.jsx(u,{value:"borrow",style:j,children:t("CreditBorrow:card.borrowSearching")}):e.jsx(u,{value:"borrow",onClick:()=>{T("borrow"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=borrow${i?`&searchText=${i}`:""}`)},children:t("CreditBorrow:card.borrowSearch")}),b==="collateral"?e.jsx(u,{value:"collateral",style:j,children:t("CreditBorrow:card.collateralSearching")}):e.jsx(u,{value:"collateral",onClick:()=>{T("collateral"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=collateral${i?`&searchText=${i}`:""}`)},children:t("CreditBorrow:card.collateralSearch")}),b==="owner_name"?e.jsx(u,{value:"owner_name",style:j,children:t("CreditBorrow:card.ownerSearching")}):e.jsx(u,{value:"owner_name",onClick:()=>{T("owner_name"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=owner_name${i?`&searchText=${i}`:""}`)},children:t("CreditBorrow:card.ownerSearch")})]}),e.jsx(oe,{name:"searchInput",placeholder:i??"Enter search text",className:"mb-3 mt-3 w-full",onChange:s=>{A(s.target.value)}}),e.jsxs(p,{value:"borrow",children:[n&&n.length?e.jsx(C,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:R}):null,i&&n&&!n.length?t("CreditBorrow:card.noResults"):null]}),e.jsxs(p,{value:"collateral",children:[n&&n.length?e.jsx(C,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:R}):null,i&&n&&!n.length?t("CreditBorrow:card.noResults"):null]}),e.jsxs(p,{value:"owner_name",children:[n&&n.length?e.jsx(C,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:R}):null,i&&n&&!n.length?t("CreditBorrow:card.noResults"):null]})]})]})]},`top_tab_${x}`)}):t("CreditBorrow:card.loading")})]})})})})}export{Te as default};
