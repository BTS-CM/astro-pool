import{u as ae,l as se,j as e,i as te}from"./utils.7znXe2qs.js";import{r as o}from"./index.sXsv9c-e.js";import{F as g}from"./index.esm.AIjKFR9D.js";import{F as le}from"./fuse.aCsZfKX4.js";import{T as A,a as F,b as m,c as p,h as z}from"./common.D-iicPwN.js";import{B as M}from"./button.aE--GSfB.js";import{I as oe}from"./input.HaIIg_lG.js";import{$ as U,C as P,a as L,b as V,c as H,d as Z,e as ce}from"./users.2JVUOKN_.js";import{c as ie}from"./User.wBO8_z3B.js";import{$ as q,a as G,d as J,e as K,u as ne}from"./Init.SOFaEcmE.js";import"./index.zSBU31wW.js";import"./index.QjywInIh.js";import"./index.l8a4wIXM.js";function I(S){var s=new Date(S),D=new Date,u=s-D,C=Math.round(u/1e3/60/60);return C}const j={backgroundColor:"#252526",color:"white"},Q=S=>/^[a-zA-Z0-9.-]+$/.test(S);function Te(S){const{t:s,i18n:D}=ae(se.get(),{i18n:te}),u=o.useSyncExternalStore(U.subscribe,U.get,()=>!0),C=o.useSyncExternalStore(q.subscribe,q.get,()=>!0),B=o.useSyncExternalStore(G.subscribe,G.get,()=>!0),y=o.useSyncExternalStore(J.subscribe,J.get,()=>!0),O=o.useSyncExternalStore(K.subscribe,K.get,()=>!0),w=o.useMemo(()=>u&&u.chain?u.chain:"bitshares",[u]);ne(w??"bitshares",["assets","offers"]);const h=o.useMemo(()=>w&&(C||B)?w==="bitshares"?C:B:[],[C,B,w]),d=o.useMemo(()=>w&&(y||O)?w==="bitshares"?y.filter(t=>I(t.auto_disable_time)>=0):O.filter(t=>I(t.auto_disable_time)>=0):[],[y,O,w]),[x,v]=o.useState("allOffers"),[b,T]=o.useState("borrow"),[i,k]=o.useState(),[n,W]=o.useState(),[de,X]=o.useState(),[$,Y]=o.useState([]);o.useEffect(()=>{let t;return u&&u.id&&(t=ie([u.chain,u.id]).subscribe(({data:r,error:l,loading:c})=>{r&&!l&&!c&&(Y(r.map(f=>f.asset_id)),X(r))})),()=>{t&&t()}},[u]);const _=o.useMemo(()=>!d||!$?[]:d.filter(t=>t.acceptable_collateral.some(a=>$.includes(a[0]))),[d,$]),N=o.useMemo(()=>{if(!d||!d.length||!h||!h.length)return;for(let a=0;a<d.length;a++){const r=d[a];r&&(r.acceptable_collateral&&(r.collateral_symbols=r.acceptable_collateral.map(l=>h.find(f=>f.id===l[0])?.symbol).filter(l=>l)),r.offer_symbols=[h.find(l=>l.id===r.asset_type).symbol])}let t=[];return b==="borrow"?t=["offer_symbols"]:b==="collateral"?t=["collateral_symbols"]:b==="owner_name"&&(t=["owner_name"]),new le(d,{includeScore:!0,threshold:.2,keys:t})},[d,h,b]);o.useEffect(()=>{const t=new URLSearchParams(window.location.search),a=Object.fromEntries(t.entries());let r="",l="",c="",f="?";a&&a.tab&&["allOffers","availableOffers","searchOffers"].includes(a.tab)?(r=a.tab,f+=`tab=${a.tab}`):(r="allOffers",f+="tab=allOffers"),a&&a.tab&&a.tab==="searchOffers"&&a.searchTab&&(["borrow","collateral","owner_name"].includes(a.searchTab)?(l=a.searchTab,f+=`&searchTab=${a.searchTab}`):(l="borrow",f+="&searchTab=borrow")),a&&a.tab&&a.searchTab&&a.tab==="searchOffers"&&a.searchText&&a.searchText.length&&(Q(a.searchText)?(c=a.searchText,f+=`&searchText=${a.searchText}`):(c="",f+="&searchText=bts")),v(r),T(l),k(c),window.history.replaceState({},"",f)},[]),o.useEffect(()=>{if(N&&i){if(!Q(i))return;window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b??"borrow"}${i?`&searchText=${i}`:""}`);const t=N.search(i);W(t)}},[N,i]);function E({index:t,style:a,res:r,foundAsset:l}){return e.jsx("div",{style:{...a},children:e.jsxs(P,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(L,{className:"pb-1",children:[e.jsx(V,{children:s("CreditBorrow:common.title",{orderID:r.id.replace("1.21.",""),owner_name:r.owner_name,owner_account:r.owner_account})}),e.jsxs(H,{children:[s("CreditBorrow:common.offering"),e.jsx("b",{children:` ${z(r.current_balance,l.precision)} ${l.symbol} (${r.asset_type})`}),e.jsx("br",{}),s("CreditBorrow:common.accepting"),e.jsx("b",{children:h&&h.length?` ${r.acceptable_collateral.map(c=>c[0]).map(c=>h.find(f=>f.id===c)?.symbol).map(c=>c).join(", ")}`:s("CreditBorrow:common.loading")})]})]}),e.jsx(Z,{className:"text-sm pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:[s("CreditBorrow:common.fee",{fee:r.fee_rate/1e4}),e.jsx("br",{}),s("CreditBorrow:common.repayPeriod",{repayPeriod:(r.max_duration_seconds/60/60).toFixed(r.max_duration_seconds/60/60<1?2:0)})]}),e.jsxs("div",{className:"col-span-1",children:[s("CreditBorrow:common.validity",{validity:I(r.auto_disable_time)}),e.jsx("br",{}),s("CreditBorrow:common.min",{amount:z(r.min_deal_amount,l.precision),asset:l.symbol})]})]})}),e.jsxs(ce,{className:"pb-5",children:[e.jsx("a",{href:`/offer/index.html?id=${r.id}`,children:e.jsx(M,{children:s("CreditBorrow:common.proceed",{offerID:r.id.replace("1.21.","")})})}),e.jsx("a",{href:`/lend/index.html?id=${r.id}`,children:e.jsx(M,{className:"ml-2",children:s(`CreditBorrow:common.${u.id===r.owner_account?"edit":"view"}`,{offerID:r.id.replace("1.21.","")})})})]})]})},`acard-${r.id}`)}const ee=({index:t,style:a})=>{let r=_[t];const l=h.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:t,style:a,res:r,foundAsset:l})},re=({index:t,style:a})=>{let r=d[t];const l=h.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:t,style:a,res:r,foundAsset:l})},R=({index:t,style:a})=>{let r=n[t].item;const l=h.find(c=>c.id===r.asset_type);return!r||!l?null:e.jsx(E,{index:t,style:a,res:r,foundAsset:l})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"container mx-auto mt-5 mb-5",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(P,{children:[e.jsxs(L,{className:"pb-1",children:[e.jsx(V,{children:s("CreditBorrow:card.title")}),e.jsx(H,{children:s("CreditBorrow:card.description")})]}),e.jsx(Z,{children:d&&d.length&&x?e.jsx(e.Fragment,{children:e.jsxs(A,{defaultValue:x,className:"w-full",children:[e.jsxs(F,{className:"grid w-full grid-cols-3 gap-2",children:[x==="allOffers"?e.jsx(m,{value:"allOffers",style:j,children:s("CreditBorrow:card.viewingAll")}):e.jsx(m,{value:"allOffers",onClick:t=>{v("allOffers"),window.history.replaceState({},"","?tab=allOffers")},children:s("CreditBorrow:card.viewAll")}),x==="availableOffers"?e.jsx(m,{value:"availableOffers",style:j,children:s("CreditBorrow:card.viewingAvailable")}):e.jsx(m,{value:"availableOffers",onClick:t=>{v("availableOffers"),window.history.replaceState({},"","?tab=availableOffers")},children:s("CreditBorrow:card.viewAvailable")}),x==="searchOffers"?e.jsx(m,{value:"searchOffers",style:j,children:s("CreditBorrow:card.viewingSearch")}):e.jsx(m,{value:"searchOffers",onClick:t=>{v("searchOffers"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b}&searchText=${i??""}`)},children:s("CreditBorrow:card.viewSearch")})]}),e.jsxs(p,{value:"allOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("CreditBorrow:card.allOffers")}),h&&d&&d.length?e.jsx(g,{height:500,itemCount:d.length,itemSize:225,className:"w-full",children:re}):null]}),e.jsxs(p,{value:"availableOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("CreditBorrow:card.availableOffers")}),h&&_&&_.length?e.jsx(g,{height:500,itemCount:_.length,itemSize:225,className:"w-full",children:ee}):null]}),e.jsxs(p,{value:"searchOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("CreditBorrow:card.searchPrompt")}),e.jsxs(A,{defaultValue:b??"borrow",className:"w-full",children:[e.jsxs(F,{className:"grid w-full grid-cols-3 gap-2",children:[b==="borrow"?e.jsx(m,{value:"borrow",style:j,children:s("CreditBorrow:card.borrowSearching")}):e.jsx(m,{value:"borrow",onClick:()=>{T("borrow"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=borrow${i?`&searchText=${i}`:""}`)},children:s("CreditBorrow:card.borrowSearch")}),b==="collateral"?e.jsx(m,{value:"collateral",style:j,children:s("CreditBorrow:card.collateralSearching")}):e.jsx(m,{value:"collateral",onClick:()=>{T("collateral"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=collateral${i?`&searchText=${i}`:""}`)},children:s("CreditBorrow:card.collateralSearch")}),b==="owner_name"?e.jsx(m,{value:"owner_name",style:j,children:s("CreditBorrow:card.ownerSearching")}):e.jsx(m,{value:"owner_name",onClick:()=>{T("owner_name"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=owner_name${i?`&searchText=${i}`:""}`)},children:s("CreditBorrow:card.ownerSearch")})]}),e.jsx(oe,{name:"searchInput",placeholder:i??"Enter search text",className:"mb-3 mt-3 w-full",onChange:t=>{k(t.target.value)}}),e.jsxs(p,{value:"borrow",children:[n&&n.length?e.jsx(g,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:R}):null,i&&n&&!n.length?s("CreditBorrow:card.noResults"):null]}),e.jsxs(p,{value:"collateral",children:[n&&n.length?e.jsx(g,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:R}):null,i&&n&&!n.length?s("CreditBorrow:card.noResults"):null]}),e.jsxs(p,{value:"owner_name",children:[n&&n.length?e.jsx(g,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:R}):null,i&&n&&!n.length?s("CreditBorrow:card.noResults"):null]})]})]})]},`top_tab_${x}`)}):s("CreditBorrow:card.loading")})]})})})})}export{Te as default};
