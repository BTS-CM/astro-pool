import{$ as T,p as F,u as P,q as $,j as e,C as B,b as k,c as E,d as R,g as I,I as G,f as J,h as K,B as Q}from"./CurrentUser.7d825758.js";import{r as u}from"./index.178a5b5e.js";import{F as b}from"./index.esm.e9840072.js";import{F as W}from"./fuse.a1032ea1.js";import{T as D,a as V,b as d,c as x}from"./tabs.1ab6271d.js";import{c as X}from"./User.4af747ae.js";import{h as z}from"./common.6cf182e8.js";import"./index.b413c856.js";function Y(N){var n=new Date(N),c=new Date,l=n-c,g=Math.round(l/1e3/60/60);return g}function ie(N){const n=u.useSyncExternalStore(T.subscribe,T.get,()=>!0),c=u.useSyncExternalStore(F.subscribe,F.get,()=>!0);P(n&&n.chain?n.chain:"bitshares");const l=u.useSyncExternalStore($.subscribe,$.get,()=>!0),[g,A]=u.useState(),[O,U]=u.useState([]);u.useEffect(()=>{let r;return n&&n.id&&(r=X([n.chain,n.id]).subscribe(({data:s,error:a,loading:o})=>{s&&!a&&!o&&(U(s.map(C=>C.asset_id)),A(s))})),()=>{r&&r()}},[n]);const j=u.useMemo(()=>!l||!g?[]:l.filter(r=>r.acceptable_collateral.some(i=>O.includes(i[0]))),[l,O]),[h,p]=u.useState("borrow"),w=u.useMemo(()=>{if(!l||!l.length||!c||!c.length)return;for(let i=0;i<l.length;i++){const s=l[i];s.collateral_symbols=s.acceptable_collateral.map(a=>c.find(o=>o.id===a[0]).symbol),s.offer_symbols=[c.find(a=>a.id===s.asset_type).symbol]}let r;return h==="borrow"?r=["offer_symbols"]:h==="collateral"?r=["collateral_symbols"]:h==="owner_name"&&(r=["owner_name"]),new W(l,{includeScore:!0,threshold:.2,keys:r})},[l,c,h]),[f,M]=u.useState(),[t,L]=u.useState();u.useEffect(()=>{if(w&&f){const r=w.search(f);L(r)}},[w,f]);function v({index:r,style:i,res:s,foundAsset:a}){return e.jsx("div",{style:{...i},children:e.jsxs(B,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(k,{className:"pb-1",children:[e.jsxs(E,{children:["Offer #",s.id.replace("1.21.","")," by ",s.owner_name??"?"," (",s.owner_account,")"]}),e.jsxs(R,{children:["Offering",e.jsx("b",{children:` ${z(s.current_balance,a.precision)} ${a.symbol} (${s.asset_type})`}),e.jsx("br",{}),"Accepting",e.jsx("b",{children:` ${s.acceptable_collateral.map(o=>o[0]).map(o=>c.find(C=>C.id===o).symbol).join(", ")}`})]})]}),e.jsx(I,{className:"text-sm pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:["Fee: ",s.fee_rate/1e4,"%",e.jsx("br",{}),`Repay period: ${(s.max_duration_seconds/60/60).toFixed(s.max_duration_seconds/60/60<1?2:0)} hours`]}),e.jsxs("div",{className:"col-span-1",children:[`Offer valid for: ${Y(s.auto_disable_time)} hours`,e.jsx("br",{}),`Min amount: ${z(s.min_deal_amount,a.precision)} ${a.symbol}`]})]})}),e.jsx(K,{className:"pb-5",children:e.jsx("a",{href:`/offer/index.html?id=${s.id}`,children:e.jsxs(Q,{children:["Proceed with credit offer #",s.id.replace("1.21.","")]})})})]})},`acard-${s.id}`)}const H=({index:r,style:i})=>{let s=j[r];const a=c.find(o=>o.id===s.asset_type);return!s||!a?null:e.jsx(v,{index:r,style:i,res:s,foundAsset:a})},q=({index:r,style:i})=>{let s=l[r];const a=c.find(o=>o.id===s.asset_type);return!s||!a?null:e.jsx(v,{index:r,style:i,res:s,foundAsset:a})},y=({index:r,style:i})=>{let s=t[r].item;const a=c.find(o=>o.id===s.asset_type);return!s||!a?null:e.jsx(v,{index:r,style:i,res:s,foundAsset:a})},[S,_]=u.useState("allOffers"),m={backgroundColor:"#252526",color:"white"};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(B,{children:[e.jsxs(k,{className:"pb-1",children:[e.jsx(E,{children:"🏦 Viewing available credit offers"}),e.jsx(R,{children:"Credit offers are user generated, they offer different rates, assets and durations; evaluate terms prior to creating deals."})]}),e.jsx(I,{children:l&&l.length?e.jsx(e.Fragment,{children:e.jsxs(D,{defaultValue:"allOffers",className:"w-full",children:[e.jsxs(V,{className:"grid w-full grid-cols-3 gap-2",children:[S==="allOffers"?e.jsx(d,{value:"allOffers",style:m,children:"Viewing all offers"}):e.jsx(d,{value:"allOffers",onClick:()=>_("allOffers"),children:"View all offers"}),S==="availableOffers"?e.jsx(d,{value:"availableOffers",style:m,children:"Viewing compatible orders"}):e.jsx(d,{value:"availableOffers",onClick:()=>_("availableOffers"),children:"View compatible orders"}),S==="searchOffers"?e.jsx(d,{value:"searchOffers",style:m,children:"Searching"}):e.jsx(d,{value:"searchOffers",onClick:()=>_("searchOffers"),children:"Search"})]}),e.jsxs(x,{value:"allOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"These credit offers are offering a variety of borrowable assets at competing rates."}),c&&l&&l.length?e.jsx(b,{height:500,itemCount:l.length,itemSize:225,className:"w-full",children:q}):null]}),e.jsxs(x,{value:"availableOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"These credit offers are accepting assets you own as loan backing collateral."}),c&&j&&j.length?e.jsx(b,{height:500,itemCount:j.length,itemSize:225,className:"w-full",children:H}):null]}),e.jsxs(x,{value:"searchOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"How do you want to search?"}),e.jsxs(D,{defaultValue:"borrow",className:"w-full",children:[e.jsxs(V,{className:"grid w-full grid-cols-3 gap-2",children:[h==="borrow"?e.jsx(d,{value:"borrow",style:m,children:"Searching by borrowable asset"}):e.jsx(d,{value:"borrow",onClick:()=>p("borrow"),children:"Search by borrowable asset"}),h==="collateral"?e.jsx(d,{value:"collateral",style:m,children:"Searching by collateral assets"}):e.jsx(d,{value:"collateral",onClick:()=>p("collateral"),children:"Search by collateral assets"}),h==="owner_name"?e.jsx(d,{value:"owner_name",style:m,children:"Searching by owner name"}):e.jsx(d,{value:"owner_name",onClick:()=>p("owner_name"),children:"Search by owner name"})]}),e.jsx(G,{name:"searchInput",placeholder:"Enter search text",className:"mb-3 mt-3 w-full",onChange:r=>{M(r.target.value)}}),e.jsxs(x,{value:"borrow",children:[t&&t.length?e.jsx(b,{height:500,itemCount:t.length,itemSize:225,className:"w-full",children:y}):null,f&&t&&!t.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(x,{value:"collateral",children:[t&&t.length?e.jsx(b,{height:500,itemCount:t.length,itemSize:225,className:"w-full",children:y}):null,f&&t&&!t.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(x,{value:"owner_name",children:[t&&t.length?e.jsx(b,{height:500,itemCount:t.length,itemSize:225,className:"w-full",children:y}):null,f&&t&&!t.length?e.jsx(e.Fragment,{children:"No results found"}):null]})]})]})]})}):e.jsx(e.Fragment,{children:"Loading offers..."})})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:n&&n.username&&n.username.length?e.jsx(J,{usr:n}):null})]})})}export{ie as default};
