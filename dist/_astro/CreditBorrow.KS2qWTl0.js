import{u as e,I as X}from"./button.py8r9pgQ.js";import{r as l}from"./index.vR8cGMCg.js";import{F as T}from"./index.esm.8fBdem9M.js";import{F as Y}from"./fuse.aCsZfKX4.js";import{T as k,a as R,b as d,c as w,h as I}from"./common.X_7DDhag.js";import{$ as V,m as z,n as D,t as M,v as U,u as ee,C as A,b as L,c as P,d as H,k as Z,I as se,f as ae,l as re}from"./CurrentUser.9PQ1vVJE.js";import{c as te}from"./User.qZ-NhGvB.js";import"./index.7dNGbZe0.js";function le(v){var o=new Date(v),j=new Date,p=o-j,S=Math.round(p/1e3/60/60);return S}const g={backgroundColor:"#252526",color:"white"},q=v=>/^[a-zA-Z0-9.-]+$/.test(v);function me(v){const o=l.useSyncExternalStore(V.subscribe,V.get,()=>!0),j=l.useSyncExternalStore(z.subscribe,z.get,()=>!0),p=l.useSyncExternalStore(D.subscribe,D.get,()=>!0),S=l.useSyncExternalStore(M.subscribe,M.get,()=>!0),C=l.useSyncExternalStore(U.subscribe,U.get,()=>!0),m=l.useMemo(()=>o&&o.chain?o.chain:"bitshares",[o]);ee(m??"bitshares",["assets","offers"]);const f=l.useMemo(()=>m&&(j||p)?m==="bitshares"?j:p:[],[j,p,m]),h=l.useMemo(()=>m&&(S||C)?m==="bitshares"?S:C:[],[S,C,m]),[x,y]=l.useState("allOffers"),[b,_]=l.useState("borrow"),[c,F]=l.useState(),[i,G]=l.useState(),[ne,J]=l.useState(),[$,K]=l.useState([]);l.useEffect(()=>{let r;return o&&o.id&&(r=te([o.chain,o.id]).subscribe(({data:s,error:t,loading:n})=>{s&&!t&&!n&&(K(s.map(u=>u.asset_id)),J(s))})),()=>{r&&r()}},[o]);const O=l.useMemo(()=>!h||!$?[]:h.filter(r=>r.acceptable_collateral.some(a=>$.includes(a[0]))),[h,$]),N=l.useMemo(()=>{if(!h||!h.length||!f||!f.length)return;for(let a=0;a<h.length;a++){const s=h[a];s&&(s.acceptable_collateral&&(s.collateral_symbols=s.acceptable_collateral.map(t=>f.find(u=>u.id===t[0])?.symbol).filter(t=>t)),s.offer_symbols=[f.find(t=>t.id===s.asset_type).symbol])}let r=[];return b==="borrow"?r=["offer_symbols"]:b==="collateral"?r=["collateral_symbols"]:b==="owner_name"&&(r=["owner_name"]),new Y(h,{includeScore:!0,threshold:.2,keys:r})},[h,f,b]);l.useEffect(()=>{const r=new URLSearchParams(window.location.search),a=Object.fromEntries(r.entries());let s="",t="",n="",u="?";a&&a.tab&&["allOffers","availableOffers","searchOffers"].includes(a.tab)?(s=a.tab,u+=`tab=${a.tab}`):(s="allOffers",u+="tab=allOffers"),a&&a.tab&&a.tab==="searchOffers"&&a.searchTab&&(["borrow","collateral","owner_name"].includes(a.searchTab)?(t=a.searchTab,u+=`&searchTab=${a.searchTab}`):(t="borrow",u+="&searchTab=borrow")),a&&a.tab&&a.searchTab&&a.tab==="searchOffers"&&a.searchText&&a.searchText.length&&(q(a.searchText)?(n=a.searchText,u+=`&searchText=${a.searchText}`):(n="",u+="&searchText=bts")),y(s),_(t),F(n),window.history.replaceState({},"",u)},[]),l.useEffect(()=>{if(N&&c){if(!q(c))return;window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b??"borrow"}${c?`&searchText=${c}`:""}`);const r=N.search(c);G(r)}},[N,c]);function E({index:r,style:a,res:s,foundAsset:t}){return e.jsx("div",{style:{...a},children:e.jsxs(A,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(L,{className:"pb-1",children:[e.jsxs(P,{children:["Offer #",s.id.replace("1.21.","")," by ",s.owner_name??"?"," (",s.owner_account,")"]}),e.jsxs(H,{children:["Offering",e.jsx("b",{children:` ${I(s.current_balance,t.precision)} ${t.symbol} (${s.asset_type})`}),e.jsx("br",{}),"Accepting",e.jsx("b",{children:f&&f.length?` ${s.acceptable_collateral.map(n=>n[0]).map(n=>f.find(u=>u.id===n)?.symbol).map(n=>n).join(", ")}`:"loading..."})]})]}),e.jsx(Z,{className:"text-sm pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:["Fee: ",s.fee_rate/1e4,"%",e.jsx("br",{}),`Repay period: ${(s.max_duration_seconds/60/60).toFixed(s.max_duration_seconds/60/60<1?2:0)} hours`]}),e.jsxs("div",{className:"col-span-1",children:[`Offer valid for: ${le(s.auto_disable_time)} hours`,e.jsx("br",{}),`Min amount: ${I(s.min_deal_amount,t.precision)} ${t.symbol}`]})]})}),e.jsx(re,{className:"pb-5",children:e.jsx("a",{href:`/offer/index.html?id=${s.id}`,children:e.jsxs(X,{children:["Proceed with credit offer #",s.id.replace("1.21.","")]})})})]})},`acard-${s.id}`)}const Q=({index:r,style:a})=>{let s=O[r];const t=f.find(n=>n.id===s.asset_type);return!s||!t?null:e.jsx(E,{index:r,style:a,res:s,foundAsset:t})},W=({index:r,style:a})=>{let s=h[r];const t=f.find(n=>n.id===s.asset_type);return!s||!t?null:e.jsx(E,{index:r,style:a,res:s,foundAsset:t})},B=({index:r,style:a})=>{let s=i[r].item;const t=f.find(n=>n.id===s.asset_type);return!s||!t?null:e.jsx(E,{index:r,style:a,res:s,foundAsset:t})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(A,{children:[e.jsxs(L,{className:"pb-1",children:[e.jsx(P,{children:"🏦 Viewing available credit offers"}),e.jsx(H,{children:"Credit offers are user generated, they offer different rates, assets and durations; evaluate terms prior to creating deals."})]}),e.jsx(Z,{children:h&&h.length&&x?e.jsx(e.Fragment,{children:e.jsxs(k,{defaultValue:x,className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-3 gap-2",children:[x==="allOffers"?e.jsx(d,{value:"allOffers",style:g,children:"Viewing all offers"}):e.jsx(d,{value:"allOffers",onClick:r=>{y("allOffers"),window.history.replaceState({},"","?tab=allOffers")},children:"View all offers"}),x==="availableOffers"?e.jsx(d,{value:"availableOffers",style:g,children:"Viewing compatible orders"}):e.jsx(d,{value:"availableOffers",onClick:r=>{y("availableOffers"),window.history.replaceState({},"","?tab=availableOffers")},children:"View compatible orders"}),x==="searchOffers"?e.jsx(d,{value:"searchOffers",style:g,children:"Searching"}):e.jsx(d,{value:"searchOffers",onClick:r=>{y("searchOffers"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b}&searchText=${c??""}`)},children:"Search"})]}),e.jsxs(w,{value:"allOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"These credit offers are offering a variety of borrowable assets at competing rates."}),f&&h&&h.length?e.jsx(T,{height:500,itemCount:h.length,itemSize:225,className:"w-full",children:W}):null]}),e.jsxs(w,{value:"availableOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"These credit offers are accepting assets you own as loan backing collateral."}),f&&O&&O.length?e.jsx(T,{height:500,itemCount:O.length,itemSize:225,className:"w-full",children:Q}):null]}),e.jsxs(w,{value:"searchOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"How do you want to search?"}),e.jsxs(k,{defaultValue:b??"borrow",className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-3 gap-2",children:[b==="borrow"?e.jsx(d,{value:"borrow",style:g,children:"Searching by borrowable asset"}):e.jsx(d,{value:"borrow",onClick:()=>{_("borrow"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=borrow${c?`&searchText=${c}`:""}`)},children:"Search by borrowable asset"}),b==="collateral"?e.jsx(d,{value:"collateral",style:g,children:"Searching by collateral assets"}):e.jsx(d,{value:"collateral",onClick:()=>{_("collateral"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=collateral${c?`&searchText=${c}`:""}`)},children:"Search by collateral assets"}),b==="owner_name"?e.jsx(d,{value:"owner_name",style:g,children:"Searching by owner name"}):e.jsx(d,{value:"owner_name",onClick:()=>{_("owner_name"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=owner_name${c?`&searchText=${c}`:""}`)},children:"Search by owner name"})]}),e.jsx(se,{name:"searchInput",placeholder:c??"Enter search text",className:"mb-3 mt-3 w-full",onChange:r=>{F(r.target.value)}}),e.jsxs(w,{value:"borrow",children:[i&&i.length?e.jsx(T,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:B}):null,c&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(w,{value:"collateral",children:[i&&i.length?e.jsx(T,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:B}):null,c&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(w,{value:"owner_name",children:[i&&i.length?e.jsx(T,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:B}):null,c&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]})]})]})]},`top_tab_${x}`)}):e.jsx(e.Fragment,{children:"Loading offers..."})})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:o&&o.username&&o.username.length?e.jsx(ae,{usr:o}):null})]})})}export{me as default};
