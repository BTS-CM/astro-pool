import{j as e,I as u,B as g,C as T,A as M,a as E,b as U,c as I,$ as V,p as G,t as J,v as K,u as ee,d as R,D as se,h as ae,i as te,k as ne,l as re,m as le,f as ce}from"./CurrentUser.ae16506a.js";import{r as t}from"./index.33307c42.js";import{u as ie,F as oe,a as N,b as S,c as C,d as A,f as D,e as p}from"./form.40e06cb4.js";import{A as _,a as O}from"./avatar.882d69b0.js";import{h as Z,t as de,b as me}from"./common.6cf182e8.js";import{c as he}from"./User.254f1cd4.js";import{D as ue}from"./DeepLinkDialog.c36b0a2e.js";import{A as xe}from"./AssetDropDownCard.0ef197b5.js";import"./fuse.a1032ea1.js";import"./index.esm.392f8f2f.js";function je(z){const{chain:o,excludedUsers:k,setChosenAccount:w}=z,[h,P]=t.useState(),[a,b]=t.useState(),[l,x]=t.useState(!1),[r,y]=t.useState();async function s(){const d=k.map(j=>j.username),B=k.map(j=>j.id);if(d.includes(h)||B.includes(h)){x(!1),b("Cannot transfer assets to this account.");return}const m=await fetch(`http://localhost:8080/api/accountLookup/${o}/${h}`,{method:"GET"});if(!m.ok){console.log({error:new Error(`${m.status} ${m.statusText}`),msg:"Couldn't find account."}),x(!1);return}const v=await m.json();if(v&&v.result){const j=v.result;x(!1),y(j);return}x(!1),b("Couldn't find account.")}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[r?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:"Please enter a blockchain account name"}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(u,{value:h||"",placeholder:"Account name or ID",onKeyDown:d=>{d.key==="Enter"&&!l&&(x(!0),s())},onChange:d=>{/^[a-zA-Z0-9.-]*$/.test(d.target.value)&&(P(d.target.value),b(),y())}}),a?e.jsx("p",{className:"text-red-500 text-xs italic",children:a||"ERROR"}):null]}),e.jsx("div",{className:"col-span-1",children:h&&!l?e.jsx(g,{onClick:()=>s(),children:"Continue"}):e.jsx(g,{disabled:!0,children:"Continue"})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:o==="bitshares"?"Proceed with the following Bitshares account?":"Proceed with the following Bitshares testnet (TEST) account?"}),e.jsx("div",{className:"col-span-1",children:e.jsx(T,{className:"mb-2 mt-1 text-center",onClick:()=>{w({name:r.name,id:r.id})},children:e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pt-6 pl-7",children:e.jsx(M,{size:40,name:r.name,extra:"AS",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(E,{children:[e.jsx(U,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.name}),e.jsx(I,{children:r.id})]})})]})},r.id)}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{children:e.jsx(g,{variant:"outline",className:"mr-2",onClick:()=>{b(),y()},children:"Go back"})}),e.jsx("div",{className:"text-right",children:e.jsx(g,{variant:"outline",onClick:()=>{w({name:r.name,id:r.id})},children:"Proceed"})})]})})]}):null]})})}function $e(z){const o=ie({defaultValues:{account:""}}),[k,w]=t.useState(!1),[h,P]=t.useState(),[a,b]=t.useState(),[l,x]=t.useState(),[r,y]=t.useState(0);t.useState();const s=t.useSyncExternalStore(V.subscribe,V.get,()=>!0),d=t.useSyncExternalStore(G.subscribe,G.get,()=>!0),B=t.useSyncExternalStore(J.subscribe,J.get,()=>!0),m=t.useSyncExternalStore(K.subscribe,K.get,()=>!0),[v,j]=t.useState(0);t.useEffect(()=>{if(m&&m.parameters){const c=m.find(f=>f[0]===0),i=Z(c[1].fee,5);j(i)}},[m]),ee(s&&s.chain?s.chain:"bitshares");const[q,fe]=t.useState(0),[$,Q]=t.useState();t.useEffect(()=>{let c;return s&&s.id&&(c=he([s.chain,s.id]).subscribe(({data:f,error:L,loading:Y})=>{f&&!L&&!Y&&Q(f)})),()=>{c&&c()}},[s,q]);const[n,W]=t.useState(),F=t.useMemo(()=>l?d.filter(c=>c.symbol===l):[],[l,d]);t.useEffect(()=>{F&&F.length&&W(F[0])},[F]);const[X,H]=t.useState(!1);return t.useEffect(()=>{h&&P(!1)},[h]),t.useEffect(()=>{a&&H(!1)},[a]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(T,{children:[e.jsxs(E,{children:[e.jsx(U,{children:"Transfer assets"}),e.jsxs(I,{children:[e.jsx("p",{children:"Send funds from an account you control to another BitShares account holder."}),e.jsxs("p",{className:"mt-1",children:["⛔ Doesn't yet support a memo, so don't use this form when transfering to external services.",e.jsx("br",{}),"✅ Use for simple transfers between accounts."]})]})]}),e.jsxs(R,{children:[e.jsx(oe,{...o,children:e.jsxs("form",{onSubmit:()=>{w(!0),event.preventDefault()},children:[e.jsx(N,{control:o.control,name:"account",render:({field:c})=>e.jsxs(S,{children:[e.jsx(C,{children:"Sending account"}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[e.jsx("div",{className:"col-span-1 ml-5",children:e.jsx(M,{size:40,name:s&&s.username?s.username:"x",extra:"Sender",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-7",children:e.jsx(u,{disabled:!0,placeholder:"Bitshares account (1.2.x)",className:"mb-1 mt-1",value:`${s&&s.username?s.username:"?"} (${s&&s.id?s.id:"?"})`})})]})}),e.jsx(D,{children:"This is the account which will transfer the assets to the target recipient."}),e.jsx(p,{})]})}),e.jsx(N,{control:o.control,name:"targetAccount",render:({field:c})=>e.jsxs(S,{children:[e.jsx(C,{children:"Target account"}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsx("div",{className:"col-span-1 ml-5",children:a&&a.name?e.jsx(M,{size:40,name:a.name,extra:"Target",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]}):e.jsx(_,{children:e.jsx(O,{children:"?"})})}),e.jsx("div",{className:"col-span-5",children:e.jsx(u,{disabled:!0,placeholder:a&&a.name?`${a.name} (${a.id})`:"Bitshares account (1.2.x)",className:"mb-1 mt-1"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(se,{open:X,onOpenChange:i=>{H(i)},children:[e.jsx(ae,{asChild:!0,children:e.jsx(g,{variant:"outline",className:"ml-3 mt-1",children:a?"Change target":"Provide target"})}),e.jsxs(te,{className:"sm:max-w-[375px] bg-white",children:[e.jsxs(ne,{children:[e.jsxs(re,{children:[!s||!s.chain?"Bitshares account search":null,s&&s.chain==="bitshares"?"Bitshares (BTS) account search":null,s&&s.chain!=="bitshares"?"Bitshares testnet (TEST) account search":null]}),e.jsx(le,{children:"Searching for an account to transfer assets to."})]}),e.jsx(je,{chain:s&&s.chain?s.chain:"bitshares",excludedUsers:s&&s.username&&s.username.length?[s]:[],setChosenAccount:b})]})]})})]})}),e.jsx(D,{children:!a||!a.name?"This is the account which will receive your transfer.":`The user ${a.name} will receive your transfer.`}),e.jsx(p,{})]})}),e.jsx(N,{control:o.control,name:"targetAsset",render:({field:c})=>e.jsxs(S,{children:[e.jsx(C,{children:"Asset to transfer"}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsxs("div",{className:"col-span-1 ml-5",children:[!l||!n?e.jsx(_,{children:e.jsx(O,{children:"?"})}):null,n?e.jsx(_,{children:e.jsx(O,{children:e.jsx("div",{className:"text-sm",children:n.bitasset_data_id?"MPA":"UIA"})})}):null]}),e.jsxs("div",{className:"col-span-5",children:[!l||!n?e.jsx(u,{disabled:!0,placeholder:"Bitshares asst (1.3.x)",className:"mb-1 mt-1"}):null,n?e.jsx(u,{disabled:!0,placeholder:`${n.symbol} (${n.id})`,className:"mb-1 mt-1"}):null]}),e.jsx("div",{className:"col-span-2 mt-1 ml-3",children:e.jsx(xe,{assetSymbol:l??"",assetData:null,storeCallback:x,otherAsset:null,marketSearch:B,type:null})})]})}),e.jsx(D,{children:"This is the asset which will be transferred to the target account."}),e.jsx(p,{children:n&&$&&!$.map(i=>i.asset_id).includes(n.id)?`Unable to proceed, your account "${s.username}" doesn't hold any of this asset.`:null})]})}),l&&a?e.jsx(N,{control:o.control,name:"transferAmount",render:({field:c})=>e.jsxs(S,{children:[e.jsx(C,{children:`Amount of ${l??"???"} available to transfer`}),e.jsx(A,{children:e.jsx(u,{disabled:!0,label:"Amount available to transfer",value:n&&$&&$.find(i=>i.asset_id===n.id)?`${Z($.find(i=>i.asset_id===n.id).amount,n.precision)} ${n.symbol}`:"0",className:"mb-1"})}),e.jsxs(D,{children:["This is the maximum amount of ",l," you can transfer."]}),e.jsx(p,{})]})}):null,l&&a?e.jsx(N,{control:o.control,name:"transferAmount",render:({field:c})=>e.jsxs(S,{children:[e.jsx(C,{children:`Amount of ${l??"???"} to transfer`}),e.jsx(A,{onChange:i=>{const f=i.target.value;/^[0-9]*\.?[0-9]*$/.test(f)&&y(f)},children:e.jsx(u,{label:"Amount to transfer",value:r,placeholder:r,className:"mb-1"})}),e.jsx(D,{children:"How much you're going to send to the target account."}),e.jsx(p,{})]})}):null,l&&a?e.jsx(N,{control:o.control,name:"networkFee",render:({field:c})=>e.jsxs(S,{children:[e.jsx(C,{children:"Network fee"}),e.jsx(A,{children:e.jsx(u,{disabled:!0,placeholder:`${v} BTS`,className:"mb-3 mt-3"})}),s.id===s.referrer?e.jsxs(p,{children:["Rebate: ",de(v*.8,5)," BTS (vesting)"]}):null,e.jsx(p,{})]})}):null,r?e.jsx(g,{className:"mt-5 mb-3",variant:"outline",type:"submit",children:"Submit"}):e.jsx(g,{className:"mt-5 mb-3",variant:"outline",disabled:!0,type:"submit",children:"Submit"})]})}),k?e.jsx(ue,{operationName:"transfer",username:s.username,usrChain:s.chain,userID:s.id,dismissCallback:w,headerText:`Sending ${r} ${n.symbol} (${n.id}) to ${a.name} from ${s.username}`,trxJSON:[{fee:{amount:0,asset_id:"1.3.0"},from:s.id,to:a.id,amount:{amount:me(r,n.precision).toFixed(0),asset_id:n.id},extensions:[]}]},`Sending${r}${l}to${a.name}from${s.username}`):null]})]})}),e.jsxs("div",{className:"grid grid-cols-2 mt-5 gap-5",children:[a&&a.name?e.jsx("div",{className:"col-span-1",children:e.jsx("a",{href:`https://blocksights.info/#/accounts/${a.name}`,target:"_blank",children:e.jsxs(T,{children:[e.jsxs(E,{className:"pb-0 mb-0",children:[e.jsx(U,{children:"Double check the above details!"}),e.jsx(I,{children:"Avoid heartbreak, check your inputs!"})]}),e.jsx(R,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Before you proceed, please double check the form inputs."}),e.jsx("li",{children:"Validate the entire Beet prompt contents before you broadcast the transaction."}),e.jsxs("li",{children:["Click here to view ",a.name,"'s account on the Blocksights blockchain explorer."]})]})})]})})}):null,a&&a.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(T,{children:[e.jsxs(E,{className:"pb-0 mb-0",children:[e.jsx(U,{children:"Beware! Don't fall for scams!"}),e.jsx(I,{children:"Be vigilant against scammers!"})]}),e.jsx(R,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Crypto exchanges will NEVER direct message you in with special transfer instructions to follow for deposits nor withdrawals."}),e.jsx("li",{children:"Asset transfer operations are permanent and the majority of assets are irrecoverable if erroneously transferred."}),e.jsx("li",{children:"If something sounds too good to be true, then it likely is, don't fall victim to scammers tricks."})]})})]})}):null]}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:s&&s.username&&s.username.length?e.jsx(ce,{usr:s}):null})]})})}export{$e as default};
