import{$,J as N,K as F,u as J,j as e,C as k,b as B,c as E,d as R,i as I,I as K,f as Z,k as q,B as G}from"./CurrentUser.1e0e4221.js";import{r as f}from"./index.178a5b5e.js";import{F as w}from"./index.esm.60b0ed75.js";import{F as Q}from"./fuse.a1032ea1.js";import{T as V,a as z,b as u,c as x,h as D}from"./common.e1bc7670.js";import{c as W}from"./User.fd878bac.js";function X(j){var h=new Date(j),o=new Date,n=h-o,m=Math.round(n/1e3/60/60);return m}const g={backgroundColor:"#252526",color:"white"},U=j=>/^[a-zA-Z0-9.-]+$/.test(j);function ne(j){const h=f.useSyncExternalStore($.subscribe,$.get,()=>!0),o=f.useSyncExternalStore(N.subscribe,N.get,()=>!0),n=f.useSyncExternalStore(F.subscribe,F.get,()=>!0);J(h&&h.chain?h.chain:"bitshares",["assets","offers"]);const[m,p]=f.useState("allOffers"),[b,v]=f.useState("borrow"),[c,C]=f.useState(),[i,A]=f.useState(),[Y,L]=f.useState(),[y,M]=f.useState([]);f.useEffect(()=>{let r;return h&&h.id&&(r=W([h.chain,h.id]).subscribe(({data:a,error:t,loading:l})=>{a&&!t&&!l&&(M(a.map(d=>d.asset_id)),L(a))})),()=>{r&&r()}},[h]);const S=f.useMemo(()=>!n||!y?[]:n.filter(r=>r.acceptable_collateral.some(s=>y.includes(s[0]))),[n,y]),T=f.useMemo(()=>{if(!n||!n.length||!o||!o.length)return;for(let s=0;s<n.length;s++){const a=n[s];a&&(a.acceptable_collateral&&(a.collateral_symbols=a.acceptable_collateral.map(t=>o.find(d=>d.id===t[0])?.symbol).filter(t=>t)),a.offer_symbols=[o.find(t=>t.id===a.asset_type).symbol])}let r=[];return b==="borrow"?r=["offer_symbols"]:b==="collateral"?r=["collateral_symbols"]:b==="owner_name"&&(r=["owner_name"]),new Q(n,{includeScore:!0,threshold:.2,keys:r})},[n,o,b]);f.useEffect(()=>{console.log("Parsing url params");const r=new URLSearchParams(window.location.search),s=Object.fromEntries(r.entries());let a="",t="",l="",d="?";s&&s.tab&&["allOffers","availableOffers","searchOffers"].includes(s.tab)?(a=s.tab,d+=`tab=${s.tab}`,console.log("Setting active tab",s.tab)):(a="allOffers",d+="tab=allOffers"),s&&s.tab&&s.tab==="searchOffers"&&s.searchTab&&(["borrow","collateral","owner_name"].includes(s.searchTab)?(t=s.searchTab,d+=`&searchTab=${s.searchTab}`,console.log("Setting active search tab",s.searchTab)):(t="borrow",d+="&searchTab=borrow")),s&&s.tab&&s.searchTab&&s.tab==="searchOffers"&&s.searchText&&s.searchText.length&&(U(s.searchText)?(l=s.searchText,d+=`&searchText=${s.searchText}`,console.log("Setting search text",s.searchText)):(l="",d+="&searchText=bts")),p(a),v(t),C(l),window.history.replaceState({},"",d)},[]),f.useEffect(()=>{if(T&&c){if(!U(c))return;window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b??"borrow"}${c?`&searchText=${c}`:""}`);const r=T.search(c);A(r)}},[T,c]);function _({index:r,style:s,res:a,foundAsset:t}){return e.jsx("div",{style:{...s},children:e.jsxs(k,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(B,{className:"pb-1",children:[e.jsxs(E,{children:["Offer #",a.id.replace("1.21.","")," by ",a.owner_name??"?"," (",a.owner_account,")"]}),e.jsxs(R,{children:["Offering",e.jsx("b",{children:` ${D(a.current_balance,t.precision)} ${t.symbol} (${a.asset_type})`}),e.jsx("br",{}),"Accepting",e.jsx("b",{children:o&&o.length?` ${a.acceptable_collateral.map(l=>l[0]).map(l=>o.find(d=>d.id===l)?.symbol).map(l=>l).join(", ")}`:"loading..."})]})]}),e.jsx(I,{className:"text-sm pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:["Fee: ",a.fee_rate/1e4,"%",e.jsx("br",{}),`Repay period: ${(a.max_duration_seconds/60/60).toFixed(a.max_duration_seconds/60/60<1?2:0)} hours`]}),e.jsxs("div",{className:"col-span-1",children:[`Offer valid for: ${X(a.auto_disable_time)} hours`,e.jsx("br",{}),`Min amount: ${D(a.min_deal_amount,t.precision)} ${t.symbol}`]})]})}),e.jsx(q,{className:"pb-5",children:e.jsx("a",{href:`/offer/index.html?id=${a.id}`,children:e.jsxs(G,{children:["Proceed with credit offer #",a.id.replace("1.21.","")]})})})]})},`acard-${a.id}`)}const P=({index:r,style:s})=>{let a=S[r];const t=o.find(l=>l.id===a.asset_type);return!a||!t?null:e.jsx(_,{index:r,style:s,res:a,foundAsset:t})},H=({index:r,style:s})=>{let a=n[r];const t=o.find(l=>l.id===a.asset_type);return!a||!t?null:e.jsx(_,{index:r,style:s,res:a,foundAsset:t})},O=({index:r,style:s})=>{let a=i[r].item;const t=o.find(l=>l.id===a.asset_type);return!a||!t?null:e.jsx(_,{index:r,style:s,res:a,foundAsset:t})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(k,{children:[e.jsxs(B,{className:"pb-1",children:[e.jsx(E,{children:"🏦 Viewing available credit offers"}),e.jsx(R,{children:"Credit offers are user generated, they offer different rates, assets and durations; evaluate terms prior to creating deals."})]}),e.jsx(I,{children:n&&n.length&&m?e.jsx(e.Fragment,{children:e.jsxs(V,{defaultValue:m,className:"w-full",children:[e.jsxs(z,{className:"grid w-full grid-cols-3 gap-2",children:[m==="allOffers"?e.jsx(u,{value:"allOffers",style:g,children:"Viewing all offers"}):e.jsx(u,{value:"allOffers",onClick:r=>{p("allOffers"),window.history.replaceState({},"","?tab=allOffers")},children:"View all offers"}),m==="availableOffers"?e.jsx(u,{value:"availableOffers",style:g,children:"Viewing compatible orders"}):e.jsx(u,{value:"availableOffers",onClick:r=>{p("availableOffers"),window.history.replaceState({},"","?tab=availableOffers")},children:"View compatible orders"}),m==="searchOffers"?e.jsx(u,{value:"searchOffers",style:g,children:"Searching"}):e.jsx(u,{value:"searchOffers",onClick:r=>{p("searchOffers"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=${b}&searchText=${c??""}`)},children:"Search"})]}),e.jsxs(x,{value:"allOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"These credit offers are offering a variety of borrowable assets at competing rates."}),o&&n&&n.length?e.jsx(w,{height:500,itemCount:n.length,itemSize:225,className:"w-full",children:H}):null]}),e.jsxs(x,{value:"availableOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"These credit offers are accepting assets you own as loan backing collateral."}),o&&S&&S.length?e.jsx(w,{height:500,itemCount:S.length,itemSize:225,className:"w-full",children:P}):null]}),e.jsxs(x,{value:"searchOffers",children:[e.jsx("h5",{className:"mb-2 text-center",children:"How do you want to search?"}),e.jsxs(V,{defaultValue:b??"borrow",className:"w-full",children:[e.jsxs(z,{className:"grid w-full grid-cols-3 gap-2",children:[b==="borrow"?e.jsx(u,{value:"borrow",style:g,children:"Searching by borrowable asset"}):e.jsx(u,{value:"borrow",onClick:()=>{v("borrow"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=borrow${c?`&searchText=${c}`:""}`)},children:"Search by borrowable asset"}),b==="collateral"?e.jsx(u,{value:"collateral",style:g,children:"Searching by collateral assets"}):e.jsx(u,{value:"collateral",onClick:()=>{v("collateral"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=collateral${c?`&searchText=${c}`:""}`)},children:"Search by collateral assets"}),b==="owner_name"?e.jsx(u,{value:"owner_name",style:g,children:"Searching by owner name"}):e.jsx(u,{value:"owner_name",onClick:()=>{v("owner_name"),window.history.replaceState({},"",`?tab=searchOffers&searchTab=owner_name${c?`&searchText=${c}`:""}`)},children:"Search by owner name"})]}),e.jsx(K,{name:"searchInput",placeholder:c??"Enter search text",className:"mb-3 mt-3 w-full",onChange:r=>{C(r.target.value)}}),e.jsxs(x,{value:"borrow",children:[i&&i.length?e.jsx(w,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:O}):null,c&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(x,{value:"collateral",children:[i&&i.length?e.jsx(w,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:O}):null,c&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]}),e.jsxs(x,{value:"owner_name",children:[i&&i.length?e.jsx(w,{height:500,itemCount:i.length,itemSize:225,className:"w-full",children:O}):null,c&&i&&!i.length?e.jsx(e.Fragment,{children:"No results found"}):null]})]})]})]},`top_tab_${m}`)}):e.jsx(e.Fragment,{children:"Loading offers..."})})]})}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:h&&h.username&&h.username.length?e.jsx(Z,{usr:h}):null})]})})}export{ne as default};
