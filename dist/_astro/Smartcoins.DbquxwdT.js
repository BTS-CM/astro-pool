import{u as se,l as ae,j as e,i as te}from"./utils.CoSl1RWq.js";import{r as c}from"./index.sXsv9c-e.js";import{F as y}from"./index.esm.yz4690tU.js";import{F as re}from"./fuse.aCsZfKX4.js";import{e as le,T as R,a as _,c as i,d as j}from"./common.1hfIZstp.js";import{$ as Q,C as F,a as z,b as M,c as H,d as U,f as q}from"./users.M21O9cX4.js";import{B as O}from"./button._UsuMLkQ.js";import{B as f}from"./badge.KzOuQ34z.js";import{I as ce}from"./input.LAd1ue8h.js";import{$ as Z,a as G,b as J,c as K,u as ie}from"./Init.MhOaBiuT.js";import{b as ne}from"./User.bnexxm_Z.js";import{E as V}from"./ExternalLink.su8-pHSR.js";import"./index.uYDp4DLV.js";import"./index.QjywInIh.js";import"./index.sg5Asqa-.js";import"./dialog.8HOXxM8G.js";import"./index.0G9Tm10-.js";const g={backgroundColor:"#252526",color:"white"};function ke(oe){const{t:s,i18n:he}=se(ae.get(),{i18n:te}),x=c.useSyncExternalStore(Q.subscribe,Q.get,()=>!0),B=c.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),k=c.useSyncExternalStore(G.subscribe,G.get,()=>!0),A=c.useSyncExternalStore(J.subscribe,J.get,()=>!0),$=c.useSyncExternalStore(K.subscribe,K.get,()=>!0),p=c.useMemo(()=>x&&x.chain?x.chain:"bitshares",[x]);ie(p??"bitshares",["bitAssetData","marketSearch"]);const o=c.useMemo(()=>p&&(B||k)?p==="bitshares"?B:k:[],[B,k,p]),h=c.useMemo(()=>p&&(A||$)?p==="bitshares"?A:$:[],[A,$,p]),[w,W]=c.useState();c.useEffect(()=>{let r;return x&&x.id&&(r=ne([x.chain,x.id]).subscribe(({data:a,error:l,loading:m})=>{a&&!l&&!m&&W(a)})),()=>{r&&r()}},[x]);const D=c.useMemo(()=>{if(w&&o&&h)return o.filter(t=>{const a=w.find(l=>l.asset_id===t.collateral);return!(!a||a&&!a.amount>0)})},[w,o,h]),v=c.useMemo(()=>{if(w&&o&&h)return o.filter(t=>!!w.find(l=>l.asset_id===t.assetID))},[w,o,h]),[S,C]=c.useState("all"),[u,N]=c.useState("borrow"),T=c.useMemo(()=>{if(!o||!o.length||!h||!h.length)return;const r=o.map(a=>{const l=h.find(d=>d.id===a.assetID),m=h.find(d=>d.id===a.collateral);return{...a,offer_symbol:l.s,collateral_symbol:m.s,issuerAccount:l.u}});let t;return u==="borrow"?t=["offer_symbol","assetID"]:u==="collateral"?t=["collateral_symbol","collateral"]:u==="issuer"&&(t=["issuerAccount"]),new re(r,{includeScore:!0,threshold:.2,keys:t})},[o,h,u]),[b,L]=c.useState(),[n,X]=c.useState();c.useEffect(()=>{if(T&&b){const r=T.search(b);X(r)}},[T,b]);const Y=c.useCallback(le(r=>{L(r.target.value),window.history.replaceState({},"",`?tab=search&searchTab=${u}&searchText=${r.target.value}`)},500),[]);function P({index:r,style:t,bitasset:a,thisBitassetData:l,thisCollateralAssetData:m}){return e.jsx("div",{style:{...t},children:e.jsxs(F,{className:"ml-2 mr-2",onClick:()=>{},children:[e.jsxs(z,{className:"pb-1",children:[e.jsxs(M,{children:[a.issuer.id==="1.2.0"?"Bitasset":"Smartcoin",' "',l.s,'"'," ","(",e.jsx(V,{classnamecontents:"text-blue-500",type:"text",text:l.id,hyperlink:`https://blocksights.info/#/assets/${l.id}`}),")"," ",s("Smartcoins:createdBy")," ",a.issuer.name," ","(",e.jsx(V,{classnamecontents:"text-blue-500",type:"text",text:a.issuer.id,hyperlink:`https://blocksights.info/#/accounts/${a.issuer.id}`}),")"]}),e.jsxs(H,{children:[s("Smartcoins:backingCollateral"),":",e.jsxs("b",{children:[` ${m.s} `,"(",e.jsx(V,{classnamecontents:"text-blue-500",type:"text",text:m.id,hyperlink:`https://blocksights.info/#/assets/${m.id}`}),")"]})]})]}),e.jsxs(U,{className:"text-sm pb-3",children:[e.jsx(f,{className:"mr-2 mt-2",children:s("Smartcoins:feedQty",{qty:a.feeds?.length??0})}),e.jsx(f,{className:"mr-2",children:s("Smartcoins:mcr",{mcr:a.mcr/10})}),e.jsx(f,{className:"mr-2",children:s("Smartcoins:mssr",{mssr:a.mssr/10})}),e.jsx(f,{className:"mr-2",children:s("Smartcoins:icr",{icr:a.icr/10})})]}),e.jsx(q,{className:"pb-5",children:e.jsx("a",{href:`/smartcoin/index.html?id=${a.assetID}`,children:e.jsx(O,{className:"h-8",children:s("Smartcoins:proceedToBorrow",{asset:l.s})})})})]})},`acard-${a.assetID}`)}const ee=({index:r,style:t})=>e.jsx("div",{style:{...t},children:e.jsxs(F,{className:"ml-2 mr-2",children:[e.jsxs(z,{className:"pb-1",children:[e.jsx(M,{children:s("Smartcoins:placeholderSmartcoinCreated")}),e.jsxs(H,{children:[s("Smartcoins:placeholderBackingCollateral"),e.jsx("b",{children:" ... (1.3.x)"})]})]}),e.jsxs(U,{className:"text-sm pb-3",children:[e.jsx(f,{className:"mr-2 mt-2",children:s("Smartcoins:placeholderFeedQty")}),e.jsx(f,{className:"mr-2",children:s("Smartcoins:placeholderMCR")}),e.jsx(f,{className:"mr-2",children:s("Smartcoins:placeholderMSSR")}),e.jsx(f,{className:"mr-2",children:s("Smartcoins:placeholderICR")})]}),e.jsx(q,{className:"pb-5",children:e.jsx(O,{className:"h-8",children:s("Smartcoins:placeholderProceedToBorrow")})})]})},`acard-${r}`),E=({index:r,style:t})=>{let a;S==="all"?a=o[r]:S==="compatible"?a=D[r]:S==="holdings"&&(a=v[r]);const l=a&&h?h.find(d=>d.id===a.assetID):null,m=a&&h?h.find(d=>d.id===a.collateral):null;return!a||!l||!m?null:e.jsx(P,{index:r,style:t,bitasset:a,thisBitassetData:l,thisCollateralAssetData:m})},I=({index:r,style:t})=>{let a=n[r].item;const l=h.find(d=>d.id===a.assetID),m=h.find(d=>d.id===a.collateral);return e.jsx(P,{index:r,style:t,bitasset:a,thisBitassetData:l,thisCollateralAssetData:m})};return c.useEffect(()=>{if(T){const r=new URLSearchParams(window.location.search),t=Object.fromEntries(r.entries());if(t&&t.tab){if(!["all","compatible","holdings","search"].includes(t.tab))return;C(t.tab)}else window.history.replaceState({},"","?tab=all");if(t&&t.searchTab){if(!["borrow","collateral","issuer"].includes(t.searchTab))return;N(t.searchTab)}if(t&&t.searchText){if(!(l=>/^[a-zA-Z0-9.-]+$/.test(l))(t.searchText))return;L(t.searchText)}}},[T]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"container mx-auto mt-5 mb-5",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(F,{children:[e.jsxs(z,{children:[e.jsx(M,{children:s("Smartcoins:selectBorrowableAsset")}),e.jsx(H,{children:s("Smartcoins:smartcoinDescription")})]}),e.jsx(U,{children:o&&o.length&&w?e.jsxs(R,{defaultValue:S??"all",className:"w-full",children:[e.jsxs(_,{className:"grid w-full grid-cols-4 gap-2",children:[S==="all"?e.jsx(i,{value:"all",style:g,children:s("Smartcoins:viewingAllAssets")}):e.jsx(i,{value:"all",onClick:()=>{C("all"),window.history.replaceState({},"","?tab=all")},children:s("Smartcoins:viewAllAssets")}),S==="compatible"?e.jsx(i,{value:"compatible",style:g,children:s("Smartcoins:viewingCompatible")}):e.jsx(i,{value:"compatible",onClick:()=>{C("compatible"),window.history.replaceState({},"","?tab=compatible")},children:s("Smartcoins:viewCompatible")}),S==="holdings"?e.jsx(i,{value:"holdings",style:g,children:s("Smartcoins:viewingHoldings")}):e.jsx(i,{value:"holdings",onClick:()=>{C("holdings"),window.history.replaceState({},"","?tab=holdings")},children:s("Smartcoins:viewHoldings")}),S==="search"?e.jsx(i,{value:"search",style:g,children:s("Smartcoins:searching")}):e.jsx(i,{value:"search",onClick:()=>{C("search"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:s("Smartcoins:search")})]}),e.jsxs(j,{value:"all",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingAllSmartcoins",{count:o.length})}),e.jsx(y,{height:500,itemCount:o.length,itemSize:200,className:"w-full",children:E})]}),e.jsxs(j,{value:"compatible",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingCompatibleSmartcoins",{count:D.length})}),e.jsx(y,{height:500,itemCount:D.length,itemSize:200,className:"w-full",children:E})]}),e.jsxs(j,{value:"holdings",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingHeldSmartcoins",{count:v?v.length:0})}),e.jsx(y,{height:500,itemCount:v?v.length:0,itemSize:200,className:"w-full",children:E})]}),e.jsxs(j,{value:"search",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:howToSearch")})," ",e.jsxs(R,{defaultValue:u??"borrow",className:"w-full",children:[e.jsxs(_,{className:"grid w-full grid-cols-3 gap-2",children:[u==="borrow"?e.jsx(i,{value:"borrow",style:g,children:s("Smartcoins:searchingByBorrowable")}):e.jsx(i,{value:"borrow",onClick:()=>{N("borrow"),window.history.replaceState({},"","?tab=search&searchTab=borrow")},children:s("Smartcoins:searchByBorrowable")}),u==="collateral"?e.jsx(i,{value:"collateral",style:g,children:s("Smartcoins:searchingByCollateral")}):e.jsx(i,{value:"collateral",onClick:()=>{N("collateral"),window.history.replaceState({},"","?tab=search&searchTab=collateral")},children:s("Smartcoins:searchByCollateral")}),u==="issuer"?e.jsx(i,{value:"issuer",style:g,children:s("Smartcoins:searchingByIssuer")}):e.jsx(i,{value:"issuer",onClick:()=>{N("issuer"),window.history.replaceState({},"","?tab=search&searchTab=issuer")},children:s("Smartcoins:searchByIssuer")})]}),e.jsx(ce,{name:"searchInput",placeholder:b??s("Smartcoins:enterSearchText"),className:"mb-3 mt-3 w-full",onChange:r=>Y(r)}),e.jsxs(j,{value:"borrow",children:[n&&n.length?e.jsx(y,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:I}):null,b&&n&&!n.length?e.jsx(e.Fragment,{children:s("Smartcoins:noResultsFound")}):null]}),e.jsxs(j,{value:"collateral",children:[n&&n.length?e.jsx(y,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:I}):null,b&&n&&!n.length?e.jsx(e.Fragment,{children:s("Smartcoins:noResultsFound")}):null]}),e.jsxs(j,{value:"issuer",children:[n&&n.length?e.jsx(y,{height:500,itemCount:n.length,itemSize:200,className:"w-full",children:I}):null,b&&n&&!n.length?e.jsx(e.Fragment,{children:s("Smartcoins:noResultsFound")}):null]})]})]})]},`Tabs_${S??""}${u??""}${b??""}`):e.jsxs(R,{defaultValue:"all",className:"w-full",children:[e.jsxs(_,{className:"grid w-full grid-cols-4 gap-2",children:[e.jsx(i,{value:"all",style:g,children:s("Smartcoins:viewingAllAssets")}),e.jsx(i,{value:"all",children:s("Smartcoins:viewCompatible")}),e.jsx(i,{value:"all",children:s("Smartcoins:viewHoldings")}),e.jsx(i,{value:"all",children:s("Smartcoins:search")})]}),e.jsxs(j,{value:"all",children:[e.jsx("h5",{className:"mb-2 text-center",children:s("Smartcoins:listingAllSmartcoins",{count:"..."})}),e.jsx(y,{height:500,itemCount:3,itemSize:200,className:"w-full",children:ee})]})]})})]})})})})}export{ke as default};
