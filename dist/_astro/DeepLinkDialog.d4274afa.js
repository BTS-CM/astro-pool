import{p as D,_ as J,j as e,r as b,v as E,O as L,U as C,D as B,z as $,E as F,F as R,G as _,B as c}from"./CurrentUser.1e0e4221.js";import{r as o}from"./index.178a5b5e.js";import{T as A,a as M,b as r,c as u,j as X}from"./common.e1bc7670.js";import{E as q}from"./ExternalLink.26cefe6b.js";const P=o.forwardRef((l,a)=>o.createElement(D.label,J({},l,{ref:a,onMouseDown:t=>{var s;(s=l.onMouseDown)===null||s===void 0||s.call(l,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault()}}))),j=P,G=E("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=o.forwardRef(({className:l,...a},t)=>e.jsx(j,{ref:t,className:b(G(),l),...a}));d.displayName=j.displayName;const f=o.forwardRef(({className:l,...a},t)=>e.jsx("textarea",{className:b("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",l),ref:t,...a}));f.displayName="Textarea";let g=[];const[U]=L({fetcher:(...l)=>fetch(`http://localhost:8080/api/deeplink/${l[0]}/${l[1]}`,{method:"POST",body:JSON.stringify(g)}).then(async a=>{if(!a.ok)throw console.log("Failed to generate deeplink"),new Error("Failed to generate deeplink");let t;try{t=await a.json()}catch{throw console.log("Failed to parse JSON"),new Error("Failed to parse JSON")}return t}).then(a=>{if(a&&a.result&&a.result.generatedDeepLink)return a.result.generatedDeepLink;throw new Error("No deep link generated")})});function I(l){const{trxJSON:a,operationName:t,usrChain:s,headerText:w,dismissCallback:N,username:y,userID:v}=l,k=o.useMemo(()=>(g=a,U([s,t])),[s,t,a]),{data:x,loading:n,error:T}=C(k),[h,m]=o.useState(!1),O=()=>{h||(m(!0),setTimeout(()=>{m(!1)},1e4))},[i,p]=o.useState("object");return e.jsx(B,{open:!0,onOpenChange:S=>{N(S)},children:e.jsxs($,{className:"sm:max-w-[800px] bg-white",children:[e.jsxs(F,{children:[e.jsx(R,{children:n?e.jsx(e.Fragment,{children:"Generating deeplink..."}):e.jsx(e.Fragment,{children:w})}),e.jsxs(_,{children:["With the account: ",y," (",v,")",e.jsx("br",{}),n?null:e.jsxs(e.Fragment,{children:["Your Bitshares Beet operation is ready to broadcast!",e.jsx("br",{}),"Choose from the methods below to broadcast your transaction via the",e.jsx(q,{classNameContents:"text-blue-500",type:"text",text:" Bitshares BEET multiwallet",hyperlink:"https://github.com/bitshares/beet"}),"."]}),T?e.jsx(e.Fragment,{children:"An error occurred, sorry. Please close this dialog and try again."}):null]})]}),e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"mt-3"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(A,{defaultValue:"object",className:"w-full",children:[e.jsxs(M,{className:"grid w-full grid-cols-3 gap-2",children:[i==="object"?e.jsx(r,{value:"object",children:"View TRX Object"},"activeTRXTab"):e.jsx(r,{value:"object",onClick:()=>p("object"),children:"View TRX Object"},"inactiveTRXTab"),i==="deeplink"?e.jsx(r,{value:"deeplink",children:"Raw Deeplink"},"activeDLTab"):e.jsx(r,{value:"deeplink",onClick:()=>p("deeplink"),children:"Raw Deeplink"},"inactiveDLTab"),i==="localJSON"?e.jsx(r,{value:"localJSON",className:"bg-muted",children:"Local JSON file"},"activeJSONTab"):e.jsx(r,{value:"localJSON",onClick:()=>p("localJSON"),children:"Local JSON file"},"inactiveJSONTab")]},`${i}_TabList`),e.jsxs(u,{value:"object",children:[e.jsxs("div",{className:"grid w-full gap-1.5 mb-3",children:[e.jsx(d,{className:"text-left",children:"Transaction object JSON"}),e.jsxs("span",{className:"text-left text-sm",children:["Operation type: ",t]}),e.jsx(f,{value:JSON.stringify(a,null,4),className:"min-h-[250px]",id:"trxJSON",readOnly:!0})]}),e.jsx(c,{onClick:()=>{X(JSON.stringify(a,null,4))},children:"Copy operation JSON"})]}),e.jsxs(u,{value:"deeplink",children:[e.jsx(d,{className:"text-left",children:"Using a deeplink to broadcast via the Beet multiwallet"}),e.jsxs("ol",{className:"ml-4",children:[e.jsxs("li",{type:"1",children:["Launch the BEET wallet and navigate to '",e.jsx("b",{children:"Raw Link"}),"' in the menu, the wallet has to remain unlocked for the duration of the broadcast."]}),e.jsxs("li",{type:"1",children:["From this page you can either allow all operations, or solely allow operation '",e.jsx("b",{children:t}),"' (then click save)."]}),e.jsx("li",{type:"1",children:"Once 'Ready for raw links' shows in Beet, then you can click the button below to proceed."}),e.jsx("li",{type:"1",children:"A BEET prompt will display, verify the contents, optionally request a Beet receipt, and then broadcast the transaction onto the blockchain."}),e.jsx("li",{type:"1",children:"You won't receive a confirmation in this window, but your operation will be processed within seconds on the blockchain."})]}),n?null:e.jsx("a",{href:`rawbeet://api?chain=BTS&request=${x}`,children:e.jsx(c,{className:"mt-4",children:"Trigger raw Beet deeplink"})})]}),e.jsxs(u,{value:"localJSON",children:[e.jsx(d,{className:"text-left",children:"Via local file upload - ready to proceed"}),e.jsxs("ol",{className:"ml-4",children:[e.jsxs("li",{type:"1",children:["Launch the BEET wallet and navigate to '",e.jsx("b",{children:"Local"}),"' in the menu."]}),e.jsxs("li",{type:"1",children:["At this page either allow all, or allow just operation '",e.jsx("b",{children:t}),"'."]}),e.jsx("li",{type:"1",children:"Once at the local upload page, click the button below to download the JSON file to your computer."}),e.jsx("li",{type:"1",children:"From the BEET Local page, upload the JSON file, a prompt should then appear."}),e.jsx("li",{type:"1",children:"Thoroughly verify the prompt's contents before approving any operation, also consider toggling the optional receipt for post broadcast analysis and verification purposes."})]}),!n&&h?e.jsx(c,{className:"mt-4",variant:"outline",disabled:!0,children:"Downloading..."}):null,!n&&!h?e.jsx("a",{href:`data:text/json;charset=utf-8,${x}`,download:`${t}.json`,target:"_blank",rel:"noreferrer",onClick:O,children:e.jsx(c,{className:"mt-4",children:"Download Beet operation JSON"})}):null]})]})})]})]})})}export{I as D,d as L};
