import{p as de,q as O,_ as z,r as ue,s as X,j as e,t as G,I as b,B as A,C as F,A as U,b as T,c as _,d as I,$ as Z,v as J,w as Q,x as W,u as he,g as M,D as me,k as xe,l as fe,m as je,n as ge,o as pe,f as be}from"./CurrentUser.76ee68b2.js";import{r as t}from"./index.40fd2bfc.js";import{u as ve,F as $e,a as N,b as S,c as C,d as w,e as B,f as $}from"./fuse.esm.f5056299.js";import{h as Ae,t as Ne}from"./common.caf612c1.js";import{A as Se}from"./AssetDropDownCard.5e3a055f.js";const Y="Avatar",[Ce,Oe]=de(Y),[we,ee]=Ce(Y),ye=t.forwardRef((l,n)=>{const{__scopeAvatar:r,...o}=l,[a,h]=t.useState("idle");return t.createElement(we,{scope:r,imageLoadingStatus:a,onImageLoadingStatusChange:h},t.createElement(O.span,z({},o,{ref:n})))}),ke="AvatarImage",Be=t.forwardRef((l,n)=>{const{__scopeAvatar:r,src:o,onLoadingStatusChange:a=()=>{},...h}=l,c=ee(ke,r),d=Fe(o),x=ue(f=>{a(f),c.onImageLoadingStatusChange(f)});return X(()=>{d!=="idle"&&x(d)},[d,x]),d==="loaded"?t.createElement(O.img,z({},h,{ref:n,src:o})):null}),Ee="AvatarFallback",De=t.forwardRef((l,n)=>{const{__scopeAvatar:r,delayMs:o,...a}=l,h=ee(Ee,r),[c,d]=t.useState(o===void 0);return t.useEffect(()=>{if(o!==void 0){const x=window.setTimeout(()=>d(!0),o);return()=>window.clearTimeout(x)}},[o]),c&&h.imageLoadingStatus!=="loaded"?t.createElement(O.span,z({},a,{ref:n})):null});function Fe(l){const[n,r]=t.useState("idle");return X(()=>{if(!l){r("error");return}let o=!0;const a=new window.Image,h=c=>()=>{o&&r(c)};return r("loading"),a.onload=h("loaded"),a.onerror=h("error"),a.src=l,()=>{o=!1}},[l]),n}const se=ye,ae=Be,te=De,R=t.forwardRef(({className:l,...n},r)=>e.jsx(se,{ref:r,className:G("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",l),...n}));R.displayName=se.displayName;const Te=t.forwardRef(({className:l,...n},r)=>e.jsx(ae,{ref:r,className:G("aspect-square h-full w-full",l),...n}));Te.displayName=ae.displayName;const L=t.forwardRef(({className:l,...n},r)=>e.jsx(te,{ref:r,className:G("flex h-full w-full items-center justify-center rounded-full bg-muted",l),...n}));L.displayName=te.displayName;function _e(l){const{chain:n,excludedUsers:r,setChosenAccount:o}=l,[a,h]=t.useState(),[c,d]=t.useState(),[x,f]=t.useState(!1),[u,y]=t.useState();async function P(){const p=r.map(v=>v.username),E=r.map(v=>v.id);if(p.includes(a)||E.includes(a)){f(!1),d("Cannot transfer assets to this account.");return}const k=await fetch(`http://localhost:8080/api/accountLookup/${n}/${a}`,{method:"GET"});if(!k.ok){console.log({error:new Error(`${k.status} ${k.statusText}`),msg:"Couldn't find account."}),f(!1);return}const s=await k.json();if(s&&s.result){const v=s.result;f(!1),y(v);return}f(!1),d("Couldn't find account.")}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[u?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:"Please enter a blockchain account name"}),e.jsxs("div",{className:"col-span-1",children:[" ",e.jsx(b,{value:a||"",placeholder:"Account name or ID",onKeyDown:p=>{p.key==="Enter"&&!x&&(f(!0),P())},onChange:p=>{/^[a-zA-Z0-9.-]*$/.test(p.target.value)&&(h(p.target.value),d(),y())}}),c?e.jsx("p",{className:"text-red-500 text-xs italic",children:c||"ERROR"}):null]}),e.jsx("div",{className:"col-span-1",children:a&&!x?e.jsx(A,{onClick:()=>P(),children:"Continue"}):e.jsx(A,{disabled:!0,children:"Continue"})})]}),u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:n==="bitshares"?"Proceed with the following Bitshares account?":"Proceed with the following Bitshares testnet (TEST) account?"}),e.jsx("div",{className:"col-span-1",children:e.jsx(F,{className:"mb-2 mt-1 text-center",onClick:()=>{o({name:u.name,id:u.id})},children:e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"col-span-1 pt-6 pl-7",children:e.jsx(U,{size:40,name:u.name,extra:"AS",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(T,{children:[e.jsx(_,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:u.name}),e.jsx(I,{children:u.id})]})})]})},u.id)}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{children:e.jsx(A,{variant:"outline",className:"mr-2",onClick:()=>{d(),y()},children:"Go back"})}),e.jsx("div",{className:"text-right",children:e.jsx(A,{variant:"outline",onClick:()=>{o({name:u.name,id:u.id})},children:"Proceed"})})]})})]}):null]})})}function ze(l){const n=ve({defaultValues:{account:""}}),[r,o]=t.useState(),[a,h]=t.useState(),[c,d]=t.useState(),[x,f]=t.useState(0),[u,y]=t.useState(),[P,p]=t.useState(!1),[E,k]=t.useState(!1),s=t.useSyncExternalStore(Z.subscribe,Z.get,()=>!0),v=t.useSyncExternalStore(J.subscribe,J.get,()=>!0),ne=t.useSyncExternalStore(Q.subscribe,Q.get,()=>!0),D=t.useSyncExternalStore(W.subscribe,W.get,()=>!0),[V,re]=t.useState(0);t.useEffect(()=>{if(D&&D.parameters){const i=D.parameters.current_fees.parameters.find(j=>j[0]===0);re(Ae(i[1].fee,5))}},[D]),he(s&&s.chain?s.chain:"bitshares");const[ce,Ie]=t.useState(0),[H,le]=t.useState();t.useEffect(()=>{async function m(){const i=await fetch(`http://localhost:8080/api/getAccountBalances/${s.chain}/${s.id}`,{method:"GET"});if(!i.ok){console.log("Issues whilst fetching");return}const j=await i.json();if(j&&j.result){const K=j.result;console.log("Fetched account balances"),le(K)}}s&&s.id&&s.id.length&&m()},[s,ce]);const[g,oe]=t.useState();t.useEffect(()=>{if(c){const m=v.filter(i=>i.symbol===c);m&&m.length&&oe(m[0])}},[c]);const[ie,q]=t.useState(!1);return t.useEffect(()=>{r&&o(!1)},[r]),t.useEffect(()=>{a&&q(!1)},[a]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto mt-5 mb-5",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(F,{children:[e.jsxs(T,{children:[e.jsx(_,{children:"Transfer assets"}),e.jsx(I,{children:"Send funds from an account you control to another BitShares account holder."})]}),e.jsx(M,{children:e.jsx($e,{...n,children:e.jsxs("form",{onSubmit:()=>{p(!0),setShowDialog(!0),event.preventDefault()},children:[e.jsx(N,{control:n.control,name:"account",render:({field:m})=>e.jsxs(S,{children:[e.jsx(C,{children:"Sending account"}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[e.jsx("div",{className:"col-span-1 ml-5",children:e.jsx(U,{size:40,name:s&&s.username?s.username:"x",extra:"Sender",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]})}),e.jsx("div",{className:"col-span-7",children:e.jsx(b,{disabled:!0,placeholder:"Bitshares account (1.2.x)",className:"mb-1 mt-1",value:`${s&&s.username?s.username:"?"} (${s&&s.id?s.id:"?"})`})})]})}),e.jsx(B,{children:"This is the account which will transfer the assets to the target recipient."}),e.jsx($,{})]})}),e.jsx(N,{control:n.control,name:"targetAccount",render:({field:m})=>e.jsxs(S,{children:[e.jsx(C,{children:"Target account"}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsx("div",{className:"col-span-1 ml-5",children:a&&a.name?e.jsx(U,{size:40,name:a.name,extra:"Target",expression:{eye:"normal",mouth:"open"},colors:["#92A1C6","#146A7C","#F0AB3D","#C271B4","#C20D90"]}):e.jsx(R,{children:e.jsx(L,{children:"?"})})}),e.jsx("div",{className:"col-span-5",children:e.jsx(b,{disabled:!0,placeholder:a&&a.name?`${a.name} (${a.id})`:"Bitshares account (1.2.x)",className:"mb-1 mt-1"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(me,{open:ie,onOpenChange:i=>{q(i)},children:[e.jsx(xe,{asChild:!0,children:e.jsx(A,{variant:"outline",className:"ml-3 mt-1",children:a?"Change target":"Provide target"})}),e.jsxs(fe,{className:"sm:max-w-[375px] bg-white",children:[e.jsxs(je,{children:[e.jsxs(ge,{children:[!s||!s.chain?"Bitshares account search":null,s&&s.chain==="bitshares"?"Bitshares (BTS) account search":null,s&&s.chain!=="bitshares"?"Bitshares testnet (TEST) account search":null]}),e.jsx(pe,{children:"Searching for an account to transfer assets to."})]}),e.jsx(_e,{chain:s&&s.chain?s.chain:"bitshares",excludedUsers:s&&s.username&&s.username.length?[s]:[],setChosenAccount:h})]})]})})]})}),e.jsx(B,{children:!a||!a.name?"This is the account which will receive your transfer.":`The user ${a.name} will receive your transfer.`}),e.jsx($,{})]})}),e.jsx(N,{control:n.control,name:"targetAsset",render:({field:m})=>e.jsxs(S,{children:[e.jsx(C,{children:"Asset to transfer"}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-8 mt-4",children:[e.jsxs("div",{className:"col-span-1 ml-5",children:[!c||!g?e.jsx(R,{children:e.jsx(L,{children:"?"})}):null,g?e.jsx(R,{onClick:()=>console.log("Clicked"),children:e.jsx(L,{children:e.jsx("div",{className:"text-sm",children:g.bitasset_data_id?"MPA":"UIA"})})}):null]}),e.jsxs("div",{className:"col-span-5",children:[!c||!g?e.jsx(b,{disabled:!0,placeholder:"Bitshares asst (1.3.x)",className:"mb-1 mt-1"}):null,g?e.jsx(b,{disabled:!0,placeholder:`${g.symbol} (${g.id})`,className:"mb-1 mt-1"}):null]}),e.jsx("div",{className:"col-span-2 mt-1 ml-3",children:e.jsx(Se,{assetSymbol:c??"",assetData:null,storeCallback:d,otherAsset:null,marketSearch:ne,type:null})})]})}),e.jsx(B,{children:"This is the asset which will be transferred to the target account."}),e.jsx($,{children:g&&H&&!H.map(i=>i.asset_id).includes(g.id)?`Unable to proceed, your account "${s.username}" doesn't hold any of this asset.`:null})]})}),c&&a?e.jsx(N,{control:n.control,name:"transferAmount",render:({field:m})=>e.jsxs(S,{children:[e.jsx(C,{children:`Amount of ${c??"???"} to transfer`}),e.jsx(w,{onChange:i=>{const j=i.target.value;/^[0-9]*\.?[0-9]*$/.test(j)&&f(j)},children:e.jsx(b,{label:"Amount to transfer",value:x,placeholder:x,className:"mb-1"})}),e.jsx(B,{children:"How much you're going to send to the target account."}),e.jsx($,{})]})}):null,c&&a?e.jsx(N,{control:n.control,name:"memoField",render:({field:m})=>e.jsxs(S,{children:[e.jsx(C,{children:"Optional memo"}),e.jsx(w,{onChange:i=>{const j=i.target.value;y(j)},children:e.jsx(b,{label:"Memo field",value:u,placeholder:u,className:"mb-1"})}),e.jsxs(B,{children:["An encrypted message for ",a.name,"'s eyes only.",e.jsx("br",{})," Often used by exchanges and 3rd party services."]}),e.jsx($,{})]})}):null,c&&a?e.jsx(N,{control:n.control,name:"networkFee",render:({field:m})=>e.jsxs(S,{children:[e.jsx(C,{children:"Network fee"}),e.jsx(w,{children:e.jsx(b,{disabled:!0,placeholder:`${V} BTS`,className:"mb-3 mt-3"})}),s.id===s.referrer?e.jsxs($,{children:["Rebate: ",Ne(V*.8,5)," BTS (vesting)"]}):null,e.jsx($,{})]})}):null,!x||E!==!1?e.jsx(A,{className:"mt-5 mb-3",variant:"outline",disabled:!0,type:"submit",children:"Submit"}):e.jsx(A,{className:"mt-5 mb-3",variant:"outline",type:"submit",children:"Submit"})]})})})]})}),e.jsxs("div",{className:"grid grid-cols-2 mt-5 gap-5",children:[a&&a.name?e.jsx("div",{className:"col-span-1",children:e.jsx("a",{href:`https://blocksights.info/#/accounts/${a.name}`,target:"_blank",children:e.jsxs(F,{children:[e.jsxs(T,{className:"pb-0 mb-0",children:[e.jsx(_,{children:"Double check the above details!"}),e.jsx(I,{children:"Avoid heartbreak, check your inputs!"})]}),e.jsx(M,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Before you proceed, please double check the form inputs."}),e.jsx("li",{children:"Validate the entire Beet prompt contents before you broadcast the transaction."}),e.jsxs("li",{children:["Click here to view ",a.name,"'s account on the Blocksights blockchain explorer."]})]})})]})})}):null,a&&a.name?e.jsx("div",{className:"col-span-1",children:e.jsxs(F,{children:[e.jsxs(T,{className:"pb-0 mb-0",children:[e.jsx(_,{children:"Beware! Don't fall for scams!"}),e.jsx(I,{children:"Be vigilant against scammers!"})]}),e.jsx(M,{className:"text-sm",children:e.jsxs("ul",{className:"ml-2 list-disc [&>li]:mt-2",children:[e.jsx("li",{children:"Crypto exchanges will NEVER direct message you in with special transfer instructions to follow for deposits nor withdrawals."}),e.jsx("li",{children:"Asset transfer operations are permanent and the majority of assets are irrecoverable if missent."}),e.jsx("li",{children:"If something sounds too good to be true, then it likely is, don't fall victim to scammers tricks."})]})})]})}):null]}),e.jsx("div",{className:"grid grid-cols-1 mt-5",children:s&&s.username&&s.username.length?e.jsx(be,{usr:s}):null})]})})}export{ze as default};
