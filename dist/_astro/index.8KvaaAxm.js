import{h as p,e as k,a as S,_,b as h,i as U}from"./index.TXmbRjpk.js";import{r}from"./index.sXsv9c-e.js";function z(s,e=globalThis?.document){const o=p(s);r.useEffect(()=>{const i=t=>{t.key==="Escape"&&o(t)};return e.addEventListener("keydown",i),()=>e.removeEventListener("keydown",i)},[o,e])}const y="dismissableLayer.update",A="dismissableLayer.pointerDownOutside",K="dismissableLayer.focusOutside";let w;const N=r.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),G=r.forwardRef((s,e)=>{var o;const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:t,onPointerDownOutside:d,onFocusOutside:v,onInteractOutside:u,onDismiss:l,...b}=s,a=r.useContext(N),[c,L]=r.useState(null),f=(o=c?.ownerDocument)!==null&&o!==void 0?o:globalThis?.document,[,x]=r.useState({}),F=k(e,n=>L(n)),O=Array.from(a.layers),[I]=[...a.layersWithOutsidePointerEventsDisabled].slice(-1),R=O.indexOf(I),D=c?O.indexOf(c):-1,W=a.layersWithOutsidePointerEventsDisabled.size>0,P=D>=R,B=H(n=>{const E=n.target,m=[...a.branches].some($=>$.contains(E));!P||m||(d?.(n),u?.(n),n.defaultPrevented||l?.())},f),g=X(n=>{const E=n.target;[...a.branches].some($=>$.contains(E))||(v?.(n),u?.(n),n.defaultPrevented||l?.())},f);return z(n=>{D===a.layers.size-1&&(t?.(n),!n.defaultPrevented&&l&&(n.preventDefault(),l()))},f),r.useEffect(()=>{if(c)return i&&(a.layersWithOutsidePointerEventsDisabled.size===0&&(w=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),a.layersWithOutsidePointerEventsDisabled.add(c)),a.layers.add(c),T(),()=>{i&&a.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=w)}},[c,f,i,a]),r.useEffect(()=>()=>{c&&(a.layers.delete(c),a.layersWithOutsidePointerEventsDisabled.delete(c),T())},[c,a]),r.useEffect(()=>{const n=()=>x({});return document.addEventListener(y,n),()=>document.removeEventListener(y,n)},[]),r.createElement(S.div,_({},b,{ref:F,style:{pointerEvents:W?P?"auto":"none":void 0,...s.style},onFocusCapture:h(s.onFocusCapture,g.onFocusCapture),onBlurCapture:h(s.onBlurCapture,g.onBlurCapture),onPointerDownCapture:h(s.onPointerDownCapture,B.onPointerDownCapture)}))});function H(s,e=globalThis?.document){const o=p(s),i=r.useRef(!1),t=r.useRef(()=>{});return r.useEffect(()=>{const d=u=>{if(u.target&&!i.current){let b=function(){C(A,o,l,{discrete:!0})};const l={originalEvent:u};u.pointerType==="touch"?(e.removeEventListener("click",t.current),t.current=b,e.addEventListener("click",t.current,{once:!0})):b()}else e.removeEventListener("click",t.current);i.current=!1},v=window.setTimeout(()=>{e.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(v),e.removeEventListener("pointerdown",d),e.removeEventListener("click",t.current)}},[e,o]),{onPointerDownCapture:()=>i.current=!0}}function X(s,e=globalThis?.document){const o=p(s),i=r.useRef(!1);return r.useEffect(()=>{const t=d=>{d.target&&!i.current&&C(K,o,{originalEvent:d},{discrete:!1})};return e.addEventListener("focusin",t),()=>e.removeEventListener("focusin",t)},[e,o]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function T(){const s=new CustomEvent(y);document.dispatchEvent(s)}function C(s,e,o,{discrete:i}){const t=o.originalEvent.target,d=new CustomEvent(s,{bubbles:!1,cancelable:!0,detail:o});e&&t.addEventListener(s,e,{once:!0}),i?U(t,d):t.dispatchEvent(d)}export{G as $};
